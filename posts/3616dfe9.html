<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>LLVM 后端实践笔记 4：生成目标文件 | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="之前的章节只介绍了汇编代码生成的内容，这一章，我们将介绍对 ELF 目标格式文件的支持以及如何使用 objdump 工具来验证生成的目标文件。在 LLVM 代码框架下，只需要增加少量的代码，Cpu0 后端就可以生成支持大端或小端编码的目标文件。目标注册机制以及它的结构也在本章介绍。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构"><meta property="og:type" content="article"><meta property="og:title" content="LLVM 后端实践笔记 4：生成目标文件"><meta property="og:url" content="https://p2tree.top/posts/3616dfe9.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="之前的章节只介绍了汇编代码生成的内容，这一章，我们将介绍对 ELF 目标格式文件的支持以及如何使用 objdump 工具来验证生成的目标文件。在 LLVM 代码框架下，只需要增加少量的代码，Cpu0 后端就可以生成支持大端或小端编码的目标文件。目标注册机制以及它的结构也在本章介绍。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2021/05/11/index.webp"><meta property="article:published_time" content="2021-05-11T22:18:35.000Z"><meta property="article:modified_time" content="2021-05-11T22:18:35.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2021/05/11/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LLVM 后端实践笔记 4：生成目标文件",
  "url": "https://p2tree.top/posts/3616dfe9.html",
  "image": "https://img.p2tree.top/2021/05/11/index.webp",
  "datePublished": "2021-05-11T22:18:35.000Z",
  "dateModified": "2021-05-11T22:18:35.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/3616dfe9.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"LLVM 后端实践笔记 4：生成目标文件",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2021/05/11/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">LLVM 后端实践笔记 4：生成目标文件</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LLVM 后端实践笔记 4：生成目标文件</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-05-11T22:18:35.000Z" title="发表于 2021-05-11 22:18:35">2021-05-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-05-11T22:18:35.000Z" title="更新于 2021-05-11 22:18:35">2021-05-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2021-05-11 22:18:35&quot;}" hidden></div><p>之前的章节只介绍了汇编代码生成的内容，这一章，我们将介绍对 ELF 目标格式文件的支持以及如何使用 objdump 工具来验证生成的目标文件。在 LLVM 代码框架下，只需要增加少量的代码，Cpu0 后端就可以生成支持大端或小端编码的目标文件。目标注册机制以及它的结构也在本章介绍。</p><ol class="series-items"><li><a href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a></li><li><a href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a></li><li><a href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a></li><li><a href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a></li><li><a href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a></li><li><a href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a></li><li><a href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a></li><li><a href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a></li><li><a href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a></li><li><a href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a></li><li><a href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a></li><li><a href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a></li></ol><hr><h2 id="4-1-简要说明"><a href="#4-1-简要说明" class="headerlink" title="4.1 简要说明"></a>4.1 简要说明</h2><h3 id="4-1-1-编码"><a href="#4-1-1-编码" class="headerlink" title="4.1.1 编码"></a>4.1.1 编码</h3><p>当 llc 指定 <code>-filetype=obj</code> 时，编译器会生成目标文件（而不是汇编文件），此时，<code>AsmPrinter::OutStreamer</code> 所引用的是 <code>MCObjectStreamer</code>（汇编时引用的是 <code>MCAsmStreamer</code>）。LLVM 官方认为这个结构是后端代码生成阶段非常好的一个设计。</p><p>关键的一个接口是 <code>Cpu0AsmPrinter::EmitInstruction()</code>，这个接口调用 <code>MCObjectStreamer::EmitInstruction()</code> ，进而根据选择生成的目标文件格式（ELF，COFF等）调用对应的编码发射函数，如 ELF 使用 <code>MCELFStreamer()::EmitInstToData()</code>。此时会进入到 Cpu0MCCodeEmitter.cpp 文件的实现中，调用 <code>Cpu0MCCodeEmitter::encodeInstruction()</code>，配合 TableGen 生成的 <code>Cpu0MCCodeEmitter::getBinaryCodeForInstr()</code>等接口完成最后的发射。</p><p>获取待发射指令编码的调用过程为：</p><ul><li><code>Cpu0MCCodeEmitter::encodeInstruction()</code> 中，调用 TableGen 生成的 Cpu0GenMCCodeEmitter.inc 中的 <code>getBinaryCodeForInstr()</code>，传入 <code>MI.Opcode</code>；</li><li><code>getBinaryCodeForInstr()</code> 将 <code>MI.Operand</code> 传入 <code>Cpu0MCCodeEmitter::getMachineOpValue()</code> 来获取操作数的编码，这还需要再配合 Cpu0GenRegisterInfo.inc 和 Cpu0GenInstrInfo.inc 中的编码信息；</li><li><code>getBinaryCodeForInstr()</code> 将操作数的编码和指令操作码统一返回给 <code>encodeInstruction()</code>；</li></ul><p>比如一个加法操作，<code>%0 = add %1, %2</code> 生成为 <code>adds $v0, $at, $v1</code>，除了 <code>adds</code> 指令的编码需要在 Cpu0GenInstrInfo.inc 中查看外，还需要通过 <code>getEncodingValue(Reg)</code> 到 Cpu0GenRegisterInfo.inc 中查看寄存器的编码，寄存器的编码和编码位置都在 Cpu0RegisterInfo.td 文件中描述了。</p><p>对于更复杂的操作数，比如内存操作数，我们在 tablegen 描述文件中，定义了一个 <code>mem</code> 的 pattern：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def mem : Operand&lt;iPTR&gt; &#123;</span><br><span class="line">  let PrintMethod <span class="operator">=</span> <span class="string">&quot;printMemOperand&quot;</span><span class="comment">;</span></span><br><span class="line">  let MIOperandInfo <span class="operator">=</span> (ops CPURegs<span class="punctuation">,</span> simm<span class="number">16</span>)<span class="comment">;</span></span><br><span class="line">  let EncoderMethod <span class="operator">=</span> <span class="string">&quot;getMemEncoding&quot;</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于使用这个操作数类型的指令，比如 ld&#x2F;st 指令，当代码解析其操作数时，会调用 <code>getMemEncoding()</code> 函数完成编码。后者便定义在 Cpu0MCCodeEmitter.cpp 文件中。</p><h3 id="4-1-2-重定位"><a href="#4-1-2-重定位" class="headerlink" title="4.1.2 重定位"></a>4.1.2 重定位</h3><p>Cpu0AsmBackend.cpp 中的 <code>applyFixup()</code> 函数将修正后边章节将会增加的<strong>地址控制流</strong>语句或<strong>函数调用</strong>语句，如 jeq, jub 等。Cpu0ELFObjectWriter.cpp 中的 <code>needsRelocateWithSymbol()</code> 函数中的每个重定位记录都依据这个重定位记录在链接阶段是否要调整而设置为 true 或 false。如果是 true，在链接阶段就会根据重定位信息来修正这个类型的值，否则，将不修正。</p><p>有关于重定位修正的功能将在后续 ELF 支持章节实现。</p><h3 id="4-1-3-发射"><a href="#4-1-3-发射" class="headerlink" title="4.1.3 发射"></a>4.1.3 发射</h3><p>重要的接口函数是 <code>Cpu0ELFStreamer::EmitInstToData()。</code></p><p>最后的代码发射是由 Cpu0ELFStreamer.cpp 和 Cpu0ObjectWriter.cpp 几个函数实现的，最终将 buffer 的信息写入内存文件中。具体可以阅读代码实现。</p><h3 id="4-1-4-注册"><a href="#4-1-4-注册" class="headerlink" title="4.1.4 注册"></a>4.1.4 注册</h3><p>这一章主要强调如何注册后端对象，我们这次新增加了几个类，比如 ELFStreamer， AsmBackend，MCCodeEmitter，这些后端的功能模块需要注册到 LLVM 后端架构中，从而能够让 LLVM 的公共后端代码能调用到后端相关的自定义逻辑。重点参考 Cpu0MCTargetDesc.cpp 文件中的 TargetRegistry 接口，将具体的对象传入并完成注册。具体参见代码实现。</p><h2 id="4-2-文件新增"><a href="#4-2-文件新增" class="headerlink" title="4.2 文件新增"></a>4.2 文件新增</h2><h4 id="1-Cpu0TargetStreamer-h-cpp"><a href="#1-Cpu0TargetStreamer-h-cpp" class="headerlink" title="(1) Cpu0TargetStreamer.h&#x2F;.cpp"></a>(1) Cpu0TargetStreamer.h&#x2F;.cpp</h4><p>定义了一个叫 Cpu0TargetStreamer 的类，继承自 MCTargetStreamer 类。</p><p>定义了一个叫 Cpu0TargetAsmStreamer 的类，继承自 Cpu0TargetStreamer 类，这个类用来完成汇编器 Streamer 的功能。AsmStreamer 对象会注册到后端模块中。</p><h4 id="2-MCTargetDesc-Cpu0ELFStreamer-h-cpp"><a href="#2-MCTargetDesc-Cpu0ELFStreamer-h-cpp" class="headerlink" title="(2) MCTargetDesc&#x2F;Cpu0ELFStreamer.h&#x2F;.cpp"></a>(2) MCTargetDesc&#x2F;Cpu0ELFStreamer.h&#x2F;.cpp</h4><p>定义了一个叫 Cpu0ELFStreamer 的类，继承自 MCELFStreamer 类。另外定义了这个类的工厂函数 <code>createCpu0ELFStreamer()</code>，用来返回其对象。ELFStreamer 对象会注册到后端模块中。</p><p>TargetStreamer 和 ELFStreamer 在生成 ELF 文件中同时起作用，ELFStreamer 是我们自定义的一个类，在其中可以做一些钩子来调整输出内容。</p><p>目前这些文件中都还是比较空的状态，我们先搭建整个框架。</p><h4 id="3-MCTargetDesc-Cpu0AsmBackend-h-cpp"><a href="#3-MCTargetDesc-Cpu0AsmBackend-h-cpp" class="headerlink" title="(3) MCTargetDesc&#x2F;Cpu0AsmBackend.h&#x2F;.cpp"></a>(3) MCTargetDesc&#x2F;Cpu0AsmBackend.h&#x2F;.cpp</h4><p>比较重要的一个文件，实现了 Cpu0AsmBackend 类，继承自 MCAsmBackend 类。这个类作为汇编器后端实现类，目前对 Fixup 信息的操作提供了接口，比如 <code>applyFixup()</code> 用来使能 Fixup 状态，<code>getFixupKindInfo()</code> 用来获取 Fixup 类型信息，<code>getNumFixupKinds()</code> 用来获取 Fixup 类型的数量，<code>mayNeedRelaxation()</code> 返回需要 relaxation 的指令的状态（目前是空），<code>fixupNeedsRelaxation()</code> 返回给定 fixup 下的指令是否需要 relaxation 的状态（目前是空）。</p><p>已经定义了一些常用的 fixup 类型，比如 32 位类型：<code>fixup_Cpu0_32</code>, <code>fixup_Cpu0_HI16</code>, <code>fixup_Cpu0_LO16</code>，还有 GOT 的一些 fixup 类型。</p><p>这些函数都是对基类函数的覆写，有关于重定向的功能都将在之后的章节讲解，所以目前会留空。</p><p>我们还在其中实现了两个工厂函数，<code>createCpu0AsmBackendEL32()</code> 和 <code>createCpu0AsmBackendEB32()</code>，用来返回一个 AsmBackend 的实例。</p><h4 id="4-MCTargetDesc-Cpu0FixupKinds-h"><a href="#4-MCTargetDesc-Cpu0FixupKinds-h" class="headerlink" title="(4) MCTargetDesc&#x2F;Cpu0FixupKinds.h"></a>(4) MCTargetDesc&#x2F;Cpu0FixupKinds.h</h4><p>这个头文件中定义了 <code>llvm::Cpu0::Fixups</code> 的枚举值，这里的定义顺序必须与 Cpu0AsmBackend.cpp 中的 MCFixupKindInfo 保持一致。</p><h4 id="5-MCTargetDesc-Cpu0MCCodeEmitter-h-cpp"><a href="#5-MCTargetDesc-Cpu0MCCodeEmitter-h-cpp" class="headerlink" title="(5) MCTargetDesc&#x2F;Cpu0MCCodeEmitter.h&#x2F;.cpp"></a>(5) MCTargetDesc&#x2F;Cpu0MCCodeEmitter.h&#x2F;.cpp</h4><p>另一个比较重要的类，用来为 Streamer 类提供直接发射编码的实现接口。定义了比如 <code>encodeInstruction()</code> 等重要接口。</p><p>我们在 <code>encodeInstruction()</code> 中检查一些未完成编码设计的指令，这还需要考虑一些特殊情况，比如要排除编码为 0 的情况，排除伪指令（伪代码不应该出现在这这个阶段了）。<code>getBinaryCodeForInstr()</code> 函数是 TableGen 自动生成的，可以通过传入给定的 MI 指令，获取该指令的编码。</p><p>它也有对应的工厂函数 <code>createCpu0MCCodeEmitterEB()</code> 和 <code>createCpu0MCCodeEmitterEL()</code>。</p><h4 id="6-MCTargetDesc-Cpu0ELFObjectWriter-cpp"><a href="#6-MCTargetDesc-Cpu0ELFObjectWriter-cpp" class="headerlink" title="(6) MCTargetDesc&#x2F;Cpu0ELFObjectWriter.cpp"></a>(6) MCTargetDesc&#x2F;Cpu0ELFObjectWriter.cpp</h4><p>定义了一个叫 Cpu0ELFObjectWriter 的类，继承自 MCELFObjectTargetWriter 类。这个类将用来完成最终的 ELF 文件格式的写入任务。</p><p>其中提供了 <code>getRelocType()</code> 方法用来获取重定位类型，<code>needsRelocateWithSymbol()</code> 判断某种重定位类型是否是符号重定位，默认大多数都是符号重定位。</p><h4 id="7-MCTargetDesc-Cpu0MCExpr-h-cpp"><a href="#7-MCTargetDesc-Cpu0MCExpr-h-cpp" class="headerlink" title="(7) MCTargetDesc&#x2F;Cpu0MCExpr.h&#x2F;.cpp"></a>(7) MCTargetDesc&#x2F;Cpu0MCExpr.h&#x2F;.cpp</h4><p>针对操作数是表达式的情况，我们需要额外做处理。其中定义了 Cpu0MCExpr 类，继承自 MCTargetExpr 类。其中声明了表达式类型 Cpu0ExprKind，还提供了 <code>create()</code>, <code>getKind()</code> 等接口。</p><h2 id="4-3-文件修改"><a href="#4-3-文件修改" class="headerlink" title="4.3 文件修改"></a>4.3 文件修改</h2><h4 id="1-MCTargetDesc-Cpu0MCTargetDesc-h-cpp"><a href="#1-MCTargetDesc-Cpu0MCTargetDesc-h-cpp" class="headerlink" title="(1) MCTargetDesc&#x2F;Cpu0MCTargetDesc.h&#x2F;.cpp"></a>(1) MCTargetDesc&#x2F;Cpu0MCTargetDesc.h&#x2F;.cpp</h4><p>我们知道这个文件中会完成注册一些后端模块的功能。</p><p>首先定义了两个函数，<code>createMCStreamer()</code> 调用 <code>createCpu0ELFStreamer()</code> 用来建立 ELFStreamer 对象，<code>createCpu0AsmTargetStreamer()</code> 直接建立 Cpu0TargetAsmStreamer 对象。</p><p>然后就是调用 <code>TargetRegistry::RegisterELFStreamer()</code> 和 <code>TargetRegistry::RegisterAsmTargetStreamer()</code> 来注册这两个对象模块。另外，还调用 <code>TargetRegistry::RegisterMCCodeEmitter()</code> 来注册大小端的 MCCodeEmitter 对象，以及调用 <code>TargetRegistry::RegisterMCAsmBackend()</code> 来注册大小端的 MCAsmBackend 对象。</p><h4 id="2-CMakeLists-txt"><a href="#2-CMakeLists-txt" class="headerlink" title="(2) CMakeLists.txt"></a>(2) CMakeLists.txt</h4><p>将新增文件加入构建配置中。</p><h4 id="3-Cpu0MCInstLower-h"><a href="#3-Cpu0MCInstLower-h" class="headerlink" title="(3) Cpu0MCInstLower.h"></a>(3) Cpu0MCInstLower.h</h4><p>增加 Cpu0MCExpr.h 文件包含。</p><h4 id="4-InstPrinter-Cpu0InstPrinter-cpp"><a href="#4-InstPrinter-Cpu0InstPrinter-cpp" class="headerlink" title="(4) InstPrinter&#x2F;Cpu0InstPrinter.cpp"></a>(4) InstPrinter&#x2F;Cpu0InstPrinter.cpp</h4><p>增加 Cpu0MCExpr.h 文件包含。</p><h4 id="5-MCTargetDesc-Cpu0BaseInfo-h"><a href="#5-MCTargetDesc-Cpu0BaseInfo-h" class="headerlink" title="(5) MCTargetDesc&#x2F;Cpu0BaseInfo.h"></a>(5) MCTargetDesc&#x2F;Cpu0BaseInfo.h</h4><p>增加 Cpu0FixupKinds.h 文件包含。</p><h2 id="4-4-检验成果"><a href="#4-4-检验成果" class="headerlink" title="4.4 检验成果"></a>4.4 检验成果</h2><p>用 clang 编译后，输入后端编译命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llc -march=cpu0 -relocation-model=pic -filetype=obj ch4.ll -o ch4.o</span><br></pre></td></tr></table></figure><p>通过 objdump 可以查看二进制文件结构：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llvm-objdump -s ch4.o</span><br></pre></td></tr></table></figure><p>llvm 自己有其二进制测试工具 llvm-objdump，也可以使用 gcc 的 objdump。有关于其更多的参数和功能，可以使用 help 参数来了解，这里不再介绍。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/371534867">LLVM 后端实践笔记 4：生成目标文件 - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/3616dfe9.html">https://p2tree.top/posts/3616dfe9.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2021/05/11/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/4fa55852.html" title="发掘战略性副业"><img class="cover" src="https://img.p2tree.top/2021/05/18/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">发掘战略性副业</div></div><div class="info-2"><div class="info-item-1">今天想聊一下战略性副业。我在看《哈佛商业评论》的一期文章中学到了这个概念，原文这个词是 “the strategic side gig“ 。那么，到底什么是战略性副业？ 一、什么是战略性副业我们经常聊到的副业工作，大多数都是非战略性副业，我们通过出卖剩余精力和时间来兑换金钱，这种工作并不会带来丰富的附加收益，比如提高我们的技能，增加我们的经验。 战略性副业，其实就是能有助于提高我们各方面能力的业余工作，从长期的角度来看，战略性副业才会有助于自己综合能力的提升，有助于实现人生价值。 我在《如何摧毁年轻人》一文中提到： 摧毁年轻人最简单的办法，就是让他们忙到无法学习和成长。如何摧毁年轻人 (qq.com) 而一份战略性副业，就是学习和成长的绝好机会。 二、对我们有什么好处战略性副业其实是一种良性的社会活动，我们可以将其看做是投资行为。我们都知道投资要分散资产，从而平滑风险。你的主业就是核心资产，而战略性副业就是卫星资产，你可以选择如何配置这些资产，来让它们产生联动。 《哈佛商业评论》调查了122个来自不同公司和行业的高管，他们都认同高质量的副业对于事业成功非常重要，并且他们自己...</div></div></div></a><a class="pagination-related" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令"><img class="cover" src="https://img.p2tree.top/2021/04/05/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">LLVM 后端实践笔记 3：算术和逻辑指令</div></div><div class="info-2"><div class="info-item-1">这一章首先增加了更多的 Cpu0 算术运算指令和逻辑运算指令，这些在各个优化步骤中存在的 DAG 转换过程可以使用 Graphviz 来图形化显示，展示出更多的有效信息。不同于上一章，在这一章中，你应该专注于 C 代码的操作和 llvm IR 之间的映射以及如何在 td 文件中描述更复杂的 IR 与指令。这一章定义了另外一些寄存器类，你需要了解为什么需要它们，如果有些设计没有看懂，可能是对 Cpu0 的硬件不够熟悉，可以结合硬件来理解。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制流LLVM 后端实践笔记 8：函数调用LLVM 后端实践笔记 9：ELF文件支持LLVM 后端实践笔记 10：汇编LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器 3.1 算术运算3.1.1 简要说明(1) 乘法和移位运算...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/8a9047b8.html" title="学习LLVM数据结构：SmallSet"><img class="cover" src="https://img.p2tree.top/2025/4/27/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-27</div><div class="info-item-2">学习LLVM数据结构：SmallSet</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本系列文章以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 在现代编程语言开发中，集合（Set）是一种非常有用的数据结构，它可以高效存储唯一元素。本文介绍一种更轻量级的集合实现：SmallSet。它非常适合存储少量元素，同时保持出色的性能和内存效率。 基本介绍SmallSet 是一种小型集合类型，它实现了基本的集合操作，比如插入、删除和查找等。它的设计目标是优化在存储小规模数据时的性能和内存占用，它结合了小对象优化和动态内存调节技术，非常适合频繁访问的小集合场景。如果你已经对 SmallVector 有了解，那么 SmallSet 和它有着类似的实现思路。 llvm::SmallSet 定义在...</div></div></div></a><a class="pagination-related" href="/posts/a198516a.html" title="学习LLVM数据结构：StringRef"><img class="cover" src="https://img.p2tree.top/2025/3/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-25</div><div class="info-item-2">学习LLVM数据结构：StringRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::StringRef 定义在 llvm/ADT/StringRef.h 头文件中。 它的声明为： 1class StringRef; 和 ArrayRef 类似，StringRef 是一种轻量级的字符串引用类型，它用于实现高效地表示和操作字符串数据，尤其是在一些高频处理字符串，但同时不希望维护实际内存开销地场景下。 它是不可变引用，主要用于向函数内传递字符串同时避免深拷贝。它只包含了指向字符串的指针和字符串的长度信息，从而使得对它的操作直接而高效。 特点 轻量级：只存储一个指向字符串的指针和字符串的长度，不存储实际的数...</div></div></div></a><a class="pagination-related" href="/posts/e9ae65d7.html" title="学习LLVM数据结构：SmallVector"><img class="cover" src="https://img.p2tree.top/2025/3/9/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-09</div><div class="info-item-2">学习LLVM数据结构：SmallVector</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::SmallVector 定义在 llvm/ADT/SmallVector.h 头文件中。它的声明为： 12template&lt;typename T, unsigned N = CalculateSmallVectorDefaultInlinedElements&lt;T&gt;::value&gt; class SmallVector; llvm::SmallVector 是一个可变长数组，类似于 std::vector，同时它对较小长度的数组做了优化。它的内存管理方式采用局部缓存的设计思路，在对象内部预留一小块...</div></div></div></a><a class="pagination-related" href="/posts/cdf6959f.html" title="学习LLVM数据结构：ArrayRef"><img class="cover" src="https://img.p2tree.top/2025/2/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-25</div><div class="info-item-2">学习LLVM数据结构：ArrayRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::ArrayRef 定义在 llvm/ADT/ArrayRef.h 头文件中。它的声明为： 1template&lt;typename T&gt; class ArrayRef; llvm::ArrayRef 是一个轻量级的只读容器，主要用于引用一段连续的内存区域。它的设计目标是提供高效的数据访问，而不需要拥有底层数据的所有权。这使得 ArrayRef 特别适合在函数参数中实用，从而避免了不必要的内存拷贝。 特点 只读：ArrayRef 不能修改其引用的数据，也不能添加新元素（另一个容器 MutableArrayR...</div></div></div></a><a class="pagination-related" href="/posts/801cd0f2.html" title="LLVM 风格的 RTTI"><img class="cover" src="https://img.p2tree.top/2023/08/14/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-14</div><div class="info-item-2">LLVM 风格的 RTTI</div></div><div class="info-2"><div class="info-item-1">开头叨叨众所周知，LLVM project 没有开启 C++ 的 RTTI 特性。一个主要的原因是 LLVM project 认为 C++ RTTI 特性的实现需要使用到虚函数表，对性能并不友好。LLVM 自己实现了一种类似 RTTI 的行为。我们在开发 LLVM 代码时，尤其是需要自己搭建自定义的数据结构时，可能会想用到 RTTI，此时，学习在 LLVM 风格下如何创建类似的 API，就显得尤为重要。 什么是 RTTI难度：⭐ RTTI 是运行时类型识别，全称 Runtime Type Identification，网上有很多介绍这个的资料，属于 C++ 程序员必须要熟悉的内容。 它的主要目的是为程序运行时提供一种对对象类型的获取、操作的方式。 对应到 C++ API 上，有三个 API 会用到 RTTI： dynamic_cast，用来将一个指向基类的指针转换为一个指向派生类的指针，如果转换失败，会返回 nullptr typeid，用来返回对象类型的值 type_info，也就是 typeid 的返回类型，用来存储描述类型的信息 如果不使用这三个 API，关闭 RTTI...</div></div></div></a><a class="pagination-related" href="/posts/ab589331.html" title="LLVM New Pass Manager"><img class="cover" src="https://img.p2tree.top/2022/12/03/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-03</div><div class="info-item-2">LLVM New Pass Manager</div></div><div class="info-2"><div class="info-item-1">这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/by Arthur Eubanks（Mar 26, 2021） Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（SCC: strongly connected component）或者 loop 上。 调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。 Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominat...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">4.1 简要说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E7%BC%96%E7%A0%81"><span class="toc-number">1.1.</span> <span class="toc-text">4.1.1 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E9%87%8D%E5%AE%9A%E4%BD%8D"><span class="toc-number">1.2.</span> <span class="toc-text">4.1.2 重定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E5%8F%91%E5%B0%84"><span class="toc-number">1.3.</span> <span class="toc-text">4.1.3 发射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-4-%E6%B3%A8%E5%86%8C"><span class="toc-number">1.4.</span> <span class="toc-text">4.1.4 注册</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E6%96%87%E4%BB%B6%E6%96%B0%E5%A2%9E"><span class="toc-number">2.</span> <span class="toc-text">4.2 文件新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Cpu0TargetStreamer-h-cpp"><span class="toc-number">2.0.1.</span> <span class="toc-text">(1) Cpu0TargetStreamer.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-MCTargetDesc-Cpu0ELFStreamer-h-cpp"><span class="toc-number">2.0.2.</span> <span class="toc-text">(2) MCTargetDesc&#x2F;Cpu0ELFStreamer.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-MCTargetDesc-Cpu0AsmBackend-h-cpp"><span class="toc-number">2.0.3.</span> <span class="toc-text">(3) MCTargetDesc&#x2F;Cpu0AsmBackend.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-MCTargetDesc-Cpu0FixupKinds-h"><span class="toc-number">2.0.4.</span> <span class="toc-text">(4) MCTargetDesc&#x2F;Cpu0FixupKinds.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-MCTargetDesc-Cpu0MCCodeEmitter-h-cpp"><span class="toc-number">2.0.5.</span> <span class="toc-text">(5) MCTargetDesc&#x2F;Cpu0MCCodeEmitter.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-MCTargetDesc-Cpu0ELFObjectWriter-cpp"><span class="toc-number">2.0.6.</span> <span class="toc-text">(6) MCTargetDesc&#x2F;Cpu0ELFObjectWriter.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-MCTargetDesc-Cpu0MCExpr-h-cpp"><span class="toc-number">2.0.7.</span> <span class="toc-text">(7) MCTargetDesc&#x2F;Cpu0MCExpr.h&#x2F;.cpp</span></a></li></ol></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="toc-number">3.</span> <span class="toc-text">4.3 文件修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MCTargetDesc-Cpu0MCTargetDesc-h-cpp"><span class="toc-number">3.0.1.</span> <span class="toc-text">(1) MCTargetDesc&#x2F;Cpu0MCTargetDesc.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CMakeLists-txt"><span class="toc-number">3.0.2.</span> <span class="toc-text">(2) CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Cpu0MCInstLower-h"><span class="toc-number">3.0.3.</span> <span class="toc-text">(3) Cpu0MCInstLower.h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-InstPrinter-Cpu0InstPrinter-cpp"><span class="toc-number">3.0.4.</span> <span class="toc-text">(4) InstPrinter&#x2F;Cpu0InstPrinter.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-MCTargetDesc-Cpu0BaseInfo-h"><span class="toc-number">3.0.5.</span> <span class="toc-text">(5) MCTargetDesc&#x2F;Cpu0BaseInfo.h</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E6%A3%80%E9%AA%8C%E6%88%90%E6%9E%9C"><span class="toc-number">4.</span> <span class="toc-text">4.4 检验成果</span></a></li></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"><img src="https://img.p2tree.top/2021/09/10/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"></a><div class="content"><a class="title" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a><time datetime="2021-09-10T17:12:50.000Z" title="发表于 2021-09-10 17:12:50">2021-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编"><img src="https://img.p2tree.top/2021/08/07/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 10：汇编"></a><div class="content"><a class="title" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a><time datetime="2021-08-07T23:15:39.000Z" title="发表于 2021-08-07 23:15:39">2021-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持"><img src="https://img.p2tree.top/2021/07/31/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 9：ELF文件支持"></a><div class="content"><a class="title" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a><time datetime="2021-07-31T23:04:26.000Z" title="发表于 2021-07-31 23:04:26">2021-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用"><img src="https://img.p2tree.top/2021/07/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 8：函数调用"></a><div class="content"><a class="title" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a><time datetime="2021-07-24T23:01:27.000Z" title="发表于 2021-07-24 23:01:27">2021-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流"><img src="https://img.p2tree.top/2021/07/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 7：控制流"></a><div class="content"><a class="title" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a><time datetime="2021-07-04T22:09:23.000Z" title="发表于 2021-07-04 22:09:23">2021-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型"><img src="https://img.p2tree.top/2021/06/19/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 6：更多数据类型"></a><div class="content"><a class="title" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a><time datetime="2021-06-19T17:15:17.000Z" title="发表于 2021-06-19 17:15:17">2021-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量"><img src="https://img.p2tree.top/2021/06/06/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 5：全局变量"></a><div class="content"><a class="title" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a><time datetime="2021-06-06T21:38:10.000Z" title="发表于 2021-06-06 21:38:10">2021-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件"><img src="https://img.p2tree.top/2021/05/11/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 4：生成目标文件"></a><div class="content"><a class="title" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a><time datetime="2021-05-11T22:18:35.000Z" title="发表于 2021-05-11 22:18:35">2021-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令"><img src="https://img.p2tree.top/2021/04/05/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 3：算术和逻辑指令"></a><div class="content"><a class="title" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a><time datetime="2021-04-05T23:24:42.000Z" title="发表于 2021-04-05 23:24:42">2021-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构"><img src="https://img.p2tree.top/2021/03/13/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 2：后端结构"></a><div class="content"><a class="title" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a><time datetime="2021-03-13T07:47:31.000Z" title="发表于 2021-03-13 07:47:31">2021-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译"><img src="https://img.p2tree.top/2021/02/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 1：新后端初始化和软件编译"></a><div class="content"><a class="title" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a><time datetime="2021-02-24T22:53:00.000Z" title="发表于 2021-02-24 22:53:00">2021-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序"><img src="https://img.p2tree.top/2021/02/22/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 0：序"></a><div class="content"><a class="title" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a><time datetime="2021-02-22T23:14:05.000Z" title="发表于 2021-02-22 23:14:05">2021-02-22</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述"><img src="https://img.p2tree.top/2025/12/5/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="计算机体系结构模拟器简述"></a><div class="content"><a class="title" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述">计算机体系结构模拟器简述</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5f95e365.html" title="桃花源记"><img src="https://img.p2tree.top/2025/10/28/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="桃花源记"></a><div class="content"><a class="title" href="/posts/5f95e365.html" title="桃花源记">桃花源记</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2024 - 2025 By <a target="_blank" rel="noopener" href="https://p2tree.top/" title="点击访问&quot;P2Tree&quot;的主页" style="margin-left:5px">P2Tree</a></span><div></div></div><div class="footer-bottom-right"><div><a class="footer-bottom-link" target="_blank" href="https://icp.hentioe.dev/sites/20255550" rel="noopener external nofollow" title="喵ICP备20255550号">喵ICP备20255550号</a><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="博客框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a><a class="footer-bottom-link" target="_blank" href="https://vercel.com/" rel="noopener external nofollow" title="undefined">Vercel</a><a class="footer-bottom-link" target="_blank" href="https://cloudflare.com/" rel="noopener external nofollow" title="undefined">CloudFlare</a><a class="footer-bottom-link" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" rel="noopener external nofollow" title="undefined">51LA</a><a class="footer-bottom-link" target="_blank" href="https://stat.p2tree.top/" rel="noopener external nofollow" title="undefined">UptimeFlare</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script></body></html>