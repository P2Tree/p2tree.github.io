<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>LLVM 后端实践笔记 10：汇编 | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这一章，我们来添加 Cpu0 的汇编功能，这包括独立汇编器和 C 语言内联汇编特性两个部分。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制"><meta property="og:type" content="article"><meta property="og:title" content="LLVM 后端实践笔记 10：汇编"><meta property="og:url" content="https://p2tree.top/posts/419cdb7c.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="这一章，我们来添加 Cpu0 的汇编功能，这包括独立汇编器和 C 语言内联汇编特性两个部分。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2021/08/07/index.webp"><meta property="article:published_time" content="2021-08-07T23:15:39.000Z"><meta property="article:modified_time" content="2021-08-07T23:15:39.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2021/08/07/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LLVM 后端实践笔记 10：汇编",
  "url": "https://p2tree.top/posts/419cdb7c.html",
  "image": "https://img.p2tree.top/2021/08/07/index.webp",
  "datePublished": "2021-08-07T23:15:39.000Z",
  "dateModified": "2021-08-07T23:15:39.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/419cdb7c.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"LLVM 后端实践笔记 10：汇编",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2021/08/07/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">LLVM 后端实践笔记 10：汇编</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LLVM 后端实践笔记 10：汇编</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-07T23:15:39.000Z" title="发表于 2021-08-07 23:15:39">2021-08-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-08-07T23:15:39.000Z" title="更新于 2021-08-07 23:15:39">2021-08-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">4.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2021-08-07 23:15:39&quot;}" hidden></div><p>这一章，我们来添加 Cpu0 的汇编功能，这包括独立汇编器和 C 语言内联汇编特性两个部分。</p><ol class="series-items"><li><a href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a></li><li><a href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a></li><li><a href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a></li><li><a href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a></li><li><a href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a></li><li><a href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a></li><li><a href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a></li><li><a href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a></li><li><a href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a></li><li><a href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a></li><li><a href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a></li><li><a href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a></li></ol><hr><h2 id="10-1-汇编器"><a href="#10-1-汇编器" class="headerlink" title="10.1 汇编器"></a>10.1 汇编器</h2><p>独立汇编器可以理解为依赖于 LLVM 后端提供的接口实现的一个独立软件，因为 LLVM 和 gcc 在这个地方的实现逻辑不一样。</p><p>在 gcc 中，编译器和汇编器是两个独立的工具，编译器，也就是 cc，只能生成汇编代码，而汇编器 as，才用来将汇编代码翻译为二进制目标代码，gcc 驱动软件 gcc 将这些工具按顺序驱动起来（还包括预处理器、链接器等），最终实现从 C 语言到二进制目标代码的功能。但是，这样的设计有个缺点，每个工具都需要先对输入文件做 parse，然后再输出时写入文件，反复多次的磁盘读写一定程度影响了编译的效率。</p><p>而在 LLVM 中，编译器后端本身就可以将中间代码（对应 gcc 中 cc 的中间表示）翻译成二进制目标文件，而不需要发射汇编代码到文件中，再重新 parse 汇编文件。当然它也可以通过配置命令行参数指定将中间代码翻译成汇编代码，方便展示底层程序逻辑。</p><p>但我们目前已经实现的这些功能，却无法支持输入汇编代码，输出二进制目标文件，虽然通常情况下已经不再需要手工编写汇编代码，但在特殊情况下，比如引导程序、调试特殊功能、需要优化性能等场合下，还是需要编写汇编代码，所以一个汇编器依然是很重要的。</p><p>显然，我们之前的章节已经把和指令相关的汇编表示都在 TableGen 中实现了，这一节中，最核心的就是实现一个汇编器的 parser，并将其注册到 LLVM 后端框架中，并使能汇编功能。并且，汇编器的核心功能在 LLVM 中也已经实现了，原理其实就是一个语法制导的翻译，我们要做的只是重写其中部分和后端架构相关的接口。</p><p>我还实现了一个额外的特性。当我们仅使用汇编器时，编译器占用的寄存器 <code>$sw</code>，就可以被释放出来当做普通寄存器用了，所以我们重新定义一下 GPROut 这个寄存器类别，并将 <code>Cpu0.td</code> 拆分成两份，将它拆分为 <code>Cpu0Asm.td</code> 和 <code>Cpu0Other.td</code>，前者会在调用汇编器时被使用到，而后者保持和之前一样的设计。</p><p>因为 <code>$sw</code> 寄存器是编译器用来记录状态的，如果只编写汇编代码，我们认为程序员有义务去维护这个寄存器中的值什么时候是有效的，进而程序员就可以在认为这个寄存器中值无效时，把它当做普通寄存器来使用。我们的标量寄存器有很多，多这样一个寄存器的意义并不是很大，这里依然这么做，其实是想展示一下 TableGen 机制的灵活性。</p><p>在 Cpu0 的后端代码路径下，新建一个子目录 AsmParser，在这个路径下新建 Cpu0AsmParser.cpp 用来实现绝大多数功能。</p><h3 id="10-1-1-文件新增"><a href="#10-1-1-文件新增" class="headerlink" title="10.1.1 文件新增"></a>10.1.1 文件新增</h3><h4 id="1-AsmParser-Cpu0AsmParser-cpp"><a href="#1-AsmParser-Cpu0AsmParser-cpp" class="headerlink" title="(1) AsmParser&#x2F;Cpu0AsmParser.cpp"></a>(1) AsmParser&#x2F;Cpu0AsmParser.cpp</h4><p>作为一个独立的功能模块，使能它的 DEBUG 信息名称为 <code>cpu0-asm-parser</code>，声明一些新的 class： <code>Cpu0AsmParser</code> 作为核心类，用来处理所有汇编 parser 的工作，我们稍后介绍；<code>Cpu0AssemblerOptions</code> 这个类用来做汇编器参数的管理；<code>Cpu0Operand</code> 类用来解析指令操作数，因为指令操作数可能有各种不同的类型，所以将这部分单独抽出来实现。</p><p>在 class 声明之后，就是 class 中成员函数的实现代码。</p><p><code>Cpu0AsmParser</code> 类继承了基类 <code>MCTargetAsmParser</code>，并重写了部分接口，而有关于汇编 parser 的详细逻辑可以参考 AsmParser.cpp 中的实现。</p><p>两个比较重要的重写函数：<code>MatchAndEmitInstruction()</code>， <code>ParseInstruction()</code> 。</p><p>汇编器在做 parser 时，要先做 Parse，然后再对符合语法规范的指令做指令匹配，前者的关键函数就是第 2 个函数 <code>ParseInstruction()</code>，后者的关键函数就是第 1 个 <code>MatchAndEmitInstruction()</code>。</p><p>在 <code>ParseInstruction()</code> 中，根据传入的词法记号，解析指令助记符存入 Operands 容器中，然后在后边依次解析每个操作数，也存入 Operands 中。对于不满足语法规范的输入，比如操作数之间缺逗号等这种问题，直接报错并退出。在解析操作数时，调用了 <code>ParseOperand()</code> 接口，这也是一个很重要的接口，专用来解析操作数，我们也重写了这个接口以适应我们的类型，尤其是地址运算符。</p><p><code>ParseInstruction()</code> 执行完毕后会返回到 <code>AsmParser.cpp</code> 中的 <code>parseStatement</code> 方法中，并在做一些分析后，再调用到 <code>MatchAndEmitInstruction()</code> 方法。</p><p>在 <code>MatchAndEmitInstruction()</code> 函数中，将 Operands 容器对象传入。首先调用 <code>MatchInstructionImpl</code> 函数，这个函数是 TableGen 参考我们的指令 td 文件生成的 Cpu0GenAsmMatcher.inc 文件自动生成的。</p><p>匹配之后如果成功了，还需要做额外的处理，如果这个是伪指令，需要汇编器展开，这种指令我们设计了几条，在之后会提到，这种指令需要调用 <code>expandInstruction()</code> 函数来展开，后者根据对应指令调用对应的展开函数，如果不是伪指令，就调用 <code>EmitInstruction()</code> 接口来发射编码，这个函数与我们前边章节设计指令输出的接口是同一个，也就是说在汇编 parser 之后的代码，是复用了之前的代码。</p><p>匹配如果失败了，则做简单处理并返回，这里我们只实现了几种简单的情况，如果你的后端有一些 TableGen 支持不了的指令形式，也可以在这里做额外的处理，不过还是尽量去依赖 TableGen 的匹配表为好。</p><p>在 <code>ParseOperand()</code> 函数中，将前边 parse 出来的 Operands 容器对象传入。首先调用 <code>MatchOperandParserImpl()</code> 函数来 parse 操作数，这个函数也是 Cpu0GenAsmMatcher.inc 文件中定义好的。如果这个函数 parse 成功，就返回， 否则继续在下边完成一些自定义的 parse 动作，在一个 switch 分支中，根据词法 token 的类型来分别处理。其中，对于 Token，可能是一个寄存器，调用 <code>tryParseRegisterOperand()</code> 函数来处理，如果没有解析成功，则按照标识符处理；对于标识符、加减运算符和数字等 Token 的情况，统一调用 <code>parseExpression()</code> 来处理；对于百分号 Token，表示可能是一个重定位信息，比如 <code>%hi($r1)</code>，则调用 <code>parseRelocOperand()</code> 函数来处理。</p><p>其他函数就不一一说明了，其中包括很多在 parse 操作数时，不同的操作数下的特殊处理，还有伪指令的展开动作，重定位操作数的格式解析以及生成重定位表达式，寄存器、立即数的 parse，还有汇编宏指令的解析（比如 <code>.macro</code>, <code>.cpload</code> 这一类）。</p><p>在最后，这些代码都实现完毕后，需要调用 <code>RegisterMCAsmParser</code> 接口将汇编 parser 注册到 LLVM 中，这个步骤写入到 <code>LLVMInitializeCpu0AsmParser()</code> 函数中。</p><h4 id="2-AsmParser-CMakeLists-txt"><a href="#2-AsmParser-CMakeLists-txt" class="headerlink" title="(2) AsmParser&#x2F;CMakeLists.txt"></a>(2) AsmParser&#x2F;CMakeLists.txt</h4><p>新增加子路径下的编译配置文件。</p><h4 id="3-AsmParser-LLVMBuild-txt"><a href="#3-AsmParser-LLVMBuild-txt" class="headerlink" title="(3) AsmParser&#x2F;LLVMBuild.txt"></a>(3) AsmParser&#x2F;LLVMBuild.txt</h4><p>同上，添加 LLVM 构建编译配置。</p><h4 id="4-Cpu0RegisterInfoGPROutForAsm-td"><a href="#4-Cpu0RegisterInfoGPROutForAsm-td" class="headerlink" title="(4) Cpu0RegisterInfoGPROutForAsm.td"></a>(4) Cpu0RegisterInfoGPROutForAsm.td</h4><p>在这个文件中，我们定义的 GPROut 类别是支持完整的 CPURegs 的。</p><h4 id="5-Cpu0RegisterInfoGPROutForOther-td"><a href="#5-Cpu0RegisterInfoGPROutForOther-td" class="headerlink" title="(5) Cpu0RegisterInfoGPROutForOther.td"></a>(5) Cpu0RegisterInfoGPROutForOther.td</h4><p>在这个文件中，我们定义的 GPROut 类别不包含 <code>$sw</code> 寄存器。</p><h4 id="6-Cpu0Asm-td"><a href="#6-Cpu0Asm-td" class="headerlink" title="(6) Cpu0Asm.td"></a>(6) Cpu0Asm.td</h4><p>由 <code>Cpu0.td</code> 拆分出来的文件，和 <code>Cpu0Other.td</code> 对应，包含了文件 <code>Cpu0RegisterInfoGPROutForAsm.td</code>。</p><h4 id="7-Cpu0Other-td"><a href="#7-Cpu0Other-td" class="headerlink" title="(7) Cpu0Other.td"></a>(7) Cpu0Other.td</h4><p>由 <code>Cpu0.td</code> 拆分出来的文件，和 <code>Cpu0Asm.td</code> 对应，包含了文件 <code>Cpu0RegisterInfoGPROutForOther.td</code>。</p><h3 id="10-1-2-文件修改"><a href="#10-1-2-文件修改" class="headerlink" title="10.1.2 文件修改"></a>10.1.2 文件修改</h3><h4 id="1-CMakeLists-txt"><a href="#1-CMakeLists-txt" class="headerlink" title="(1) CMakeLists.txt"></a>(1) CMakeLists.txt</h4><p>添加子路径的配置。同时，还需要添加一个新的 tablegen 配置项，要求 TableGen 生成 Cpu0GenAsmMatcher.inc 文件用来做汇编指令匹配。</p><h4 id="2-LLVMBuild-txt"><a href="#2-LLVMBuild-txt" class="headerlink" title="(2) LLVMBuild.txt"></a>(2) LLVMBuild.txt</h4><p>同上。</p><h4 id="3-Cpu0-td"><a href="#3-Cpu0-td" class="headerlink" title="(3) Cpu0.td"></a>(3) Cpu0.td</h4><p>删掉 Target.td、Cpu0RegisterInfo.td 文件的包含。添加汇编器 parser 在 td 中的定义，并注册到 Cpu0 的属性中。这些都是常规操作。</p><h4 id="4-Cpu0InstrFormats-td"><a href="#4-Cpu0InstrFormats-td" class="headerlink" title="(4) Cpu0InstrFormats.td"></a>(4) Cpu0InstrFormats.td</h4><p>增加针对伪指令的描述性 class，继承自 <code>Cpu0Pseudo</code> 类。</p><h4 id="5-Cpu0InstrInfo-td"><a href="#5-Cpu0InstrInfo-td" class="headerlink" title="(5) Cpu0InstrInfo.td"></a>(5) Cpu0InstrInfo.td</h4><p>增加 Operand 操作数 class 中 <code>ParserMatchClass</code> 和 <code>ParserMethod</code> 属性的描述，只有这样，td 中的操作数才会支持汇编 parse。</p><p>定义伪指令 <code>LoadImm32Reg</code>, <code>LoadAddr32Reg</code>, <code>LoadAddr32Imm</code>，这几个指令会在 <code>Cpu0AsmParser.cpp</code> 中实现对应的展开函数 <code>expandLoadImm()</code>, <code>expandLoadAddressImm</code> 和 <code>expandLoadAddressReg</code>，这些函数统一放到 <code>expandInstruction()</code> 中管理，后者在 <code>MatchAndEmitInstruction()</code> 函数中被调用。</p><h4 id="6-Cpu0RegisterInfo-td"><a href="#6-Cpu0RegisterInfo-td" class="headerlink" title="(6) Cpu0RegisterInfo.td"></a>(6) Cpu0RegisterInfo.td</h4><p>将 GPROut 的定义移动到 <code>Cpu0RegisterInfoGPROutForAsm.td</code> 和 <code>Cpu0RegisterInfoGPROutForOther.td</code> 中。</p><h3 id="10-1-3-验证结果"><a href="#10-1-3-验证结果" class="headerlink" title="10.1.3 验证结果"></a><strong>10.1.3 验证结果</strong></h3><p>这些函数的部分调用关系如下：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. ParseInstruction() -&gt; ParseOperand() -&gt; MatchOperandParserImpl() -&gt; tryCustomParseOperand() -&gt; parseMemOperand() -&gt; parseMemOffset(), tryParseRegisterOperand()</span><br><span class="line">2. MatchAndEmitInstruction() -&gt; MatchInstructionImpl(), needsExpansion(), expandInstruction()</span><br><span class="line">3. parseMemOffset() -&gt; parseRelocOperand() -&gt; getVariantKind()</span><br><span class="line">4. tryParseRegisterOperand() -&gt; tryParseRegister() -&gt; matchRegisterName() -&gt; getReg(), matchRegisterByNumber()</span><br><span class="line">5. expandInstruction() -&gt;expandLoadImm(), expandLoadAddressImm(), expandLoadAddressReg() -&gt; EmitInstruction()</span><br><span class="line">6. ParseDirective() -&gt; parseDirectiveSet() -&gt; parseSetReorderDirective(), parseSetNoReorderDirective(), parseSetMacroDirective(), parseSetNoMacroDirective() -&gt; reportParseError()</span><br></pre></td></tr></table></figure><p>编译本章第一个 case ch10_1.s，这是一个汇编文件，LLVM 的独立汇编器软件名为 llvm-mc，mc 意指 MCInstr 表示格式，它是一种比 MI 格式更底层的一种中间表示，清除很多信息，在汇编器中使用。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llvm-mc -triple=cpu0 -filetype=obj ch10_1.s -o ch10_1.o</span><br></pre></td></tr></table></figure><p>如果没有出错，那就成功汇编了，使用 llvm-objdump 工具反汇编代码来查看结果。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llvm-objdump -d ch10_1.o</span><br></pre></td></tr></table></figure><h2 id="10-2-内联汇编"><a href="#10-2-内联汇编" class="headerlink" title="10.2 内联汇编"></a>10.2 内联汇编</h2><p>当 c 程序需要直接访问特殊寄存器、指令或内存时，就需要内联汇编的支持，内联汇编允许直接在 c 程序中嵌入汇编代码，来完成机器层次级别的操作。clang 支持内联汇编，但因为汇编是后端的概念，所以内联汇编也自然需要后端来配合支持。</p><h3 id="10-2-1-简要说明"><a href="#10-2-1-简要说明" class="headerlink" title="10.2.1 简要说明"></a>10.2.1 简要说明</h3><p>一个简单的内联汇编格式是：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__asm__ __volatile__ (&quot;addu %0, %1, %2&quot;</span><br><span class="line">                      : &quot;=r&quot; (a)</span><br><span class="line">                      : &quot;r&quot; (b), &quot;r&quot; (c));</span><br></pre></td></tr></table></figure><p>其中第一行的 <code>__asm__</code> 是必须要有的，用来指明后边是内联汇编表达式；<code>__volatile__</code> 用来告诉编译器不要对这段代码做调整和优化，可以选择加上。</p><p>括号中第一行是要添加的指令，可以多行加入多个这样的字符串，用来一次性添加多条指令，指令字符串末尾不带分号；除了<code>%</code> 开头的操作数以外，其他内容要与标准汇编格式一致，<code>%</code> 开头的操作数作为占位符，会在内联汇编中用于与 c 变量或内存做绑定；这种占位符形式与下边变量的绑定是按照数字顺序依次对应，比如本例中 <code>%0</code> 对应 <code>a</code> 变量，<code>%1</code> 对应 <code>b</code> 变量。除此之外，还有一种命名绑定法，不再详细介绍。</p><p>第一个 <code>:</code> 之后的内容是输出的定义，这里的输出，包括下边的输入和 clobber list，都是用来修饰整个内联汇编块的，如果有多条指令，这里也仅表示整个指令块的输出，而不是某一条指令的输出；后边第一个字符串是操作数约束 constraint，用来描述这个操作数的类型，具体类型有很多，可以参考 gcc 标准内联汇编的格式，LLVM 采用兼容 gcc 标准内联汇编的策略，绝大多数约束保持了一致；之后小括号中的内容是 c 语言代码中的变量名，表示要绑定的变量。</p><p>第二个 <code>:</code> 之后的内容是输入的定义，与输出定义表现方式一致。</p><p>其实还可能有第三个 <code>:</code>，用来表示特殊约束 clobber，不展开介绍。</p><p>这三个 <code>:</code> 之后的内容可以选择性省略，但不能省略 <code>:</code>。</p><p>虽然内联汇编的格式挺复杂，但庆幸的是这些 parse 的工作大部分都已经由 clang 和 LLVM 完成了，clang 不需要我们做修改，凡是字符串中的内容，都会直接传给后端，而显然内联汇编的格式也依照此策略方便的隔离了前后端（意思是字符串中的内容才和后端相关，非字符串的格式由前端处理）。</p><p>我们需要做的工作在后端，主要是对一些自定义的类型、操作方式和约束做定义，如果你的后端是一个很简单的后端，甚至在这里都不需要做什么工作，LLVM 本身已经支持了很多标准操作。</p><h3 id="10-2-1-修改文件"><a href="#10-2-1-修改文件" class="headerlink" title="10.2.1 修改文件"></a>10.2.1 修改文件</h3><h4 id="1-Cpu0AsmPrinter-h-cpp"><a href="#1-Cpu0AsmPrinter-h-cpp" class="headerlink" title="(1) Cpu0AsmPrinter.h&#x2F;.cpp"></a>(1) Cpu0AsmPrinter.h&#x2F;.cpp</h4><p>重写 <code>PrintAsmOperand()</code> 函数，该函数用来指定内联汇编表达式的自定义输出样式，比如当修饰符是 <code>z</code> 时，表示这个值是一个非负立即数，我们希望在立即数为 0 时，不输出 0 而是输出 <code>$0</code>，就在这里完成。如果没有匹配到，就会调用 LLVM 内建的 <code>AsmPrinter::PrintAsmOperand()</code> 函数完成默认处理。如果没有指定约束类型，则会走到 <code>printOperand()</code> 函数打印出可能的重定位形式的汇编代码。</p><p>重写<code>PrintAsmMemoryOperand()</code> 函数，与上边同理，这个函数只负责处理内存操作的操作数。我们额外定义了我们自己的汇编格式中对内存访问的表示形式，即 <code>10($2)</code> 这种样式。</p><h4 id="2-Cpu0ISelDAGToDAG-h-cpp"><a href="#2-Cpu0ISelDAGToDAG-h-cpp" class="headerlink" title="(2) Cpu0ISelDAGToDAG.h&#x2F;.cpp"></a>(2) Cpu0ISelDAGToDAG.h&#x2F;.cpp</h4><p>这里重写了一个函数<code>SelectInlineAsmMemoryOperand()</code>，该函数用来约定内存操作数在指令选择时的动作，对于内存操作，因为其表现是重定位字符串，所以不需要在编译器这里做处理，所以直接将 OP，就是对应的 node，保存下来并返回 false，告诉 LLVM 不需要对其进行下降。</p><h4 id="3-Cpu0ISelLowering-h-cpp"><a href="#3-Cpu0ISelLowering-h-cpp" class="headerlink" title="(3) Cpu0ISelLowering.h&#x2F;.cpp"></a>(3) Cpu0ISelLowering.h&#x2F;.cpp</h4><p>除了特殊的地址操作数之外，就剩下寄存器和立即数操作数了，立即数操作数会由 LLVM 自动的依据 Cpu0GenRegisterInfo.inc 中的信息做绑定，留下特殊的立即数操作数需要我们做处理。因为立即数编码是指令中的一部分，LLVM 公共环境并不知道我们可能支持哪些宽度的立即数，所以其代码需要手动添加。</p><p>我们重写了几个函数，其中关键的一个是 <code>LowerAsmOperandForConstraint()</code> ，这个函数对所有可能的自定义的约束做处理，处理完特殊情况之后，会转到 LLVM 公共的 <code>TargetLowering::LowerAsmOperandForConstraint()</code>。</p><p>其他几个函数用来配合寄存器约束的解析，具体可以参考代码中注释。</p><p>另外，内联汇编还支持将一个操作数约束成多个可能的类型，比如一个立即数，可以约束为几个不同有效编码范围的立即数类型。后端会使用 <code>getSingleConstraintMatchWeight()</code> 函数来决定一个权重，根据权重来选择最佳匹配的类型。</p><h4 id="4-Cpu0InstrInfo-cpp"><a href="#4-Cpu0InstrInfo-cpp" class="headerlink" title="(4) Cpu0InstrInfo.cpp"></a>(4) Cpu0InstrInfo.cpp</h4><p>增加计算内联汇编指令长度的计算代码。</p><p>LLVM 中处理内联汇编的主要逻辑在 <code>TargetLowering.cpp</code> 文件中，对于我们上边几个文件中重写的接口函数都有调用，而且因为核心逻辑是标准的，只要我们不在内联汇编的代码语法上做调整，就不需要修改到公共代码。至于如寄存器类型多而导致寄存器约束多（比如可能会自定义多种向量寄存器，新建如 <code>v</code>， <code>t</code> 等约束）， 或者立即数编码形式多、内存寻址方式多，都可以在后端的上述几个函数中做调整。</p><h3 id="10-2-3-检验成果"><a href="#10-2-3-检验成果" class="headerlink" title="10.2.3 检验成果"></a>10.2.3 检验成果</h3><p>运行 ch10_2.c 的代码，其中已经编写了几种简单的内联汇编的代码。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/clang -target mips-unknown-linux-gnu -c ch10_2.c -S -emit-llvm -o ch10_2.ll</span><br></pre></td></tr></table></figure><p>检查 IR 文件。LLVM IR 也有一种特殊的内联汇编表现样式：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%1 = call i32 asm sideeffect &quot;addu $0, $1, $2&quot;, &quot;=r,r,r,~&#123;$1&#125;&quot;(i32 %0, i32 %1) #1, !srcloc !2</span><br></pre></td></tr></table></figure><p>它用 <code>asm</code> 作为一个特殊的操作节点，这个节点在后端会被当做内联汇编的块做 lowering。</p><p>编译为汇编代码：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llc -march=cpu0 -mcpu=cpu032I -relocation-model=pic -filetype=asm ch10_2.ll -o -</span><br></pre></td></tr></table></figure><p>检查汇编文件中，使用 <code>#APP</code> 和 <code>#NO_APP</code> 包含在中间的代码就是内联汇编代码。内联汇编默认的标识是 <code>#APP</code>，这个符号也可以修改。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/397262087">LLVM 后端实践笔记 10：汇编 - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/419cdb7c.html">https://p2tree.top/posts/419cdb7c.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2021/08/07/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"><img class="cover" src="https://img.p2tree.top/2021/09/10/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</div></div><div class="info-2"><div class="info-item-1">最近家里事情比较多，拖了一段时间。这个笔记已经基本完成了，还剩下最后一章，使用 simulator 来验证我们开发的编译器，我将其放到附录里，是因为它不属于开发工作，只是辅助工具。我们的 Simulator 实现了 Cpu0 的指令功能，从而可以将 hex 格式的代码文件在之上运行，并能在终端中查看运行结果。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制流LLVM 后端实践笔记 8：函数调用LLVM 后端实践笔记 9：ELF文件支持LLVM 后端实践笔记 10：汇编LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器 A.1 运行 SimulatorA.1.1 编译 Simulator我们的 Simulator 使用 Verilog 语言实现，我借用了原作者提供的代码，代码文件是 cpu0.v，需要使用...</div></div></div></a><a class="pagination-related" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持"><img class="cover" src="https://img.p2tree.top/2021/07/31/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">LLVM 后端实践笔记 9：ELF文件支持</div></div><div class="info-2"><div class="info-item-1">虽然我们的 Cpu0 模拟器只需要输入 hex 格式的编码文件就可以执行，但这一章依然介绍如何生成 ELF 文件，ELF 文件是一种通用的可执行文件、目标文件和共享库与核心转储文件标准，最早是由 System V 应用二进制接口发布，之后成为一种标准，并很快被类 Unix 操作系统接受。几乎所有支持编译的后端平台都需要生成一种可执行文件格式来执行代码，现在主流的三种可执行文件分别是 Linux 系统及裸机系统支持的 ELF 文件、Windows 系统支持的 COFF 文件以及 MacOS 系统支持的 Mach-O 文件格式。我们让 Cpu0 后端生成 ELF 文件格式。 之前章节我们介绍了 Cpu0 后端生成各种指令编码的代码，所以有关于指令编码的行为，是由 td 文件中的描述来确定的，LLVM 的公共部分已经帮我们生成了指令编码的功能。但目前还没有定义生成 ELF 文件的头部、段组成、重定位信息等内容，这一章主要实现这部分内容。 这一章，我们会使用二进制解析工具来检查 ELF 文件，比如 objdump 和 readelf 文件。需要注意的是，因为他们是 gnu 工具集的软件，...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/8a9047b8.html" title="学习LLVM数据结构：SmallSet"><img class="cover" src="https://img.p2tree.top/2025/4/27/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-27</div><div class="info-item-2">学习LLVM数据结构：SmallSet</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本系列文章以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 在现代编程语言开发中，集合（Set）是一种非常有用的数据结构，它可以高效存储唯一元素。本文介绍一种更轻量级的集合实现：SmallSet。它非常适合存储少量元素，同时保持出色的性能和内存效率。 基本介绍SmallSet 是一种小型集合类型，它实现了基本的集合操作，比如插入、删除和查找等。它的设计目标是优化在存储小规模数据时的性能和内存占用，它结合了小对象优化和动态内存调节技术，非常适合频繁访问的小集合场景。如果你已经对 SmallVector 有了解，那么 SmallSet 和它有着类似的实现思路。 llvm::SmallSet 定义在...</div></div></div></a><a class="pagination-related" href="/posts/a198516a.html" title="学习LLVM数据结构：StringRef"><img class="cover" src="https://img.p2tree.top/2025/3/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-25</div><div class="info-item-2">学习LLVM数据结构：StringRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::StringRef 定义在 llvm/ADT/StringRef.h 头文件中。 它的声明为： 1class StringRef; 和 ArrayRef 类似，StringRef 是一种轻量级的字符串引用类型，它用于实现高效地表示和操作字符串数据，尤其是在一些高频处理字符串，但同时不希望维护实际内存开销地场景下。 它是不可变引用，主要用于向函数内传递字符串同时避免深拷贝。它只包含了指向字符串的指针和字符串的长度信息，从而使得对它的操作直接而高效。 特点 轻量级：只存储一个指向字符串的指针和字符串的长度，不存储实际的数...</div></div></div></a><a class="pagination-related" href="/posts/e9ae65d7.html" title="学习LLVM数据结构：SmallVector"><img class="cover" src="https://img.p2tree.top/2025/3/9/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-09</div><div class="info-item-2">学习LLVM数据结构：SmallVector</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::SmallVector 定义在 llvm/ADT/SmallVector.h 头文件中。它的声明为： 12template&lt;typename T, unsigned N = CalculateSmallVectorDefaultInlinedElements&lt;T&gt;::value&gt; class SmallVector; llvm::SmallVector 是一个可变长数组，类似于 std::vector，同时它对较小长度的数组做了优化。它的内存管理方式采用局部缓存的设计思路，在对象内部预留一小块...</div></div></div></a><a class="pagination-related" href="/posts/cdf6959f.html" title="学习LLVM数据结构：ArrayRef"><img class="cover" src="https://img.p2tree.top/2025/2/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-25</div><div class="info-item-2">学习LLVM数据结构：ArrayRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::ArrayRef 定义在 llvm/ADT/ArrayRef.h 头文件中。它的声明为： 1template&lt;typename T&gt; class ArrayRef; llvm::ArrayRef 是一个轻量级的只读容器，主要用于引用一段连续的内存区域。它的设计目标是提供高效的数据访问，而不需要拥有底层数据的所有权。这使得 ArrayRef 特别适合在函数参数中实用，从而避免了不必要的内存拷贝。 特点 只读：ArrayRef 不能修改其引用的数据，也不能添加新元素（另一个容器 MutableArrayR...</div></div></div></a><a class="pagination-related" href="/posts/801cd0f2.html" title="LLVM 风格的 RTTI"><img class="cover" src="https://img.p2tree.top/2023/08/14/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-14</div><div class="info-item-2">LLVM 风格的 RTTI</div></div><div class="info-2"><div class="info-item-1">开头叨叨众所周知，LLVM project 没有开启 C++ 的 RTTI 特性。一个主要的原因是 LLVM project 认为 C++ RTTI 特性的实现需要使用到虚函数表，对性能并不友好。LLVM 自己实现了一种类似 RTTI 的行为。我们在开发 LLVM 代码时，尤其是需要自己搭建自定义的数据结构时，可能会想用到 RTTI，此时，学习在 LLVM 风格下如何创建类似的 API，就显得尤为重要。 什么是 RTTI难度：⭐ RTTI 是运行时类型识别，全称 Runtime Type Identification，网上有很多介绍这个的资料，属于 C++ 程序员必须要熟悉的内容。 它的主要目的是为程序运行时提供一种对对象类型的获取、操作的方式。 对应到 C++ API 上，有三个 API 会用到 RTTI： dynamic_cast，用来将一个指向基类的指针转换为一个指向派生类的指针，如果转换失败，会返回 nullptr typeid，用来返回对象类型的值 type_info，也就是 typeid 的返回类型，用来存储描述类型的信息 如果不使用这三个 API，关闭 RTTI...</div></div></div></a><a class="pagination-related" href="/posts/ab589331.html" title="LLVM New Pass Manager"><img class="cover" src="https://img.p2tree.top/2022/12/03/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-03</div><div class="info-item-2">LLVM New Pass Manager</div></div><div class="info-2"><div class="info-item-1">这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/by Arthur Eubanks（Mar 26, 2021） Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（SCC: strongly connected component）或者 loop 上。 调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。 Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominat...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">89</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E6%B1%87%E7%BC%96%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">10.1 汇编器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-%E6%96%87%E4%BB%B6%E6%96%B0%E5%A2%9E"><span class="toc-number">1.1.</span> <span class="toc-text">10.1.1 文件新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-AsmParser-Cpu0AsmParser-cpp"><span class="toc-number">1.1.1.</span> <span class="toc-text">(1) AsmParser&#x2F;Cpu0AsmParser.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-AsmParser-CMakeLists-txt"><span class="toc-number">1.1.2.</span> <span class="toc-text">(2) AsmParser&#x2F;CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-AsmParser-LLVMBuild-txt"><span class="toc-number">1.1.3.</span> <span class="toc-text">(3) AsmParser&#x2F;LLVMBuild.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Cpu0RegisterInfoGPROutForAsm-td"><span class="toc-number">1.1.4.</span> <span class="toc-text">(4) Cpu0RegisterInfoGPROutForAsm.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Cpu0RegisterInfoGPROutForOther-td"><span class="toc-number">1.1.5.</span> <span class="toc-text">(5) Cpu0RegisterInfoGPROutForOther.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-Cpu0Asm-td"><span class="toc-number">1.1.6.</span> <span class="toc-text">(6) Cpu0Asm.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-Cpu0Other-td"><span class="toc-number">1.1.7.</span> <span class="toc-text">(7) Cpu0Other.td</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-2-%E6%96%87%E4%BB%B6%E4%BF%AE%E6%94%B9"><span class="toc-number">1.2.</span> <span class="toc-text">10.1.2 文件修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-CMakeLists-txt"><span class="toc-number">1.2.1.</span> <span class="toc-text">(1) CMakeLists.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-LLVMBuild-txt"><span class="toc-number">1.2.2.</span> <span class="toc-text">(2) LLVMBuild.txt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Cpu0-td"><span class="toc-number">1.2.3.</span> <span class="toc-text">(3) Cpu0.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Cpu0InstrFormats-td"><span class="toc-number">1.2.4.</span> <span class="toc-text">(4) Cpu0InstrFormats.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-Cpu0InstrInfo-td"><span class="toc-number">1.2.5.</span> <span class="toc-text">(5) Cpu0InstrInfo.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-Cpu0RegisterInfo-td"><span class="toc-number">1.2.6.</span> <span class="toc-text">(6) Cpu0RegisterInfo.td</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-3-%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"><span class="toc-number">1.3.</span> <span class="toc-text">10.1.3 验证结果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96"><span class="toc-number">2.</span> <span class="toc-text">10.2 内联汇编</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="toc-number">2.1.</span> <span class="toc-text">10.2.1 简要说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6"><span class="toc-number">2.2.</span> <span class="toc-text">10.2.1 修改文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Cpu0AsmPrinter-h-cpp"><span class="toc-number">2.2.1.</span> <span class="toc-text">(1) Cpu0AsmPrinter.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Cpu0ISelDAGToDAG-h-cpp"><span class="toc-number">2.2.2.</span> <span class="toc-text">(2) Cpu0ISelDAGToDAG.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Cpu0ISelLowering-h-cpp"><span class="toc-number">2.2.3.</span> <span class="toc-text">(3) Cpu0ISelLowering.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Cpu0InstrInfo-cpp"><span class="toc-number">2.2.4.</span> <span class="toc-text">(4) Cpu0InstrInfo.cpp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-3-%E6%A3%80%E9%AA%8C%E6%88%90%E6%9E%9C"><span class="toc-number">2.3.</span> <span class="toc-text">10.2.3 检验成果</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"><img src="https://img.p2tree.top/2021/09/10/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"></a><div class="content"><a class="title" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a><time datetime="2021-09-10T17:12:50.000Z" title="发表于 2021-09-10 17:12:50">2021-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编"><img src="https://img.p2tree.top/2021/08/07/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 10：汇编"></a><div class="content"><a class="title" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a><time datetime="2021-08-07T23:15:39.000Z" title="发表于 2021-08-07 23:15:39">2021-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持"><img src="https://img.p2tree.top/2021/07/31/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 9：ELF文件支持"></a><div class="content"><a class="title" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a><time datetime="2021-07-31T23:04:26.000Z" title="发表于 2021-07-31 23:04:26">2021-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用"><img src="https://img.p2tree.top/2021/07/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 8：函数调用"></a><div class="content"><a class="title" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a><time datetime="2021-07-24T23:01:27.000Z" title="发表于 2021-07-24 23:01:27">2021-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流"><img src="https://img.p2tree.top/2021/07/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 7：控制流"></a><div class="content"><a class="title" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a><time datetime="2021-07-04T22:09:23.000Z" title="发表于 2021-07-04 22:09:23">2021-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型"><img src="https://img.p2tree.top/2021/06/19/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 6：更多数据类型"></a><div class="content"><a class="title" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a><time datetime="2021-06-19T17:15:17.000Z" title="发表于 2021-06-19 17:15:17">2021-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量"><img src="https://img.p2tree.top/2021/06/06/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 5：全局变量"></a><div class="content"><a class="title" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a><time datetime="2021-06-06T21:38:10.000Z" title="发表于 2021-06-06 21:38:10">2021-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件"><img src="https://img.p2tree.top/2021/05/11/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 4：生成目标文件"></a><div class="content"><a class="title" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a><time datetime="2021-05-11T22:18:35.000Z" title="发表于 2021-05-11 22:18:35">2021-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令"><img src="https://img.p2tree.top/2021/04/05/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 3：算术和逻辑指令"></a><div class="content"><a class="title" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a><time datetime="2021-04-05T23:24:42.000Z" title="发表于 2021-04-05 23:24:42">2021-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构"><img src="https://img.p2tree.top/2021/03/13/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 2：后端结构"></a><div class="content"><a class="title" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a><time datetime="2021-03-13T07:47:31.000Z" title="发表于 2021-03-13 07:47:31">2021-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译"><img src="https://img.p2tree.top/2021/02/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 1：新后端初始化和软件编译"></a><div class="content"><a class="title" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a><time datetime="2021-02-24T22:53:00.000Z" title="发表于 2021-02-24 22:53:00">2021-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序"><img src="https://img.p2tree.top/2021/02/22/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 0：序"></a><div class="content"><a class="title" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a><time datetime="2021-02-22T23:14:05.000Z" title="发表于 2021-02-22 23:14:05">2021-02-22</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述"><img src="https://img.p2tree.top/2025/12/5/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="计算机体系结构模拟器简述"></a><div class="content"><a class="title" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述">计算机体系结构模拟器简述</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5f95e365.html" title="桃花源记"><img src="https://img.p2tree.top/2025/10/28/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="桃花源记"></a><div class="content"><a class="title" href="/posts/5f95e365.html" title="桃花源记">桃花源记</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-12-23T14:20:07.744Z" title="更新于 2025-12-23 14:20:07">2025-12-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2024 - 2025 By <a target="_blank" rel="noopener" href="https://p2tree.top/" title="点击访问&quot;P2Tree&quot;的主页" style="margin-left:5px">P2Tree</a></span><div></div></div><div class="footer-bottom-right"><div><a class="footer-bottom-link" target="_blank" href="https://icp.hentioe.dev/sites/20255550" rel="noopener external nofollow" title="喵ICP备20255550号">喵ICP备20255550号</a><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="博客框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a><a class="footer-bottom-link" target="_blank" href="https://vercel.com/" rel="noopener external nofollow" title="undefined">Vercel</a><a class="footer-bottom-link" target="_blank" href="https://cloudflare.com/" rel="noopener external nofollow" title="undefined">CloudFlare</a><a class="footer-bottom-link" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" rel="noopener external nofollow" title="undefined">51LA</a><a class="footer-bottom-link" target="_blank" href="https://stat.p2tree.top/" rel="noopener external nofollow" title="undefined">UptimeFlare</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script></body></html>