<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>LLVM 目标无关代码生成器 3：机器代码描述类 | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文是一篇译文，翻译自：https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;CodeGenerator.html​llvm.org&#x2F;docs&#x2F;CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。   在高层设计中，LLVM 代码会翻译成由 MachineFunction、MachineBasicBlock 和 MachineInstr 实例组成的特定机"><meta property="og:type" content="article"><meta property="og:title" content="LLVM 目标无关代码生成器 3：机器代码描述类"><meta property="og:url" content="https://p2tree.top/posts/6e862920.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="本文是一篇译文，翻译自：https:&#x2F;&#x2F;llvm.org&#x2F;docs&#x2F;CodeGenerator.html​llvm.org&#x2F;docs&#x2F;CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。   在高层设计中，LLVM 代码会翻译成由 MachineFunction、MachineBasicBlock 和 MachineInstr 实例组成的特定机"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2020/11/25/index.webp"><meta property="article:published_time" content="2020-11-25T22:32:12.000Z"><meta property="article:modified_time" content="2020-11-25T22:32:12.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="译文"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2020/11/25/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LLVM 目标无关代码生成器 3：机器代码描述类",
  "url": "https://p2tree.top/posts/6e862920.html",
  "image": "https://img.p2tree.top/2020/11/25/index.webp",
  "datePublished": "2020-11-25T22:32:12.000Z",
  "dateModified": "2020-11-25T22:32:12.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/6e862920.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"LLVM 目标无关代码生成器 3：机器代码描述类",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2020/11/25/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">LLVM 目标无关代码生成器 3：机器代码描述类</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LLVM 目标无关代码生成器 3：机器代码描述类</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-25T22:32:12.000Z" title="发表于 2020-11-25 22:32:12">2020-11-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-25T22:32:12.000Z" title="更新于 2020-11-25 22:32:12">2020-11-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>8分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2020-11-25 22:32:12&quot;}" hidden></div><blockquote><p>本文是一篇译文，翻译自：<br><a target="_blank" rel="noopener" href="https://llvm.org/docs/CodeGenerator.html">https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html</a><br>如有问题，敬请指出。<br>转载需注明出处，若需相关专业翻译服务，可联系我。</p></blockquote><hr><p>在高层设计中，LLVM 代码会翻译成由 MachineFunction、MachineBasicBlock 和 MachineInstr 实例组成的特定机器的表示。这种表示完全是目标无关的，以最抽象的方式描述指令：操作码和操作数。这种表示被设计用来同时支持机器码的 SSA 形式以及寄存器分配后的表示（即非 SSA 形式） 。</p><ol class="series-items"><li><a href="/posts/640e5f3e.html" title="LLVM 目标无关代码生成器 1：介绍">LLVM 目标无关代码生成器 1：介绍</a></li><li><a href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类">LLVM 目标无关代码生成器 2：目标描述类</a></li><li><a href="/posts/6e862920.html" title="LLVM 目标无关代码生成器 3：机器代码描述类">LLVM 目标无关代码生成器 3：机器代码描述类</a></li><li><a href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层">LLVM 目标无关代码生成器 4：MC 层</a></li><li><a href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法">LLVM 目标无关代码生成器 5：目标无关代码生成算法</a></li><li><a href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器">LLVM 目标无关代码生成器 6：实现原生汇编器</a></li></ol><h2 id="3-1-MachineInstr-类"><a href="#3-1-MachineInstr-类" class="headerlink" title="3.1 MachineInstr 类"></a>3.1 MachineInstr 类</h2><p>目标机器指令（Machine Instruction，LLVM 后端的一种中间表示，缩写为MI ）通过 MachineInstr 的实例来描述。这个类以一种非常抽象的方式描述机器指令，特别是，它仅仅管理一个操作码和一些操作数。</p><p>操作码是一个简单的无符号整型数，只在特定后端下才有效。所有的指令都是在 <code>*InstrInfo.td</code> 文件中定义的，操作码的枚举值仅仅是依据这份描述自动生成。MachineInstr 类没有任何有关于指令意义的信息（比如这条指令的意义是什么），必须依赖于 TargetInstrInfo 类来了解。</p><p>操作数可以有多种不同类型，比如寄存器引用、常量值、basic block 引用等。另外，操作数应该被标记为 def 或 use （仅寄存器可以标记为 def ）。</p><p>按照惯例，LLVM 代码生成器将指令操作数排了序，从而让寄存器先 def 再 use，即使在那些与该排序不符的架构上也是如此。比如，在 SPARC 架构中的加法指令为：<code>add %i1, %i2, %i3</code>，其中是将 <code>%i1</code> 和 <code>%i2</code> 相加，将结果放到 <code>%i3</code> 中，在 LLVM 的代码生成器中，操作数的顺序却是 <code>%i3, %i1, %i2</code>，依然是将目的操作数放在前边。</p><p>将目的操作数放在前边有一些优势，比如，在打印 debug 信息时，可以这么输出指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%r3 = add %i1, %i2</span><br></pre></td></tr></table></figure><p>另外，如果第一个操作数是一个 def 操作数，这便很容易创建那些 def 作为第一个操作数的指令。</p><h3 id="3-1-1-使用-MachineInstrBuilder-h-函数"><a href="#3-1-1-使用-MachineInstrBuilder-h-函数" class="headerlink" title="3.1.1 使用 MachineInstrBuilder.h 函数"></a>3.1.1 使用 MachineInstrBuilder.h 函数</h3><p>机器指令（MI）由 BuildMI 函数来创建，这个函数定义在 <code>include/llvm/CodeGen/MachineInstrBuilder.h</code> 文件中。BuildMI 函数可以很容易的创建任意 MI。使用示例如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a &#x27;DestReg = mov 42&#x27; (rendered in X86 assembly as &#x27;mov DestReg, 42&#x27;)</span></span><br><span class="line"><span class="comment">// instruction and insert it at the end of the given MachineBasicBlock.</span></span><br><span class="line"><span class="type">const</span> TargetInstrInfo &amp;TII = ...</span><br><span class="line">MachineBasicBlock &amp;MBB = ...</span><br><span class="line">DebugLoc DL;</span><br><span class="line">MachineInstr *MI = <span class="built_in">BuildMI</span>(MBB, DL, TII.<span class="built_in">get</span>(X86::MOV32ri), DestReg).<span class="built_in">addImm</span>(<span class="number">42</span>);</span><br><span class="line"><span class="comment">// Create the same instr, but insert it before a specified iterator point.</span></span><br><span class="line">MachineBasicBlock::iterator MBBI = ...</span><br><span class="line"><span class="built_in">BuildMI</span>(MBB, MBBI, DL, TII.<span class="built_in">get</span>(X86::MOV32ri), DestReg).<span class="built_in">addImm</span>(<span class="number">42</span>);</span><br><span class="line"><span class="comment">// Create a &#x27;cmp Reg, 0&#x27; instruction, no destination reg.</span></span><br><span class="line">MI = <span class="built_in">BuildMI</span>(MBB, DL, TII.<span class="built_in">get</span>(X86::CMP32ri8)).<span class="built_in">addReg</span>(Reg).<span class="built_in">addImm</span>(<span class="number">42</span>);</span><br><span class="line"><span class="comment">// Create an &#x27;sahf&#x27; instruction which takes no operands and stores nothing.</span></span><br><span class="line">MI = <span class="built_in">BuildMI</span>(MBB, DL, TII.<span class="built_in">get</span>(X86::SAHF));</span><br><span class="line"><span class="comment">// Create a self looping branch instruction.</span></span><br><span class="line"><span class="built_in">BuildMI</span>(MBB, DL, TII.<span class="built_in">get</span>(X86::JNE)).<span class="built_in">addMBB</span>(&amp;MBB);</span><br></pre></td></tr></table></figure><p>如果需要新增操作数（非可选的目的寄存器），你必须显式的提出：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MI.<span class="built_in">addReg</span>(Reg, RegState::Define);</span><br></pre></td></tr></table></figure><h3 id="3-1-2-固定寄存器（预分配寄存器）"><a href="#3-1-2-固定寄存器（预分配寄存器）" class="headerlink" title="3.1.2 固定寄存器（预分配寄存器）"></a>3.1.2 固定寄存器（预分配寄存器）</h3><p>一个很重要的议题，代码生成器需要注意那些固定寄存器。特别是在指令流中，寄存器分配器必须针对一些指令将特定的寄存器安排到特定的位置上。这可能发生于一些有限制的指令（比如，X86 中只允许 EAX &#x2F; EDX 这两个寄存器完成 32 位除法操作）或者一些扩展功能，如调用约定。任何情况下，指令选择器都应该在指令需要时，发出将虚拟寄存器传入或传出物理寄存器的操作代码。</p><p>比如，在如下这段 LLVM 代码中：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define i32 @test(i32 %X, i32 %Y) &#123;</span><br><span class="line">    %Z = sdiv i32 %X, %Y</span><br><span class="line">    ret i32 %Z</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>X86 的指令选择器可能会生成以下代码：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">;; Start of div</span><br><span class="line">%EAX = mov %reg1024            ;; Copy X (in reg1024) into EAX</span><br><span class="line">%reg1027 = sar %reg1024, 31    ;; Sign extend X</span><br><span class="line">%EDX = mov %reg1027            ;; Sign extend X into EDX</span><br><span class="line">idiv %reg1025                  ;; Divide by Y (in reg1025)</span><br><span class="line">%reg1026 = mov %EAX            ;; Read the result (Z) out of EAX</span><br><span class="line"></span><br><span class="line">;; Start of ret</span><br><span class="line">%EAX = mov %reg1026            ;; 32-bit return value goes in EAX</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>寄存器分配器会合并寄存器，并删除冗余寄存器并产生以下代码：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;; X is in EAX, Y is in ECX</span><br><span class="line">mov %EAX, %EDX</span><br><span class="line">sar %EDX, 31</span><br><span class="line">idiv %ECX</span><br><span class="line">ret</span><br></pre></td></tr></table></figure><p>这种操作非常通用，它允许任何目标平台实现这种将指令流中信息在指令选择器中独立出来的操作。需要注意对于物理寄存器来说，应当尽可能缩短其生命周期，并且，在进入和退出一个 basic blocks 时（寄存器分配前），所有物理寄存器都会被假设是 dead 状态。因此，如果你需要一个能跨越 basic block 边界的值，你应该使用虚拟寄存器。</p><h3 id="3-1-3-Call-clobbered-寄存器"><a href="#3-1-3-Call-clobbered-寄存器" class="headerlink" title="3.1.3 Call-clobbered 寄存器"></a>3.1.3 Call-clobbered 寄存器</h3><p>对于一些机器指令，如 call，会影响到（clobber）大量的物理寄存器，我们使用 MO_RegisterMask 操作数来替代增加 &lt;def, dead&gt; 操作数。通过寄存器掩码来维持保留寄存器的状态，任何其他的寄存器都会被认为是会受到指令影响的。</p><h3 id="3-1-4-SSA-形式下的机器码"><a href="#3-1-4-SSA-形式下的机器码" class="headerlink" title="3.1.4 SSA 形式下的机器码"></a>3.1.4 SSA 形式下的机器码</h3><p>MI 代码在指令选择时被创建为 SSA 形式，并直到寄存器分配发生。大多数情况下，这种形式都是非常简单的，因为 LLVM 代码也是 SSA 形式，LLVM 的 PHI 节点（译注：维持 SSA 形式的重要节点）会被转换为 MI 代码的 PHI 节点，虚拟寄存器也只需要通过简单的方法来描述。</p><p>在寄存器分配之后，MI 代码不再是 SSA 形式，因为虚拟寄存器不存在了。</p><h2 id="3-2-MachineBasicBlock-类"><a href="#3-2-MachineBasicBlock-类" class="headerlink" title="3.2 MachineBasicBlock 类"></a>3.2 MachineBasicBlock 类</h2><p>MachineBasicBlock 类包含有一系列的 MI （ MachineInstr 的实例 ），它大致等效于输入到指令选择器的 LLVM 代码，但也可能存在一对多的映射（一个 LLVM basic block 对应多个 machine basic block ）。MachineBasicBlock 类中有个 getBasicBlock 方法，可以返回对应的 LLVM basic block。</p><h2 id="3-3-MachineFunction-类"><a href="#3-3-MachineFunction-类" class="headerlink" title="3.3 MachineFunction 类"></a>3.3 MachineFunction 类</h2><p>MachineFunction 类包含有一系列的 machine basic block （ MachineBasicBlock 的实例 ），它与 输入指令选择器的 LLVM 函数是一对一的映射。除了一系列的 machine basic block 以外，它还包括一个 MachineConstantPool，一个 MachineFrameInfo，一个 MachineFunctionInfo，和一个 MachineRegisterInfo。这部分代码可参见 <code>include/llvm/CodeGen/MachineFunction.h</code>。</p><h2 id="3-4-MachineInstr-Bundles"><a href="#3-4-MachineInstr-Bundles" class="headerlink" title="3.4 MachineInstr Bundles"></a>3.4 MachineInstr Bundles</h2><p>LLVM 代码生成器可以将一些指令序列看做是 MachineInstr bundles。 一个 MI bundle 可以模型化 VLIW 中包含能够并行化执行的 <strong>组&#x2F;包</strong> 结构。它也可以被用来模型化无法合法分离的顺序指令序列（可能带有数据依赖）。</p><p>概念上讲，一个 MI bundle 就是将一个 MI 和其他一些 MIs 打包在一起：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Bundle ---</span><br><span class="line">  |       \</span><br><span class="line">  |       MI</span><br><span class="line">  |       |</span><br><span class="line">  |       MI</span><br><span class="line">  |       |</span><br><span class="line">  |       MI</span><br><span class="line">  |</span><br><span class="line">Bundle ---</span><br><span class="line">  |       \</span><br><span class="line"> ...      ...</span><br></pre></td></tr></table></figure><p>MI bundle 可以不改变 MachineBasicBlock 和 MachineInstr 的物理表示，所有的 MIs （包括顶层的 MI 和其他打包的 MIs）通过序列化的列表存储。被打包的 MIs 会被标记为 bundled，每个 bundle 最顶层的 MI 用于表示为 bundle 的开始。将已打包的 MI 和单独的 MI （未参与打包）混合是合法的操作。</p><blockquote><p>译注：下文部分将 bundle 译为打包。通常也将一个 bundle 中的所有 MIs 称为该 bundle 的operands。不同后端可能会在这里有不同的实现，但在 LLVM 看来，一个 bundle 会被当做一个 MI 一样的行为来处理。</p></blockquote><p>MachineInstr 的 pass 应该将 MI bundle 当做一个单独的单元来处理。其成员方法已经知道如何处理 bundle 和 bundle 内部的 MIs。 MachineBasicBlock 迭代器也可以一次跳过整个 MI bundle （将 bundle 看做一个处理单元的效果），不过，MachineBasicBlock 也提供了一个额外的迭代器 instr_iterator，它能够忽视 bundle，对每个 MI 进行检查。bundle 中顶层的 MI 指令中必须有正确的寄存器 MachineOperand，它表示整个 bundle 中累计的输入和输出。</p><p>对支持 VLIW 架构机器中 MI 的打包操作需要在寄存器分配时完成。更明确点说，决定_哪些 MI 需要被 bundle 的工作_必须在 SSA 形式结束之后便完成（比如 two-address pass， phi 节点消除，copy coalescing ），最终的 bundle 任务应该在虚拟寄存器被物理寄存器重写之后结束（为 bundle 增加 MI，输入输出寄存器 MachineOperands）。这样就不需要为 bundle 指令添加虚拟寄存器的操作数了（避免了 use 和 def 列表翻倍 ）。bundle 可能会以虚拟寄存器和 SSA 形式存在，但这并不常见。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/312226718">LLVM 目标无关代码生成器（第三章） - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/6e862920.html">https://p2tree.top/posts/6e862920.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/%E8%AF%91%E6%96%87/">译文</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2020/11/25/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层"><img class="cover" src="https://img.p2tree.top/2020/11/28/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">LLVM 目标无关代码生成器 4：MC 层</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 MC 层被用来表示机器编码级别的代码，相比于更高层的表示形式，它去除了像常量池、跳转表、全局变量等概念。在这一层上，LLVM 处理如 Label 名称、机器指令、目标文件段信息。这一层的代码在一些阶段非常重要，比如代码生成的最后阶段（也就是写入 .s 或 .o 文件时），或者被 llvm-mc 工具用来作为独立汇编器和反汇编器使用。 这一章节描述一些很重要的类，在之后的章节，还会描述和这一层交互的其他很重要的子系统。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 4.1 MCStreamer APIMCStre...</div></div></div></a><a class="pagination-related" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类"><img class="cover" src="https://img.p2tree.top/2020/11/22/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">LLVM 目标无关代码生成器 2：目标描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标描述的类 （存放在 include&#x2F;llvm&#x2F;Target&#x2F; 路径下）提供了一套抽象的针对任意后端机器通用的描述。这些类被设计来管理一些抽象的目标属性（比如指令和寄存器），并且不夹杂任何代码生成算法的片段。 除了 DataLayout 以外，其他所有的目标描述类都需要作为基类被特定目标的描述类所继承，同时提供虚函数的实现。为了便于实现， TargetMachine 类提供了一些访问器（accessor），这些也同样需要在特定目标的描述类中实现。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/ab589331.html" title="LLVM New Pass Manager"><img class="cover" src="https://img.p2tree.top/2022/12/03/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-03</div><div class="info-item-2">LLVM New Pass Manager</div></div><div class="info-2"><div class="info-item-1">这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/by Arthur Eubanks（Mar 26, 2021） Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（SCC: strongly connected component）或者 loop 上。 调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。 Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominat...</div></div></div></a><a class="pagination-related" href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器"><img class="cover" src="https://img.p2tree.top/2020/12/09/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-09</div><div class="info-item-2">LLVM 目标无关代码生成器 6：实现原生汇编器</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 6.1 指令解析（原文未完成） 原文待完成状态 6.2 指令别名分析指令解析之后，会进入到 MatchInstructionImpl 函数。该函数实现了别名处理，之后会做真正的匹配工作。 别名分析是为了识别同样一条指令的不同文本形式，并下降到同一种指令表示。在 TableGen 中有几种不同类型的别名描述，将会在后续小节阐述，它们的顺序是从简单到复杂排好序的，一般情况下，只需要使用第一种描述方法即可，这通常是最简洁的描述方法。 6.2.1 助记符别名助记符别名的描...</div></div></div></a><a class="pagination-related" href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法"><img class="cover" src="https://img.p2tree.top/2020/12/06/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-06</div><div class="info-item-2">LLVM 目标无关代码生成器 5：目标无关代码生成算法</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 这一部分文档详细描述了前边 1.2 节 “代码生成器的高层设计” 中的概述内容。详细解释了代码生成的工作原理和设计思路。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 5.1 指令选择指令选择是 LLVM 代码生成中的一个重要步骤，它将高层的 LLVM 代码表示翻译为目标相关的机器指令。在学术界有多种不同的实现方法，LLVM 使用了基于 SelectionDAG 的指令选择器。 DAG 指令选择器的大部分内容是通过 tablegen 依赖 .td 文件生成的。我们的目标便是将这些 .td 文件生成一个完整的指令...</div></div></div></a><a class="pagination-related" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层"><img class="cover" src="https://img.p2tree.top/2020/11/28/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="info-item-2">LLVM 目标无关代码生成器 4：MC 层</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 MC 层被用来表示机器编码级别的代码，相比于更高层的表示形式，它去除了像常量池、跳转表、全局变量等概念。在这一层上，LLVM 处理如 Label 名称、机器指令、目标文件段信息。这一层的代码在一些阶段非常重要，比如代码生成的最后阶段（也就是写入 .s 或 .o 文件时），或者被 llvm-mc 工具用来作为独立汇编器和反汇编器使用。 这一章节描述一些很重要的类，在之后的章节，还会描述和这一层交互的其他很重要的子系统。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 4.1 MCStreamer APIMCStre...</div></div></div></a><a class="pagination-related" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类"><img class="cover" src="https://img.p2tree.top/2020/11/22/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-22</div><div class="info-item-2">LLVM 目标无关代码生成器 2：目标描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标描述的类 （存放在 include&#x2F;llvm&#x2F;Target&#x2F; 路径下）提供了一套抽象的针对任意后端机器通用的描述。这些类被设计来管理一些抽象的目标属性（比如指令和寄存器），并且不夹杂任何代码生成算法的片段。 除了 DataLayout 以外，其他所有的目标描述类都需要作为基类被特定目标的描述类所继承，同时提供虚函数的实现。为了便于实现， TargetMachine 类提供了一些访问器（accessor），这些也同样需要在特定目标的描述类中实现。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器...</div></div></div></a><a class="pagination-related" href="/posts/640e5f3e.html" title="LLVM 目标无关代码生成器 1：介绍"><img class="cover" src="https://img.p2tree.top/2020/11/21/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-21</div><div class="info-item-2">LLVM 目标无关代码生成器 1：介绍</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标无关代码生成器是一个软件框架，它提供了一些可重用的组件，能将 LLVM 中间表示语言翻译成特殊目标下的机器代码。这里所指的机器代码，既可以是汇编码（静态编译器组成部分），也可作为二进制机器码（通过 JIT 编译器运行）。 译注：本文中会把原文 Machine Code 翻译为机器码，但需注意，此处机器码并不表示二进制可执行文件，如 ELF 文件，Machine Code 是 LLVM 后端中 MC 层的中间表示，虽然其与二进制可执行文件有较大相似之处，但依然是两个不同的东西。若文中需要翻译为二进制可执行文件，会特殊指出。 LLVM 目标无关代码生成器由 6 个主要的组件组成： 抽象的目标描述接口：用来维护那些重要的机器特性，而不需要考虑他们的使用。这些接口存放在 include/llvm/Target/ 下。 用来做代...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">35</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-MachineInstr-%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">3.1 MachineInstr 类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-%E4%BD%BF%E7%94%A8-MachineInstrBuilder-h-%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">3.1.1 使用 MachineInstrBuilder.h 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-%E5%9B%BA%E5%AE%9A%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%88%E9%A2%84%E5%88%86%E9%85%8D%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">3.1.2 固定寄存器（预分配寄存器）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-Call-clobbered-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">3.1.3 Call-clobbered 寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-4-SSA-%E5%BD%A2%E5%BC%8F%E4%B8%8B%E7%9A%84%E6%9C%BA%E5%99%A8%E7%A0%81"><span class="toc-number">1.4.</span> <span class="toc-text">3.1.4 SSA 形式下的机器码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-MachineBasicBlock-%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">3.2 MachineBasicBlock 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-MachineFunction-%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">3.3 MachineFunction 类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-MachineInstr-Bundles"><span class="toc-number">4.</span> <span class="toc-text">3.4 MachineInstr Bundles</span></a></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器"><img src="https://img.p2tree.top/2020/12/09/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 6：实现原生汇编器"></a><div class="content"><a class="title" href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器">LLVM 目标无关代码生成器 6：实现原生汇编器</a><time datetime="2020-12-09T22:45:08.000Z" title="发表于 2020-12-09 22:45:08">2020-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法"><img src="https://img.p2tree.top/2020/12/06/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 5：目标无关代码生成算法"></a><div class="content"><a class="title" href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法">LLVM 目标无关代码生成器 5：目标无关代码生成算法</a><time datetime="2020-12-06T21:44:51.000Z" title="发表于 2020-12-06 21:44:51">2020-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层"><img src="https://img.p2tree.top/2020/11/28/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 4：MC 层"></a><div class="content"><a class="title" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层">LLVM 目标无关代码生成器 4：MC 层</a><time datetime="2020-11-28T22:16:45.000Z" title="发表于 2020-11-28 22:16:45">2020-11-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6e862920.html" title="LLVM 目标无关代码生成器 3：机器代码描述类"><img src="https://img.p2tree.top/2020/11/25/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 3：机器代码描述类"></a><div class="content"><a class="title" href="/posts/6e862920.html" title="LLVM 目标无关代码生成器 3：机器代码描述类">LLVM 目标无关代码生成器 3：机器代码描述类</a><time datetime="2020-11-25T22:32:12.000Z" title="发表于 2020-11-25 22:32:12">2020-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类"><img src="https://img.p2tree.top/2020/11/22/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 2：目标描述类"></a><div class="content"><a class="title" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类">LLVM 目标无关代码生成器 2：目标描述类</a><time datetime="2020-11-22T23:15:05.000Z" title="发表于 2020-11-22 23:15:05">2020-11-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/640e5f3e.html" title="LLVM 目标无关代码生成器 1：介绍"><img src="https://img.p2tree.top/2020/11/21/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 目标无关代码生成器 1：介绍"></a><div class="content"><a class="title" href="/posts/640e5f3e.html" title="LLVM 目标无关代码生成器 1：介绍">LLVM 目标无关代码生成器 1：介绍</a><time datetime="2020-11-21T23:21:33.000Z" title="发表于 2020-11-21 23:21:33">2020-11-21</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构"><img src="https://img.p2tree.top/2020/01/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="跟随一条指令来看LLVM的基本结构"></a><div class="content"><a class="title" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构">跟随一条指令来看LLVM的基本结构</a><time datetime="2025-12-17T14:29:57.080Z" title="更新于 2025-12-17 14:29:57">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述"><img src="https://img.p2tree.top/2025/12/5/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="计算机体系结构模拟器简述"></a><div class="content"><a class="title" href="/posts/a866e07b.html" title="计算机体系结构模拟器简述">计算机体系结构模拟器简述</a><time datetime="2025-12-17T14:29:57.079Z" title="更新于 2025-12-17 14:29:57">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-12-17T14:29:57.079Z" title="更新于 2025-12-17 14:29:57">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-12-17T14:29:57.079Z" title="更新于 2025-12-17 14:29:57">2025-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-12-17T14:29:57.079Z" title="更新于 2025-12-17 14:29:57">2025-12-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2024 - 2025 By <a target="_blank" rel="noopener" href="https://p2tree.top/" title="点击访问&quot;P2Tree&quot;的主页" style="margin-left:5px">P2Tree</a></span><div></div></div><div class="footer-bottom-right"><div><a class="footer-bottom-link" target="_blank" href="https://icp.hentioe.dev/sites/20255550" rel="noopener external nofollow" title="喵ICP备20255550号">喵ICP备20255550号</a><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="博客框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a><a class="footer-bottom-link" target="_blank" href="https://vercel.com/" rel="noopener external nofollow" title="undefined">Vercel</a><a class="footer-bottom-link" target="_blank" href="https://cloudflare.com/" rel="noopener external nofollow" title="undefined">CloudFlare</a><a class="footer-bottom-link" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" rel="noopener external nofollow" title="undefined">51LA</a><a class="footer-bottom-link" target="_blank" href="https://stat.p2tree.top/" rel="noopener external nofollow" title="undefined">UptimeFlare</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script></body></html>