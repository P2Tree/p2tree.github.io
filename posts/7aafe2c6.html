<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>TableGen 语言语法介绍 | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="LLVM目前的更新很活跃，请注意跟踪项目最新变更  如果你之前没了解过 TableGen，请先看我的另一篇文章：有关于TableGen的简单介绍  有关于TableGen语言语法的文章，LLVM官方发布有两篇：  TableGen Language Introduction​bcain-llvm.readthedocs.io&#x2F;projects&#x2F;llvm&#x2F;en&amp;#x2"><meta property="og:type" content="article"><meta property="og:title" content="TableGen 语言语法介绍"><meta property="og:url" content="https://p2tree.top/posts/7aafe2c6.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="LLVM目前的更新很活跃，请注意跟踪项目最新变更  如果你之前没了解过 TableGen，请先看我的另一篇文章：有关于TableGen的简单介绍  有关于TableGen语言语法的文章，LLVM官方发布有两篇：  TableGen Language Introduction​bcain-llvm.readthedocs.io&#x2F;projects&#x2F;llvm&#x2F;en&amp;#x2"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2020/06/06/index.webp"><meta property="article:published_time" content="2020-06-06T17:04:24.000Z"><meta property="article:modified_time" content="2020-06-06T17:04:24.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="译文"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2020/06/06/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "TableGen 语言语法介绍",
  "url": "https://p2tree.top/posts/7aafe2c6.html",
  "image": "https://img.p2tree.top/2020/06/06/index.webp",
  "datePublished": "2020-06-06T17:04:24.000Z",
  "dateModified": "2020-06-06T17:04:24.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/7aafe2c6.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"TableGen 语言语法介绍",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2020/06/06/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">TableGen 语言语法介绍</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">TableGen 语言语法介绍</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-06-06T17:04:24.000Z" title="发表于 2020-06-06 17:04:24">2020-06-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-06-06T17:04:24.000Z" title="更新于 2020-06-06 17:04:24">2020-06-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2020-06-06 17:04:24&quot;}" hidden></div><blockquote><p><strong>LLVM目前的更新很活跃，请注意跟踪项目最新变更</strong></p></blockquote><p>如果你之前没了解过 TableGen，请先看我的另一篇文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141265959">有关于TableGen的简单介绍</a></p><hr><p>有关于TableGen语言语法的文章，LLVM官方发布有两篇：</p><ul><li><a target="_blank" rel="noopener" href="https://bcain-llvm.readthedocs.io/projects/llvm/en/latest/TableGen/LangIntro/">TableGen Language Introduction​bcain-llvm.readthedocs.io&#x2F;projects&#x2F;llvm&#x2F;en&#x2F;latest&#x2F;TableGen&#x2F;LangIntro&#x2F;</a></li><li><a target="_blank" rel="noopener" href="https://releases.llvm.org/10.0.0/docs/TableGen/LangRef.html">TableGen Language Reference​releases.llvm.org&#x2F;10.0.0&#x2F;docs&#x2F;TableGen&#x2F;LangRef.html</a></li></ul><p>文章开头声明说，第一篇不是规范的参考文档，第二篇是规范的参考文档，并且两篇都有点年久失修。我把两篇都看了一下，确实感觉第二篇更规范一些，尤其是语法描述的章节，特别严谨。但是，我这里还是选择以第一篇的内容作为参考文档，主要是因为从易读性的角度来说，第一篇更容易理解（读者友好型），当然，第二篇作为参考查阅更便捷（活学活用Ctrl-f），关键在于能通过学习，掌握TableGen语言语法。</p><blockquote><p>需要说明：本文中提到的<code>记录</code>是指官方文章中的<code>record</code>，即通过<code>def</code>或<code>defm</code>等语法定义的实例化的数据对象。</p></blockquote><hr><h2 id="TableGen语法的特点"><a href="#TableGen语法的特点" class="headerlink" title="TableGen语法的特点"></a>TableGen语法的特点</h2><p>在我看来，TableGen的语法使用起来特别的灵活，但它还确实是一个强类型的语法，由于TableGen的作用只是用来描述信息，所以几乎没有控制流的语法规范，它也不关心语言本身的意义是否正确（由TableGen后端关心），它只关心语言本身的语法是否合法。它具有一些不同数据类型的定义，也支持一定程度的类型转换，数据类型范围特别宽泛。</p><p>以下介绍一下主要的语法。</p><h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>使用C++的注释风格：<code>//</code>，不过也支持C风格的嵌套注释：<code>/* */</code>。</p><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>由于它是一个强类型语言，所以我们需要在编写td文件时考虑到数据格式规范。另外，它的覆盖范围特别广，小到位类型，大到dag类型，还支持类参数类型的扩展和列表的扩展，这使得TableGen非常的灵活和易于使用。</p><p>主要类型有：</p><p>- <code>bit</code>：一位就是表示一个布尔值，比如0或者1；</p><p>- <code>int</code>：表示一个32位的整形值，比如5；</p><p>- <code>string</code>：表示一个有序的固定长度的字符序列，比如“add”；</p><p>- <code>code</code>：表示一个代码片段，可以是单行或多行，不过其实和<code>string</code>本质一样，只是展示的意义不同而已；</p><p>- <code>bits&lt;n&gt;</code>：<code>bit</code>的扩展，可以指定n个位同时赋值，比如当n&#x3D;3，可以是010，指定位模式时特别常用；</p><p>- <code>list&lt;ty&gt;</code>：很灵活的一个类型，可以保存指定ty类型的数据的列表，ty类型也可以是另一个<code>list&lt;ty&gt;</code>，可以理解是C++中的List模板类；</p><p>- <code>class</code>：指定一些类型数据的集合表示，必须用def或defm来使用这个类定义记录之后，内部数据才被分配。用来声明多个记录的共有信息，支持继承和重载等特性；</p><p>- <code>dag</code>：表示可嵌套的有向无环图元素；</p><p>原文中指出：当前这些数据类型已经足够使用，如果日后还添加其他数据类型，再另行发布（我也不知道会不会更新这篇文章，以官方为准）</p><h3 id="值和表达式"><a href="#值和表达式" class="headerlink" title="值和表达式"></a>值和表达式</h3><p>也非常灵活，有些时候，def的参数列表搞的非常长，就是因为这一部分，阅读代码会比较累，也没办法。</p><p>- <code>？</code>：未定义；</p><p>- <code>0b1001001</code>：位值，注意它的长度是固定的，它不会自动扩展或截断；</p><p>- <code>7</code>：十进制数；</p><p>- <code>0x7F</code>：十六进制数；</p><p>- <code>&quot;foo&quot;</code>：单行的字符串值，可以直接赋给<code>string</code>或<code>code</code>；</p><p>- <code>[&#123; ... &#125;]</code>：代码片段，通常用于赋给<code>code</code>，但其实就是多行字符串值；</p><p>- <code>[ X, Y, Z ]&lt;type&gt;</code>：列表，type是指定列表中元素类型，一般情况下可省略，TableGen前端能够推测类型，极少数特殊情况下需要明确指定；</p><p>- <code>&#123; a, b, 0b10 &#125;</code>：初始化<code>bits&lt;n&gt;</code>这样的类型，第一位是a变量的值，第二位是b变量的值，第三位和第四位是’0b1’ 和 ‘0b0’；</p><p>- <code>value</code>：值的引用，比如上边出现的X，Y，Z，a，b；</p><p>- <code>value&#123;17&#125;</code>：值的引用并截取一位；</p><p>- <code>value&#123;15-17&#125;</code>：值的引用并截取一部分位，<code>-</code>两边必须要连续</p><p>- <code>DEF</code>：记录的引用；</p><p>- <code>CLASS&lt;val list&gt;</code>：匿名定义的引用，<code>&lt;val list&gt;</code>是模版参数，这里是这个意思，对于一个带模版参数的类，通过指定模版参数，可以直接定义一个匿名的记录，这里就是引用这个匿名记录；</p><p>- <code>X.Y</code>：引用一个值的子域，常用在记录上；</p><p>- <code>list[4-7,17,2-3]</code>：列表片段，比如这个例子中，引用了列表list的第4、5、6、7、17、2、3这几位；</p><p>- <code>foreach &lt;var&gt; = [ &lt;list&gt; ] in &#123; &lt;body&gt; &#125;</code>：一种循环结构，依次将list中的值赋给var，并执行body体，类似于C++11中的foreach，body中仅可以包含def和defm；</p><p>- <code>foreach &lt;var&gt; = [ &lt;list&gt; ] in &lt;def&gt;</code>：同上，不同是循环体只有一条语句，不需要用<code>&#123;&#125;</code>；</p><p>- <code>foreach &lt;var&gt; = 0-15 in ...</code>：同上，不同的是循环的是整数；</p><p>- <code>foreach &lt;var&gt; = &#123;0-15,32-47&#125; in ...</code>：同上，不同的是循环的是几个整数片段；</p><p>- <code>(DEF a, b, ...)</code>：这是dag类型的表示，第一个参数<code>DEF</code>是一个记录的定义，剩下的参数可以是其他类型值，当然也包括嵌套的dag类型值，除第一个参数外，其他参数可省略；</p><p>- <code>!con(a, b, ...)</code>：将两个或多个dag类型节点连接，它们的操作码必须相同；</p><p>例子：<code>!con((op a1:$name1, a2:$name2), (op b1:$name3))</code>，等效于<code>(op a1:$name1, a2:$name2, b1:$name3)</code>。其中 a1，a2，b1 均表示接后边值的类型。</p><p>- <code>!dag(op, children, names)</code>：生成一个dag节点，children和names必须有相同的长度的列表或者是<code>?</code>，names必须是<code>list&lt;string&gt;</code>类型，children必须是常见类型的列表，children列表中的类型必须是相同的或者它们的祖先类是相同的，不支持混合的dag和non-dag；</p><p>例子：<code>!dag(op, [a1, a2, ?], [&quot;name1&quot;, &quot;name2&quot;, &quot;name3&quot;])</code>，等效于<code>(op a1:$name1, a2:$name2, ?:name3)</code>。</p><p>- <code>!listconcat(a, b, ...)</code>：将两个或多个列表合并成一个列表，这些子列表必须具有相同的子项类型；</p><p>- <code>!listsplat(a, size)</code>：将指定a列表中的子项重复包含size次；</p><p>例子：<code>!listsplat(0, 2)</code>，等效于<code>[0, 0]</code>。</p><p>- <code>!strconcat(a, b, ...)</code>：将两个或多个字符串合并成一个字符串；</p><p>- <code>!str1#str2</code>：将两个字符串合并成一个字符串，是<code>!strconcat(a, b)</code>的简化用法，如果其中有不是字符串的类型，TableGen前端会隐式调用<code>!cast&lt;string&gt;</code>操作转换为字符串类型。</p><p>- <code>!cast\&lt;type&gt;(a)</code>：强制类型转换。（注：这段我方了，没有完全理解，后边解释不用看，感兴趣的同学回去翻原文吧）如果a是字符串，而type是记录类型，那么将会通过完全检查a和所有记录之间的匹配，并确保匹配记录已经完整声明。这个完整声明的意思是，如果这个记录是在含参模版类中，那么这个记录在定义时，必须要求该类和其内部可能有的其他含参类都已指明类参数值；而如果还没有指定完整的类参数值，那么会在指定完整类参数值之后再执行这次转换，而如果没有匹配到任何记录，则会报错。若type只是简单的值类型，比如bit或int之间，或记录之间。对于记录之间的情况，cast会首先将记录转换为子类，如果类型不匹配，则不会做常量折叠。<code>!cast&lt;string&gt;</code> 是一个特殊的情况，他的参数 a 可以是一个 int 或记录类型，如果满足记录类型的转换，则会返回一个类型名；</p><p>- <code>!isa\&lt;type&gt;(a)</code>：返回布尔值，如果a是type类型，返回1，否则返回0；</p><p>- <code>!subst(a, b, c)</code>：如果a和b是字符串类型或者是引用类型，将c中的b替换为a，类似于GNU make中的<code>$(subst)</code>语法；</p><p>- <code>!foreach(a, b, c)</code>：对于b中的每一个值，将c中的b替换为a，类似于GNU make中的<code>$(foreach)</code>语法（不是 C++ 中的那个 foreach）；</p><p>- <code>!foldl(start, lst, a, b, expr)</code>：使用给定的start，对lst做left-fold操作。a和b是变量名，将在expr中被替换，如果expr视为函数<code>f(a,b)</code>，则left-fold将做这样的操作：<code>f((...f(f(start, lst[0]), lst[1]), ...), lst[n-1])</code>，循环次数取决于lst的长度n。a与start相同类型，b与lst中元素相同类型，expr和start相同类型；</p><p>- <code>!head(a)</code>：取列表a的第一个元素；</p><p>- <code>!tail(a)</code>：取列表a的最后一个元素（原文中是：The 2nd-N elements of list ‘a’，是同一个意思吗）；</p><p>- <code>!empty(a)</code>：返回布尔值，列表a是否为空；</p><p>- <code>!size(a)</code>：返回一个整数，表示列表a的元素个数；</p><p>- <code>!if(a, b, c)</code>：类似C中的三元操作符：<code>? :</code>，如果a为非0，返回b，否则返回c；</p><p>- <code>!cond(condition_1 : val1, condition_2: val2, ..., condition_n : valn)</code>：是<code>!if(a, b, c)</code>的扩展，避免多次的if嵌套。如果condition_1满足，返回val1，否则如果condition_2满足，返回val2，以此类推，如果condition_n仍然不满足，返回错误。类似于 switch；</p><p>例子：<code>!cond(!lt(x, 0) : &quot;negative&quot;, !eq(x, 0) : &quot;zero&quot;, 1 : &quot;positive&quot;)</code>，注意到最后一个条件是恒成立，避免了可能的报错。</p><p>- <code>!eq(a, b)</code>：返回布尔值，如果a和b相等，返回1，否则返回0，注意这个只对<code>string</code>、<code>int</code>和<code>bit</code>对象生效，其他类型可以尝试先做<code>!cast&lt;string&gt;</code>操作；</p><p>- <code>!ne(a, b)</code>：返回布尔值，如果a和b不相等，返回1，否则返回0，a、b取值类型同<code>!eq(a, b)</code>。</p><p>- <code>!le(a, b)</code>, <code>!lt(a, b)</code>, <code>!ge(a, b)</code>, <code>!gt(a, b)</code>：返回布尔值，分别是小于等于(little equal)，小于(little than)，大于等于(great equal)，大于(great than)，成立返回1，否则返回0；</p><p>- <code>!shl(a, b), !srl(a, b), !sra(a, b)</code>：位移操作，分别是逻辑左移(shift left logical)，逻辑右移(shift right logical)，算数右移(shift right arithmetic)。操作64位整数，如果如果移位大于63或小于0，则结果是无效的；</p><p>- <code>!add(a, b, ...)</code>, <code>!mul(a, b, ...)</code>, <code>!and(a, b, ...)</code>, <code>!or(a, b, ...)</code>：运算指令，加(add)，乘(mul)，与(and)， 或(or)</p><h3 id="类和定义"><a href="#类和定义" class="headerlink" title="类和定义"></a>类和定义</h3><p>类和定义（也叫做记录）是TableGen中最重要的信息承载类型。记录被<code>def</code>和<code>class</code>这样的关键词所描述。类还能扩展出参数模版、继承、多类等表现形式。配合值定义和<code>let</code>关键字，还可以让实现代码更简洁（甚至不需要<code>&#123;&#125;</code>来展开一个类或定义）。</p><p>一个简单的例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class C &#123; bit V <span class="operator">=</span> <span class="number">1</span><span class="comment">; &#125;</span></span><br><span class="line">def X : C<span class="comment">;</span></span><br><span class="line">def Y : C &#123;</span><br><span class="line">	string Greeting <span class="operator">=</span> <span class="string">&quot;hello&quot;</span><span class="comment">;</span></span><br></pre></td></tr></table></figure><p>这个例子中定义了两条记录：<code>X</code>和<code>Y</code>，这两条记录具有相同的信息<code>V</code>，所以用了一个类<code>C</code>来实现共有部分，同时，还扩展了记录<code>Y</code>，使它多了一个Greeting的字符串。</p><p>通常来说，类用来实现一组相似的记录中共有的部分，然后把类会单独放在一个位置，同时，类也允许在它的子类或实现中用特殊值覆盖默认值，比如可以在上例中的<code>X</code>中给<code>V</code>重新赋值。</p><h2 id="值的定义"><a href="#值的定义" class="headerlink" title="值的定义"></a>值的定义</h2><p>值的定义是记录中的内容条目，必须先定义这个值，才能在其他值定义中引用这个值，或者可以使用<code>let</code>来重置这个值。值的定义的组成结构：<code>类型 + 值名字</code>，指定值的内容可以通过在后边跟等号+值的内容来完成，需要有终止符<code>;</code>。</p><h3 id="Let表达式"><a href="#Let表达式" class="headerlink" title="Let表达式"></a>Let表达式</h3><p>记录中的Let表达式被用于改变一个记录中某个值的内容。经常在当一个类定义了值而它的子类需要覆盖这个值的时候使用。Let表达式的组成结构：<code>let + 值名字 + = + 新的值内容</code>。比如如下例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class D : C &#123; let V <span class="operator">=</span> <span class="number">0</span><span class="comment">; &#125;</span></span><br><span class="line">def Z : D<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>这个例子中，父类C中包含的V值在子类D中被重新赋值为0，而Z是D的实现，从而Z中的V值的内容为0。</p><p>需要注意的是，记录中变量的重新赋值实现的相对较晚，也就是在类内的值初始化完毕后才实现记录中的值赋值，如下例：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class A&lt;int <span class="keyword">x</span>&gt; &#123;</span><br><span class="line">	int Y <span class="operator">=</span> <span class="keyword">x</span><span class="comment">;</span></span><br><span class="line">	int Yplus<span class="number">1</span> <span class="operator">=</span> <span class="title">!add</span>(Y<span class="punctuation">,</span> <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">	int xplus<span class="number">1</span> <span class="operator">=</span> <span class="title">!add</span>(<span class="keyword">x</span><span class="punctuation">,</span> <span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def Z : A&lt;<span class="number">5</span>&gt; &#123;</span><br><span class="line">	let Y <span class="operator">=</span> <span class="number">10</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个例子中，Z.xplus1的内容是6，而Z.Yplus1的内容是11，这是因为类A中先将所有x替换为5，然后将Y&#x3D;5，然后才执行Let表达式，将Y&#x3D;10。使用这种语法时要谨慎，多用<code>llvm-tblgen</code>去测试。</p><p>另外，在<code>multiclass</code>中，也可以使用Let表达式，尤其是在多层的<code>multiclass</code>中，这使得TableGen的语法更为灵活。有关于<code>multiclass</code>的语法下文中会讲到。</p><h2 id="类模版参数"><a href="#类模版参数" class="headerlink" title="类模版参数"></a>类模版参数</h2><p>TableGen提供了这种含参类的功能，允许给类传参。模版类中的值是在实现记录时绑定的。比如下边例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class FPFormat&lt;bits&lt;<span class="number">3</span>&gt; val&gt; &#123;</span><br><span class="line">	bits&lt;<span class="number">3</span>&gt; Value <span class="operator">=</span> val<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def NotFP 		 : FPFormat&lt;<span class="number">0</span>&gt;<span class="comment">;</span></span><br><span class="line">def ZeroFP 		 : FPFormat&lt;<span class="number">1</span>&gt;<span class="comment">;</span></span><br><span class="line">def OneArgFP   : FPFormat&lt;<span class="number">2</span>&gt;<span class="comment">;</span></span><br><span class="line">def OneArgFPRW : FPFormat&lt;<span class="number">3</span>&gt;<span class="comment">;</span></span><br><span class="line">def TwoArgFP   : FPFormat&lt;<span class="number">4</span>&gt;<span class="comment">;</span></span><br><span class="line">def CompareFP  : FPFormat&lt;<span class="number">5</span>&gt;<span class="comment">;</span></span><br><span class="line">def CondMovFP  : FPFormat&lt;<span class="number">6</span>&gt;<span class="comment">;</span></span><br><span class="line">def SpecialFP  : FPFormat&lt;<span class="number">7</span>&gt;<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>这个例子中，实现了一个类似enum的模式，不同的记录中的Value值不同。</p><p>在下边的例子中，实现更为灵活：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class ModRefVal&lt;bits&lt;<span class="number">2</span>&gt; val&gt; &#123;</span><br><span class="line">  bits&lt;<span class="number">2</span>&gt; Value <span class="operator">=</span> val<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def None   : ModRefVal&lt;<span class="number">0</span>&gt;<span class="comment">;</span></span><br><span class="line">def Mod    : ModRefVal&lt;<span class="number">1</span>&gt;<span class="comment">;</span></span><br><span class="line">def Ref    : ModRefVal&lt;<span class="number">2</span>&gt;<span class="comment">;</span></span><br><span class="line">def ModRef : ModRefVal&lt;<span class="number">3</span>&gt;<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">class Value&lt;ModRefVal MR&gt; &#123;</span><br><span class="line">  // Decode some information into a more convenient format<span class="punctuation">,</span> while providing</span><br><span class="line">  // a nice interface <span class="keyword">to</span> the user of the <span class="string">&quot;Value&quot;</span> class.</span><br><span class="line">  bit isMod <span class="operator">=</span> MR.Value&#123;<span class="number">0</span>&#125;<span class="comment">;</span></span><br><span class="line">  bit isRef <span class="operator">=</span> MR.Value&#123;<span class="number">1</span>&#125;<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">  // other stuff...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Example uses</span><br><span class="line">def bork : Value&lt;Mod&gt;<span class="comment">;</span></span><br><span class="line">def zork : Value&lt;Ref&gt;<span class="comment">;</span></span><br><span class="line">def hork : Value&lt;ModRef&gt;<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>通过<code>llvm-tblgen</code>工具测试这个代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ llvm-tblgen --print-records example.td</span><br></pre></td></tr></table></figure><p>得到结果如下：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def bork &#123;      // Value</span><br><span class="line">  bit isMod <span class="operator">=</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">  bit isRef <span class="operator">=</span> <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def hork &#123;      // Value</span><br><span class="line">  bit isMod <span class="operator">=</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">  bit isRef <span class="operator">=</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def zork &#123;      // Value</span><br><span class="line">  bit isMod <span class="operator">=</span> <span class="number">0</span><span class="comment">;</span></span><br><span class="line">  bit isRef <span class="operator">=</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可见，TableGen可以展开所有记录的内容，并显示给开发者检查。</p><h2 id="multiclass定义和实例化"><a href="#multiclass定义和实例化" class="headerlink" title="multiclass定义和实例化"></a><code>multiclass</code>定义和实例化</h2><p><code>multiclass</code>并不是指多个类，而是指用一个类结构来实现多个类的功能。简单来说，就是带参数的类，如果有两个或多个记录具有一组相同的公共属性，那么用多类来声明这组属性，可以一定程度上减少代码量，也使得代码结构更加清晰。比方说，经常见到的3地址指令，第3个操作数可能是寄存器或者是立即数，这样我们就能用一个<code>multiclass</code>来实现3地址指令模版的共有部分，然后用一个<code>defm</code>来定义这两种不同的指令模式。示例如下：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def ops<span class="comment">;</span></span><br><span class="line">def GPR<span class="comment">;</span></span><br><span class="line">def Imm<span class="comment">;</span></span><br><span class="line">class inst&lt;int opc<span class="punctuation">,</span> string asmstr<span class="punctuation">,</span> dag operandlist&gt;<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">multiclass ri_inst&lt;int opc<span class="punctuation">,</span> string asmstr&gt; &#123;</span><br><span class="line">  def _rr : inst&lt;opc<span class="punctuation">,</span> <span class="title">!strconcat</span>(asmstr<span class="punctuation">,</span> <span class="string">&quot; $dst, $src1, $src2&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">                 (ops GPR:$dst<span class="punctuation">,</span> GPR:$src<span class="number">1</span><span class="punctuation">,</span> GPR:$src<span class="number">2</span>)&gt;<span class="comment">;</span></span><br><span class="line">  def _ri : inst&lt;opc<span class="punctuation">,</span> <span class="title">!strconcat</span>(asmstr<span class="punctuation">,</span> <span class="string">&quot; $dst, $src1, $src2&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">                 (ops GPR:$dst<span class="punctuation">,</span> GPR:$src<span class="number">1</span><span class="punctuation">,</span> Imm:$src<span class="number">2</span>)&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Instantiations of the ri_inst multiclass.</span><br><span class="line">defm ADD : ri_inst&lt;<span class="number">0</span>b<span class="number">111</span><span class="punctuation">,</span> <span class="string">&quot;add&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">defm SUB : ri_inst&lt;<span class="number">0</span>b<span class="number">101</span><span class="punctuation">,</span> <span class="string">&quot;sub&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">defm MUL : ri_inst&lt;<span class="number">0</span>b<span class="number">100</span><span class="punctuation">,</span> <span class="string">&quot;mul&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>最终的记录的名字是由<code>defm</code>后边的名字和<code>multiclass</code>中<code>def</code>关键字后边的名字拼接而成的，也就是实际上定义了ADD_rr、ADD_ri、SUB_rr、SUB_ri、MUL_rr、MUL_ri等指令。<code>defm</code>可以实现多个<code>multiclass</code>，最终的实现会比较复杂些，不过也好理解。比如下边这个例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Instruction&lt;bits&lt;<span class="number">4</span>&gt; opc<span class="punctuation">,</span> string Name&gt; &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> opc<span class="comment">;</span></span><br><span class="line">  string name <span class="operator">=</span> Name<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiclass basic_r&lt;bits&lt;<span class="number">4</span>&gt; opc&gt; &#123;</span><br><span class="line">  def rm : Instruction&lt;opc<span class="punctuation">,</span> <span class="string">&quot;rm&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">  def rr : Instruction&lt;opc<span class="punctuation">,</span> <span class="string">&quot;rr&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiclass basic_s&lt;bits&lt;<span class="number">4</span>&gt; opc&gt; &#123;</span><br><span class="line">  defm SD : basic_r&lt;opc&gt;<span class="comment">;</span></span><br><span class="line">  defm SS : basic_r&lt;opc&gt;<span class="comment">;</span></span><br><span class="line">  def X : Instruction&lt;opc<span class="punctuation">,</span> <span class="string">&quot;x&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiclass basic_p&lt;bits&lt;<span class="number">4</span>&gt; opc&gt; &#123;</span><br><span class="line">  defm PD : basic_r&lt;opc&gt;<span class="comment">;</span></span><br><span class="line">  defm PS : basic_r&lt;opc&gt;<span class="comment">;</span></span><br><span class="line">  def Y : Instruction&lt;opc<span class="punctuation">,</span> <span class="string">&quot;y&quot;</span>&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defm ADD :  basic_p&lt;<span class="number">0xf</span>&gt;<span class="punctuation">,</span> basic_s&lt;<span class="number">0xf</span>&gt;<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>实际上定义的是：ADDPDrm、ADDPDrr、ADDPSrm、ADDPSrr、ADDSDrm、ADDSDrr、ADDSSrm、ADDSSrr、ADDY、ADDX这几个指令。</p><p>类似的，<code>defm</code>在实现多个类时，可以即有<code>multiclass</code>也有<code>class</code>，但必须至少有一个<code>multiclass</code>，且所有<code>class</code>的列表必须在<code>multiclass</code>后边。这种写法下，<code>class</code>的内容是和<code>multiclass</code>合并起来的。如下边的例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class XD &#123; bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> <span class="number">11</span><span class="comment">; &#125;</span></span><br><span class="line">class XS &#123; bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> <span class="number">12</span><span class="comment">; &#125;</span></span><br><span class="line"></span><br><span class="line">class I&lt;bits&lt;<span class="number">4</span>&gt; op&gt; &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> op<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiclass R &#123;</span><br><span class="line">  def rm : I&lt;<span class="number">2</span>&gt;<span class="comment">;</span></span><br><span class="line">  def rr : I&lt;<span class="number">4</span>&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multiclass Y &#123;</span><br><span class="line">  defm SD : R<span class="punctuation">,</span> XS<span class="comment">;</span></span><br><span class="line">  defm SS : R<span class="punctuation">,</span> XD<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defm Instr : Y<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>实际上定义的结果是：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">def InstrSDrm &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> &#123; <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> &#123; <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def InstrSDrr &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> &#123; <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> &#123; <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def InstrSSrm &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> &#123; <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> &#123; <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span> &#125;<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">def InstrSSrr &#123;</span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; opcode <span class="operator">=</span> &#123; <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span> &#125;<span class="comment">;</span></span><br><span class="line">  bits&lt;<span class="number">4</span>&gt; Prefix <span class="operator">=</span> &#123; <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span> &#125;<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果有多个<code>multiclass</code>和一个<code>class</code>，那么这个<code>class</code>的内容会合并到每个<code>multiclass</code>中；如果有多个<code>class</code>，则所有的<code>class</code>的内容合并起来，再合并到每个<code>multiclass</code>中；如果<code>class</code>、<code>multiclass</code>中出现相同属性，则以后边最后一个的值为准。</p><p>总之，语言规范就放在那里，自己的td写的越复杂，只会给自己和团队带来更多的理解难度，我的建议时，<code>multiclass</code>是很便捷的东西，应该尽量使用，但不要过度使用。TableGen的灵活性比较大，我觉得这是一个原因。</p><h2 id="文件相关"><a href="#文件相关" class="headerlink" title="文件相关"></a>文件相关</h2><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>TableGen支持<code>include</code>关键字，能够扩展其他的td文件到当前的td文件中，和C系的文件包含意思一样。要包含的文件名用<code>&quot;&quot;</code>包含。比如：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&quot;foo.td&quot;</span></span><br></pre></td></tr></table></figure><p>需要注意的是，没有<code>#</code>开头，因为TableGen里边没有C系的预处理概念。</p><h3 id="Let表达式-1"><a href="#Let表达式-1" class="headerlink" title="Let表达式"></a>Let表达式</h3><p>Let表达式在文件中的作用和在记录中的作用基本相同，不同的是，文件中的let表达式可以有多个值来绑定多个记录，它是另一种能够提取记录的公共部分的一种方式。</p><p>下边是一个例子：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">let isTerminator <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> isReturn <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> isBarrier <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hasCtrlDep <span class="operator">=</span> <span class="number">1</span> in</span><br><span class="line">  def RET : I&lt;<span class="number">0xC3</span><span class="punctuation">,</span> RawFrm<span class="punctuation">,</span> (outs)<span class="punctuation">,</span> (ins)<span class="punctuation">,</span> <span class="string">&quot;ret&quot;</span><span class="punctuation">,</span> [(X<span class="number">86</span>retflag <span class="number">0</span>)]&gt;<span class="comment">;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line">let isCall <span class="operator">=</span> <span class="number">1</span> in</span><br><span class="line">  // All calls clobber the non-callee saved registers...</span><br><span class="line">  let Defs <span class="operator">=</span> [EAX<span class="punctuation">,</span> ECX<span class="punctuation">,</span> EDX<span class="punctuation">,</span> FP<span class="number">0</span><span class="punctuation">,</span> FP<span class="number">1</span><span class="punctuation">,</span> FP<span class="number">2</span><span class="punctuation">,</span> FP<span class="number">3</span><span class="punctuation">,</span> FP<span class="number">4</span><span class="punctuation">,</span> FP<span class="number">5</span><span class="punctuation">,</span> FP<span class="number">6</span><span class="punctuation">,</span> ST<span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              MM<span class="number">0</span><span class="punctuation">,</span> MM<span class="number">1</span><span class="punctuation">,</span> MM<span class="number">2</span><span class="punctuation">,</span> MM<span class="number">3</span><span class="punctuation">,</span> MM<span class="number">4</span><span class="punctuation">,</span> MM<span class="number">5</span><span class="punctuation">,</span> MM<span class="number">6</span><span class="punctuation">,</span> MM<span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">              XMM<span class="number">0</span><span class="punctuation">,</span> XMM<span class="number">1</span><span class="punctuation">,</span> XMM<span class="number">2</span><span class="punctuation">,</span> XMM<span class="number">3</span><span class="punctuation">,</span> XMM<span class="number">4</span><span class="punctuation">,</span> XMM<span class="number">5</span><span class="punctuation">,</span> XMM<span class="number">6</span><span class="punctuation">,</span> XMM<span class="number">7</span><span class="punctuation">,</span> EFLAGS] in &#123;</span><br><span class="line">    def CALLpcrel<span class="number">32</span> : Ii<span class="number">32</span>&lt;<span class="number">0xE8</span><span class="punctuation">,</span> RawFrm<span class="punctuation">,</span> (outs)<span class="punctuation">,</span> (ins i<span class="number">32</span>imm:$dst<span class="punctuation">,</span>variable_ops)<span class="punctuation">,</span> <span class="string">&quot;call\t$&#123;dst:call&#125;&quot;</span><span class="punctuation">,</span> []&gt;<span class="comment">;</span></span><br><span class="line">    def CALL<span class="number">32</span>r     : I&lt;<span class="number">0xFF</span><span class="punctuation">,</span> MRM<span class="number">2</span>r<span class="punctuation">,</span> (outs)<span class="punctuation">,</span> (ins GR<span class="number">32</span>:$dst<span class="punctuation">,</span> variable_ops)<span class="punctuation">,</span> <span class="string">&quot;call\t&#123;*&#125;$dst&quot;</span><span class="punctuation">,</span> [(X<span class="number">86</span><span class="keyword">call</span> GR<span class="number">32</span>:$dst)]&gt;<span class="comment">;</span></span><br><span class="line">    def CALL<span class="number">32</span>m     : I&lt;<span class="number">0xFF</span><span class="punctuation">,</span> MRM<span class="number">2</span>m<span class="punctuation">,</span> (outs)<span class="punctuation">,</span> (ins i<span class="number">32</span>mem:$dst<span class="punctuation">,</span> variable_ops)<span class="punctuation">,</span> <span class="string">&quot;call\t&#123;*&#125;$dst&quot;</span><span class="punctuation">,</span> []&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>能注意到，这个文件内的let表达式，使用<code>let ... in &#123; ... &#125;</code>的语法，把多个记录包含在大括号内。Let表达式在文件内经常用于在一系列的记录中增加一些定义，这些记录不需要被展开，就像上例中，那几个CALL指令，没有展开即加入了isCall&#x3D;1和Defs&#x3D;[…]的定义属性。</p><h2 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h2><p>TableGen支持循环模块<code>foreach</code>，可以做循环操作，例如：</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foreach i <span class="operator">=</span> [<span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span>] in &#123;</span><br><span class="line">  def R#i : Register&lt;...&gt;<span class="comment">;</span></span><br><span class="line">  def F#i : Register&lt;...&gt;<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>经过4次循环，分别定义了：R0、R1、R2、R3、F0、F1、F2、F3。</p><p>如果循环体只有一个表达式，可以省略<code>&#123;&#125;</code>。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/146334289">TableGen 语言语法介绍 - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/7aafe2c6.html">https://p2tree.top/posts/7aafe2c6.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/%E8%AF%91%E6%96%87/">译文</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2020/06/06/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/afa1097f.html" title="近君子而远小人"><img class="cover" src="https://img.p2tree.top/2020/06/07/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">近君子而远小人</div></div><div class="info-2"><div class="info-item-1">君子与小人在《论语》中，君子和小人指品德高尚性情文雅的人和徇私舞弊品行低劣的人，现在也沿用了这一种解释。 虽然我们不能以极端的态度去评价人，去决定哪个人是君子，哪个人是小人，但我们可以判断哪些人像君子，哪些人像小人。 所谓之，心诚求之，虽不中，不远矣。内心倾向于君子品行的人，其本身就不远于君子，而相反，其不远于小人。 我的生活中，大多数人都是非常优秀和善良的人，我也以诚待人，并乐在其中，故而从没有认真看待过那些极少数不善良、人品差的人，甚至自己从没有意识到，自己身边也会存在这样的人。 如何辨别君子与小人孔子说过，君子坦荡荡，小人长戚戚。 这是我发生这件事后，体会最大的一句话，君子做事坦坦荡荡，胸襟开阔，乐观随性，明辨得失，敢于承担自己的错误但也坚定自己正确的信心，做高尚善良的事，不怕无端议论和恶意诽谤；小人做事唯唯诺诺，患得患失，牟取别人的成果满足自己的利益。 孔子还说：君子求诸己，小人求诸人。 这句话的意思是，出了问题，有了矛盾，君子首先想到的是自己哪里没有做对，哪里需要改善，改进缺点不断进步；小人永远不会检讨自己，只会从别人身上找原因，甩锅给其他人，甩锅给集体和社会，一切问题...</div></div></div></a><a class="pagination-related" href="/posts/11f2b3dc.html" title="Effective C++ 学习笔记 2：构造、析构、赋值运算"><img class="cover" src="https://img.p2tree.top/2020/06/02/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Effective C++ 学习笔记 2：构造、析构、赋值运算</div></div><div class="info-2"><div class="info-item-1">Effective C++ 学习笔记 1：让自己习惯 C++Effective C++ 学习笔记 2：构造、析构、赋值运算Effective C++ 学习笔记 3：资源管理Effective C++ 学习笔记 4：设计与声明Effective C++ 学习笔记 5：实现Effective C++ 学习笔记 6：继承与面向对象设计Effective C++ 学习笔记 7：模板与泛型编程Effective C++ 学习笔记 8：定制 new 和 deleteEffective C++ 学习笔记 9：杂项讨论 条款 05：了解 C++ 默默编写并调用哪些函数Know what functions C++ silently writes and calls. C++ 中，空类并不是空的。 如果你没有指定构造函数，编译器会自动生成 default 构造函数，如果没有指定 copy 构造函数、copy 赋值操作符和析构函数，编译器也会自动生成空的版本（C++11 中还增加了移动构造函数和移动赋值运算符函数）。这几个自动生成的函数是 public 和 inline 的，析构函数是非 virt...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/ab589331.html" title="LLVM New Pass Manager"><img class="cover" src="https://img.p2tree.top/2022/12/03/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-03</div><div class="info-item-2">LLVM New Pass Manager</div></div><div class="info-2"><div class="info-item-1">这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/by Arthur Eubanks（Mar 26, 2021） Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（SCC: strongly connected component）或者 loop 上。 调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。 Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominat...</div></div></div></a><a class="pagination-related" href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器"><img class="cover" src="https://img.p2tree.top/2020/12/09/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-09</div><div class="info-item-2">LLVM 目标无关代码生成器 6：实现原生汇编器</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 6.1 指令解析（原文未完成） 原文待完成状态 6.2 指令别名分析指令解析之后，会进入到 MatchInstructionImpl 函数。该函数实现了别名处理，之后会做真正的匹配工作。 别名分析是为了识别同样一条指令的不同文本形式，并下降到同一种指令表示。在 TableGen 中有几种不同类型的别名描述，将会在后续小节阐述，它们的顺序是从简单到复杂排好序的，一般情况下，只需要使用第一种描述方法即可，这通常是最简洁的描述方法。 6.2.1 助记符别名助记符别名的描...</div></div></div></a><a class="pagination-related" href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法"><img class="cover" src="https://img.p2tree.top/2020/12/06/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-06</div><div class="info-item-2">LLVM 目标无关代码生成器 5：目标无关代码生成算法</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 这一部分文档详细描述了前边 1.2 节 “代码生成器的高层设计” 中的概述内容。详细解释了代码生成的工作原理和设计思路。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 5.1 指令选择指令选择是 LLVM 代码生成中的一个重要步骤，它将高层的 LLVM 代码表示翻译为目标相关的机器指令。在学术界有多种不同的实现方法，LLVM 使用了基于 SelectionDAG 的指令选择器。 DAG 指令选择器的大部分内容是通过 tablegen 依赖 .td 文件生成的。我们的目标便是将这些 .td 文件生成一个完整的指令...</div></div></div></a><a class="pagination-related" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层"><img class="cover" src="https://img.p2tree.top/2020/11/28/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="info-item-2">LLVM 目标无关代码生成器 4：MC 层</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 MC 层被用来表示机器编码级别的代码，相比于更高层的表示形式，它去除了像常量池、跳转表、全局变量等概念。在这一层上，LLVM 处理如 Label 名称、机器指令、目标文件段信息。这一层的代码在一些阶段非常重要，比如代码生成的最后阶段（也就是写入 .s 或 .o 文件时），或者被 llvm-mc 工具用来作为独立汇编器和反汇编器使用。 这一章节描述一些很重要的类，在之后的章节，还会描述和这一层交互的其他很重要的子系统。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 4.1 MCStreamer APIMCStre...</div></div></div></a><a class="pagination-related" href="/posts/6e862920.html" title="LLVM 目标无关代码生成器 3：机器代码描述类"><img class="cover" src="https://img.p2tree.top/2020/11/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-25</div><div class="info-item-2">LLVM 目标无关代码生成器 3：机器代码描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 在高层设计中，LLVM 代码会翻译成由 MachineFunction、MachineBasicBlock 和 MachineInstr 实例组成的特定机器的表示。这种表示完全是目标无关的，以最抽象的方式描述指令：操作码和操作数。这种表示被设计用来同时支持机器码的 SSA 形式以及寄存器分配后的表示（即非 SSA 形式） 。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 3.1 MachineInstr 类目标机器指令（Machine Instruction，LLVM 后端的一种中间表示，缩写为MI ）通过 M...</div></div></div></a><a class="pagination-related" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类"><img class="cover" src="https://img.p2tree.top/2020/11/22/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-22</div><div class="info-item-2">LLVM 目标无关代码生成器 2：目标描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标描述的类 （存放在 include&#x2F;llvm&#x2F;Target&#x2F; 路径下）提供了一套抽象的针对任意后端机器通用的描述。这些类被设计来管理一些抽象的目标属性（比如指令和寄存器），并且不夹杂任何代码生成算法的片段。 除了 DataLayout 以外，其他所有的目标描述类都需要作为基类被特定目标的描述类所继承，同时提供虚函数的实现。为了便于实现， TargetMachine 类提供了一些访问器（accessor），这些也同样需要在特定目标的描述类中实现。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#TableGen%E8%AF%AD%E6%B3%95%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.</span> <span class="toc-text">TableGen语法的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E9%87%8A"><span class="toc-number">1.1.</span> <span class="toc-text">注释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E5%92%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">值和表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%92%8C%E5%AE%9A%E4%B9%89"><span class="toc-number">1.4.</span> <span class="toc-text">类和定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%BC%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text">值的定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Let%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">Let表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E6%A8%A1%E7%89%88%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">类模版参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multiclass%E5%AE%9A%E4%B9%89%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">multiclass定义和实例化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">5.</span> <span class="toc-text">文件相关</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">5.1.</span> <span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Let%E8%A1%A8%E8%BE%BE%E5%BC%8F-1"><span class="toc-number">5.2.</span> <span class="toc-text">Let表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF"><span class="toc-number">6.</span> <span class="toc-text">循环</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-10-27T15:00:31.517Z" title="更新于 2025-10-27 15:00:31">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-10-27T15:00:31.517Z" title="更新于 2025-10-27 15:00:31">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-10-27T15:00:31.517Z" title="更新于 2025-10-27 15:00:31">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构"><img src="https://img.p2tree.top/2020/01/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="跟随一条指令来看LLVM的基本结构"></a><div class="content"><a class="title" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构">跟随一条指令来看LLVM的基本结构</a><time datetime="2025-10-27T15:00:31.517Z" title="更新于 2025-10-27 15:00:31">2025-10-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8a9047b8.html" title="学习LLVM数据结构：SmallSet"><img src="https://img.p2tree.top/2025/4/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="学习LLVM数据结构：SmallSet"></a><div class="content"><a class="title" href="/posts/8a9047b8.html" title="学习LLVM数据结构：SmallSet">学习LLVM数据结构：SmallSet</a><time datetime="2025-10-27T15:00:31.516Z" title="更新于 2025-10-27 15:00:31">2025-10-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2024 - 2025 By <a target="_blank" rel="noopener" href="https://p2tree.top/" title="点击访问&quot;P2Tree&quot;的主页" style="margin-left:5px">P2Tree</a></span><div></div></div><div class="footer-bottom-right"><div><a class="footer-bottom-link" target="_blank" href="https://icp.hentioe.dev/sites/20255550" rel="noopener external nofollow" title="喵ICP备20255550号">喵ICP备20255550号</a><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="博客框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a><a class="footer-bottom-link" target="_blank" href="https://vercel.com/" rel="noopener external nofollow" title="undefined">Vercel</a><a class="footer-bottom-link" target="_blank" href="https://cloudflare.com/" rel="noopener external nofollow" title="undefined">CloudFlare</a><a class="footer-bottom-link" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" rel="noopener external nofollow" title="undefined">51LA</a><a class="footer-bottom-link" target="_blank" href="https://stat.p2tree.top/" rel="noopener external nofollow" title="undefined">UptimeFlare</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script><script data-pjax>function butterfly_swiper_injector_config(){var t=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/73fc32a.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2023/10/14/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-14</span><a class="blog-slider__title" href="posts/73fc32a.html" alt="">Vim 高效编辑技巧</a><div class="blog-slider__text">绝对是全网都没有的 Vim 使用硬干货经验</div><a class="blog-slider__button" href="posts/73fc32a.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/4b2442c5.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2021/02/22/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-02-22</span><a class="blog-slider__title" href="posts/4b2442c5.html" alt="">LLVM 后端实践笔记 0：序</a><div class="blog-slider__text">LLVM 后端学习的系列教程，这是第一集，必读起跑线</div><a class="blog-slider__button" href="posts/4b2442c5.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/e8d522db.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/05/wechat_logo.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-05</span><a class="blog-slider__title" href="posts/e8d522db.html" alt="">微信公众号 P2Tree</a><div class="blog-slider__text">我维护的微信公众号，欢迎来交个朋友</div><a class="blog-slider__button" href="posts/e8d522db.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/b32e3378.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/23/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="posts/b32e3378.html" alt="">个人说明书 v2.2.4</a><div class="blog-slider__text">这份个人说明书，记录着我的基本信息和所思所想，希望能以最快的方式介绍我自己</div><a class="blog-slider__button" href="posts/b32e3378.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="/about/,/tags/,/categories/,/draft/".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script></body></html>