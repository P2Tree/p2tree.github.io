<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>LLVM New Pass Manager | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https:&#x2F;&#x2F;blog.llvm.org&#x2F;posts&#x2F;2021-03-26-the-new-pass-manager&#x2F;by Arthur Eubanks（Mar 26, 2021）  Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass"><meta property="og:type" content="article"><meta property="og:title" content="LLVM New Pass Manager"><meta property="og:url" content="https://p2tree.top/posts/ab589331.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https:&#x2F;&#x2F;blog.llvm.org&#x2F;posts&#x2F;2021-03-26-the-new-pass-manager&#x2F;by Arthur Eubanks（Mar 26, 2021）  Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2022/12/03/index.webp"><meta property="article:published_time" content="2022-12-03T17:29:47.000Z"><meta property="article:modified_time" content="2022-12-03T17:29:47.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="译文"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2022/12/03/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LLVM New Pass Manager",
  "url": "https://p2tree.top/posts/ab589331.html",
  "image": "https://img.p2tree.top/2022/12/03/index.webp",
  "datePublished": "2022-12-03T17:29:47.000Z",
  "dateModified": "2022-12-03T17:29:47.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/ab589331.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"LLVM New Pass Manager",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://unpkg.zhimg.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2022/12/03/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">LLVM New Pass Manager</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LLVM New Pass Manager</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-03T17:29:47.000Z" title="发表于 2022-12-03 17:29:47">2022-12-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-03T17:29:47.000Z" title="更新于 2022-12-03 17:29:47">2022-12-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2022-12-03 17:29:47&quot;}" hidden></div><blockquote><p>这是一篇<strong>译文</strong>，主要介绍了 LLVM 中的 New Pass Manager 原文链接：<br><a target="_blank" rel="noopener" href="https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/">https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/</a><br>by Arthur Eubanks（Mar 26, 2021）</p></blockquote><h2 id="Pass-Manager-的介绍"><a href="#Pass-Manager-的介绍" class="headerlink" title="Pass Manager 的介绍"></a>Pass Manager 的介绍</h2><p>Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。</p><p>Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（<code>SCC: strongly connected component</code>）或者 loop 上。</p><p>调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。</p><p>Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominator tree）。为了更好的提高性能，分析结果可能会在 pass 之间共享，因为 pass 之间常会有依赖性，毕竟重复计算相同的结果开销太大。所以 Pass Manager 还需要缓存分析结果。当然，如果中间还经过了 transformation pass，还可能涉及到重新计算结果（之前的分析结果过期了）。</p><p>Pass Manager 支持添加一些测试 pass 来测试整个 pass list。但更简单的是使用预先构建好的 pass pipeline，比如使用 <code>clang -O2</code> 来运行 O2 优化下的所有 passes。</p><h2 id="New-Pass-Manager-的介绍"><a href="#New-Pass-Manager-的介绍" class="headerlink" title="New Pass Manager 的介绍"></a>New Pass Manager 的介绍</h2><p>LLVM 在几年前推出了一套新的 Pass Manager，所以目前有两套不同的 Pass Manager 共存：<code>legacy pass manager</code> 和 <code>new pass manager</code>。</p><p>legacy pass manager 在结构上，会丢失一些好的优化机会，尤其是在 <code>inliner</code> 中提取分析结果。比如内联函数希望从 callee 那里拿到一些 profile 信息，特别是对于延迟内联，想要在 inliner 拿到一些 warpper function。legacy pass manager 不支持在 CGSCC pass 中提取任意函数的分析信息（CGSCC 就是 call graph strongly connected component）。pass manager 会确保我们自底向上地遍历 SCC，从而可以在从 caller 中拿到更精确地信息来让 callee 的优化更充分。 LLVM 的 inliner 是一个 CGSCC pass，因为他是一个自底向上遍历的 inliner 实现。以这个例子可以说明，legacy pass manager 在提升一些优化时的能力不足。</p><p>目前， new pass manager 还只适用于 LLVM IR 上的中端 pass pipeline。后端的 codegen pass pipeline 还依然使用 legacy pass manager，主要原因是后端 pass 是基于 MIR 的，没有很多人有精力去给后端的 MIR 框架适配 new pass manager，况且还有那么多后端需要自己适配。另外，后端 pass 中几乎没有过程间优化 pass，所以使用 new pass manager 也并不会带来什么性能提升。</p><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><p>在 legacy pass manager 中，每个 pass 都会预先声明它需要保留的分析信息，如果这些分析并没有在缓存或者缓存已失效，那么 pass manager 需要将这些分析作为 pass 来提前调度。提前声明的方式会带来不必要的 boilerplate（即一些重复冗余但又不可缺少的代码——译注），并且对于一个 pass，它也并不是在任何情况下都会使用所有的分析信息。</p><p>在 new pass manager 中，使用了另一种完全不同的方法，它将分析 pass 和常规 pass 完全分离开来。其中，所有的分析 pass 都由一个独立的 analysis manager 来管理（计算运行、缓存信息、决定失效）。普通 pass 可以向 analysis manager 请求分析信息，这包括惰性计算分析。为了能向普通 pass 通知哪些分析信息是有效的，analysis manager 可以向 pass 返回它目前获知的信息。pass manager 告诉 analysis manager 来处理失效的缓存信息。这种方式可以减少 boilerplate，能更清晰的区分普通 pass 和分析 pass。</p><p>因为 legacy pass manager 将分析工作也当做 pass 来调度，所以我们无法有效的为任意函数进行分析。对于函数级别的分析 pass，它能获得的信息只能是最后一次分析 pass 运行时对当前函数的信息。我们可以为其他函数手动创建新的分析代码，但它们的分析结果不会被缓存在任何地方，从而导致很多的冗余工作和编译成本开销。由于在 new pass manager 中，分析 pass 都统一由 analysis manager 来管理，所以 analysis manager 可以负责管理任意函数的任意信息。</p><p>为了支持 CGSCC 分析，我们需要一个索引来缓存分析结果。对于像函数和循环 block 这种代码，我们有持续性的数据结构作为索引。然而，legacy 的 CGSCC pass manager 只能存储内存中当前 SCC 中的函数，不能拿到一个持续性的 call graph 数据结构作为索引来缓存分析结果。所以我们需要将整个 graph 放在内存中作为索引。另外，如果我们使用这个 graph 作为索引，这还需要能时刻确保数据是有效的（避免有 pass 改变了数据结构，但没有更新分析结果）。为了避免过多的冗余操作来重新反复的生成大量但松散的 graph，我们就需要增量更新 graph。这就是在 new pass manager 中为什么 CGSCC 设计复杂的原因。</p><p>在一个 SCC 内部，一次 transform 操作可能会破坏 call graph cycle 导致切分 SCC。legacy CGSCC 实现中的一个问题是，它简单的将一个 SCC 中所有的 functions 都存放在当前 SCC 中的一个 array 中，然后按顺序遍历所有的 functions。比如下述代码中，一个 SCC 中有 2 个 functions：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="built_in">foo</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们会首先 visit foo 函数，然后 visit bar 函数，然后删除其中的 dead call。最后会 transform 成：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bar</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bar</span><span class="params">()</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>我们现在其实希望重新访问一次 foo 函数，因为我们有了更多的信息（调整后 foo 函数成为一个独立的 SCC）。legacy pass manager 的 CGSCC 只会移动到 call graph 的下一个部分。在 new pass manager 中，设计了增量式的 call graph 更新机制，如果一个 SCC 被切分，我们会确保自底向上地重新 visit 新切分的 SCC。这种机制可能会重复的 visit function，但这也给 pass 一个机会来发现更多潜在地更详细的信息。</p><p>当在 legacy pass manager 中新增一个 pass 时，不同 pass 类型之间的嵌套是隐式的。比如，在一个 module 级别的 pass 之后增加一个 function 级别的 pass，会在连续的 function pass list 之外隐式的增加一个 function pass manager。理论上说这样没问题，虽然看起来有点困惑。 一些 pipeline 可能希望在运行一个 CGSCC pass 时能独立的运行一个 function pass，而不是嵌套在 CGSCC 的 pass manager 中。new pass manager 中，它通过限制只允许相同类型的 pass 包含在同一个 pass manager 中的方式，将这种嵌套变得更加明显。比如，想在一个 function pass 中增加一个 loop pass，这个 loop pass 必须使用 loop-to-function 的 adaptor 来包装，将其转换为一个 function pass。 new pass manager 中的嵌套顺序是：module (→ CGSCC) → function →loop， CGSCC 嵌套是可选的。增加一个 CGSCC 嵌套其实是为了简化问题，但这带来的构建 call graph 的开销和额外的支持嵌套 function pass 的代码，反而也使得它有点复杂，所以它成为一个 optional 的部分。</p><p>legacy pass manager 的实现依赖于许多的全局标记和注册函数。这是由宏生成函数和变量来初始化 pass 的。而且 legacy pass manager 的用户需要确保调用一个函数来初始化这些 pass。但我们有时希望通过一些方法让 pass manager 意识到我们有些 pass 是用于测试目的的。在 new pass manager 中，这个问题的解决方法是通过将所有 pass 的定义传递给 pass manager builder，然后内部使用一个 pass ID 和 pass 构建函数的 mapping 来依次创建 pipeline 和新增 pass，这个过程中会解析文本的描述信息作为指导。 pass manager builder 的用户可以添加注册解析回调函数的插件来控制自定义的 out-of-tree pass。虽然这会产生全局函数，但并不会带来 mutable 的全局状态，因为每个 pass manager builder 都可以解析 pass pipeline，而不需要访问全局注册函数。其他可选功能，比如调试 pass manager 的运行，也是通过这种构建函数的方式，而不是通过全局标记。</p><p>最后，对于 LLVM pass 并行运行的呼声很高。虽然 pass manager 的结果并不是这个需求的唯一阻碍，但 legacy pass manager 也确实有不少阻碍并行运行的问题需要解决。比如在 call graph 级别，只有 sibling SCC 可以并行执行。按需创建 SCC 的方式让它很难找到 sibling SCC。new pass manager 是通过计算全局 call graph 的方式来运行的，所以可以方便的找出 sibling SCC，从而可以并行化 SCC pass。一些 pass 只会使用缓存的分析信息，所以并行化可能导致非确定性的问题，因为一个 module 分析 pass 并不一定会依赖其他并行的 pipeline 的需求而存在。 new pass manager 只允许 function 级别的 pass 访问缓存的 module 分析信息，但不允许运行它们。这样做的缺点是需要保证在运行低级别 pass 之前要先运行高级别的 pass，比如需要确保 GlobalsAA pass 必须优先于一个 function pass 执行。</p><h2 id="设置-new-pass-manager-为默认-pass-manager"><a href="#设置-new-pass-manager-为默认-pass-manager" class="headerlink" title="设置 new pass manager 为默认 pass manager"></a>设置 new pass manager 为默认 pass manager</h2><p>LLVM 的一些主要用户已经几年前就默认使用 new pass manager 了，在上游的努力开发下，目前 new pass manager 已经支持所有的用例。比如，好久前，所有的 Clang 用例就可以在 new pass manager 上运行了。然而，目前还有大量的 LLVM 的测试依然运行在 legacy pass manager 上。opt 工具，它是一个用于测试 pass 的软件，可以使用一些方法来运行 pass 到 legacy pass manager：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># run in legacy pass manager</span></span><br><span class="line">opt -instcombine</span><br><span class="line"></span><br><span class="line"><span class="comment"># run in new pass manager opt -passes=instcombine  </span></span><br></pre></td></tr></table></figure><p>因为目前还有大量的 LLVM 的测试用例仍然使用 legacy pass manager，所以直接将默认改成 new pass manager 会带来大量用例无法通过的情况（虽然手动运行已经验证大多用例可以通过）。</p><p>为了能让用例通过 new pass manager，我们可以手动运行两次，一次运行 legacy pass manager，一次运行 new pass manager，或者也可以自动将运行命令做调整（不需要手动去修改命令）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># automatically translate legacy syntax to new syntax</span></span><br><span class="line">opt -enable-new-pm</span><br></pre></td></tr></table></figure><p>使用这个选项，我们可以探索两种 pass manager 的差异。仍然再次强调，本地打开这个功能，可能会让很多用例无法通过（因为它们还不支持 new pass manager）。目前只是将能在 new pass manager 上更有意义运行的用例做了移植，而对那些无关紧要的用例，仍然放到了 legacy pass manager 上运行。</p><p>一些使用 <code>-enable-new-pm</code> 无法覆盖的问题：</p><ul><li><p>如果函数标记为 <code>optnone</code> 属性，这可能并不会跳过所有的可选 pass。在现有的 pass 检测框架下（即运行 pass 之前和之后会调用回调，允许跳过 pass），这种实现是最简单的。然而，一些 pass 必须要运行来保证整体的正确性，所以我们仍然根据需要保留了一些必要的 pass。</p></li><li><p>Opt-bisect 在 new pass manager 中不被支持。它曾被用来分辨在 pipeline 中的哪个 pass 会导致编译错误，从而可以跳过这个 pass。在现在的 pass 检测框架下，也可以很方便的实现这个功能，所以它总被标记为必要的 pass。</p></li><li><p>大量目标相关的测试会失败。经过检查，一些期望在一些 pipeline（比如 O2）下运行的 pass 没有被运行。这是因为一些后端会向默认 pipeline 中增加一些自定义的 pass，而其中一些 pass 对于正确性是必须的，比如 lower 目标相关的 intrinsics。legacy pass manager 提供了一种方法可以向默认 pipeline 中注入 pass，即通过 <code>TargetMachine::adjustPassManager()</code> 来实现。在 new pass manager 中使用了一种等价的机制来实现将目标相关 pass 引入默认 pipeline 中。这不一定是个很麻烦的问题，因为目前 new pass manager 的主要用户是 x86 架构，而这个架构下并没有使用这个 legacy pass manager 的特性。</p></li><li><p>一些 coroutine 的用例在 CGSCC 框架上运行失败。原因是在 new pass manager CGSCC 框架下不支持将已有函数的部分提取到其他函数（又称为 outlining）。曾经有一些 hack 的处理来解决一些错误的 workaround，但却没有正确的更新 call graph，也没有处理好来自新的 outline function 的递归。最后，我们找到一种方法来适配当前的 CGSCC 框架，保持 call graph 的正确性，尽管这必须要适应特定于 coroutine 的 call graph 转换。</p></li></ul><h2 id="提高"><a href="#提高" class="headerlink" title="提高"></a>提高</h2><p>出于性能考虑，很多项目和公司多年前都已经在使用 new pass manager 了。另外，Chrome 最近开始使用 PGO 和 ThinLTO 来加速 Chrome 运行，两者都带来了不错的性能改善。将 new pass manager 设置为默认打开后，Chrome 很快也进行了更新，目前可以在 Linux 和 Windows 系统上运行 Speedometer 2.0 达到 3-4% 的性能提升，减少 8-9MB 空间占用。更好的使用 profile 信息以及更好的处理大文件 ThinLTO 的 call graph 可能会带来这些改进。</p><p>然而，一些小应用并不会因为切换到 new pass manager 带来多大的益处，因为 new pass manager 带来的改进更倾向于会对大型代码仓库产生影响。</p><p>除了面向用户的提升外，通过标准化使用其中一个 pass manager 改进代码，它也能帮助 LLVM 代码更健壮。虽然我们不能立即移除 legacy pass manager，但已经不建议使用它，尤其是在优化 pipeline 中。然后将来，我们也可能会移除一些和 legacy pass manager 相关的优化 pipeline。</p><h2 id="下一步计划"><a href="#下一步计划" class="headerlink" title="下一步计划"></a>下一步计划</h2><p>开始着手移除使用 legacy pass manager 的优化 pipeline，我们先要确保在 new pass manager 中都能有配套的替代。目前已知的模块：bugpoint，LLVM C API，GPU divergency analysis。</p><p>前边提到，后端 codegen pipeline 仍然工作在 legacy pass manager。虽然已经有一些后端切换到了 new pass manager，但离实用仍然有一段距离。这是改善 LLVM 代码很好的切入点，感兴趣可以与 llvm-dev 沟通。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/588822158">LLVM New Pass Manager - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/ab589331.html">https://p2tree.top/posts/ab589331.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/%E8%AF%91%E6%96%87/">译文</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2022/12/03/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/3229e191.html" title="为什么终端开发离不开 Tmux"><img class="cover" src="https://img.p2tree.top/2023/06/23/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">为什么终端开发离不开 Tmux</div></div><div class="info-2"><div class="info-item-1">开头叨叨我在每天的软件开发工作中都离不开 tmux，它极大的提高了我的工作效率，我使用它优化我的工作流程，维护开发环境，并结合其他工具扩展软件开发的体验感。 如果你之前还没有听说过这个软件，我建议你花 20 分钟了解一下它。有非常多的程序员使用这个软件，尤其是需要连接到远程服务器进行开发的同学。但我发现目前中文网络上还很少有能系统的讲解 “为什么要使用 tmux” 的文章，大多数文章都是直接开门见山地罗列怎么配置 tmux，再拉个表格梳理难以记忆的快捷键清单。 在这篇文章中，我不会花大篇幅介绍怎么使用 tmux，而是告诉你为什么要用它，以及我自己实践很多年的使用技巧。 三个 tmux 组件在使用 tmux 之前，有三个重要的概念一定要了解，分别是 session，window 和 pane。简单介绍下。 session 是会话，也就是和操作系统建立的一次通信状态，不过 tmux 中的 session 不同于直接用 shell 建立的 session，可以理解成一种虚拟 session；session 包含 window，默认启动 session 后会带有 1 个 window。...</div></div></div></a><a class="pagination-related" href="/posts/350eef5c.html" title="CUDA 术语"><img class="cover" src="https://img.p2tree.top/2022/08/28/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CUDA 术语</div></div><div class="info-2"><div class="info-item-1">学习 CUDA 最重要的首先是理解 GPU 和 CUDA 中的各种术语，在不同的平台上，相同或类似的概念却有着不同的称呼，典型的就是在 CUDA 和 OpenCL 的系统中叫法之差异，以及和通用体系结构教材中的称呼。GPU 学习曲线陡峭的一个原因就是术语使用上还未完全统一。 程序抽象类 书中使用的一般性名称 非 GPU 术语 NVIDIA 和 CUDA 术语 AMD 和 OpenCL 术语 详细描述（其他术语标粗体） 可向量化循环 可向量化循环 网格（Grid） 索引范围（NDRange） 在 GPU 上执行的可向量化循环，由一个或多个可以并行执行的线程块（向量化循环体）组成 向量化循环体 （条带挖掘后的）向量化循环体 线程块（Block） 工作组（WorkGroup） 可以在多线程 SIMD 处理器上执行的向量化循环，由一个或多个 SIMD 指令线程构成，可以通过局部存储器通信 SIMD 车道操作序列 标量循环的一次迭代 CUDA 线程（Thread） 工作项（WorkItem） SIMD 指令线程的垂直抽取，对应于一个 SIMD 车道所执行的一个元素。根据遮...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/5cc76640.html" title="LLVM 目标无关代码生成器 6：实现原生汇编器"><img class="cover" src="https://img.p2tree.top/2020/12/09/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-09</div><div class="info-item-2">LLVM 目标无关代码生成器 6：实现原生汇编器</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 6.1 指令解析（原文未完成） 原文待完成状态 6.2 指令别名分析指令解析之后，会进入到 MatchInstructionImpl 函数。该函数实现了别名处理，之后会做真正的匹配工作。 别名分析是为了识别同样一条指令的不同文本形式，并下降到同一种指令表示。在 TableGen 中有几种不同类型的别名描述，将会在后续小节阐述，它们的顺序是从简单到复杂排好序的，一般情况下，只需要使用第一种描述方法即可，这通常是最简洁的描述方法。 6.2.1 助记符别名助记符别名的描...</div></div></div></a><a class="pagination-related" href="/posts/2aaad353.html" title="LLVM 目标无关代码生成器 5：目标无关代码生成算法"><img class="cover" src="https://img.p2tree.top/2020/12/06/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-06</div><div class="info-item-2">LLVM 目标无关代码生成器 5：目标无关代码生成算法</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 这一部分文档详细描述了前边 1.2 节 “代码生成器的高层设计” 中的概述内容。详细解释了代码生成的工作原理和设计思路。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 5.1 指令选择指令选择是 LLVM 代码生成中的一个重要步骤，它将高层的 LLVM 代码表示翻译为目标相关的机器指令。在学术界有多种不同的实现方法，LLVM 使用了基于 SelectionDAG 的指令选择器。 DAG 指令选择器的大部分内容是通过 tablegen 依赖 .td 文件生成的。我们的目标便是将这些 .td 文件生成一个完整的指令...</div></div></div></a><a class="pagination-related" href="/posts/fe45d531.html" title="LLVM 目标无关代码生成器 4：MC 层"><img class="cover" src="https://img.p2tree.top/2020/11/28/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-28</div><div class="info-item-2">LLVM 目标无关代码生成器 4：MC 层</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 MC 层被用来表示机器编码级别的代码，相比于更高层的表示形式，它去除了像常量池、跳转表、全局变量等概念。在这一层上，LLVM 处理如 Label 名称、机器指令、目标文件段信息。这一层的代码在一些阶段非常重要，比如代码生成的最后阶段（也就是写入 .s 或 .o 文件时），或者被 llvm-mc 工具用来作为独立汇编器和反汇编器使用。 这一章节描述一些很重要的类，在之后的章节，还会描述和这一层交互的其他很重要的子系统。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 4.1 MCStreamer APIMCStre...</div></div></div></a><a class="pagination-related" href="/posts/6e862920.html" title="LLVM 目标无关代码生成器 3：机器代码描述类"><img class="cover" src="https://img.p2tree.top/2020/11/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-25</div><div class="info-item-2">LLVM 目标无关代码生成器 3：机器代码描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 在高层设计中，LLVM 代码会翻译成由 MachineFunction、MachineBasicBlock 和 MachineInstr 实例组成的特定机器的表示。这种表示完全是目标无关的，以最抽象的方式描述指令：操作码和操作数。这种表示被设计用来同时支持机器码的 SSA 形式以及寄存器分配后的表示（即非 SSA 形式） 。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器 6：实现原生汇编器 3.1 MachineInstr 类目标机器指令（Machine Instruction，LLVM 后端的一种中间表示，缩写为MI ）通过 M...</div></div></div></a><a class="pagination-related" href="/posts/5ab3a536.html" title="LLVM 目标无关代码生成器 2：目标描述类"><img class="cover" src="https://img.p2tree.top/2020/11/22/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-22</div><div class="info-item-2">LLVM 目标无关代码生成器 2：目标描述类</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标描述的类 （存放在 include&#x2F;llvm&#x2F;Target&#x2F; 路径下）提供了一套抽象的针对任意后端机器通用的描述。这些类被设计来管理一些抽象的目标属性（比如指令和寄存器），并且不夹杂任何代码生成算法的片段。 除了 DataLayout 以外，其他所有的目标描述类都需要作为基类被特定目标的描述类所继承，同时提供虚函数的实现。为了便于实现， TargetMachine 类提供了一些访问器（accessor），这些也同样需要在特定目标的描述类中实现。 LLVM 目标无关代码生成器 1：介绍LLVM 目标无关代码生成器 2：目标描述类LLVM 目标无关代码生成器 3：机器代码描述类LLVM 目标无关代码生成器 4：MC 层LLVM 目标无关代码生成器 5：目标无关代码生成算法LLVM 目标无关代码生成器...</div></div></div></a><a class="pagination-related" href="/posts/640e5f3e.html" title="LLVM 目标无关代码生成器 1：介绍"><img class="cover" src="https://img.p2tree.top/2020/11/21/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-21</div><div class="info-item-2">LLVM 目标无关代码生成器 1：介绍</div></div><div class="info-2"><div class="info-item-1">本文是一篇译文，翻译自：https://llvm.org/docs/CodeGenerator.html​llvm.org/docs/CodeGenerator.html如有问题，敬请指出。转载需注明出处，若需相关专业翻译服务，可联系我。 LLVM 目标无关代码生成器是一个软件框架，它提供了一些可重用的组件，能将 LLVM 中间表示语言翻译成特殊目标下的机器代码。这里所指的机器代码，既可以是汇编码（静态编译器组成部分），也可作为二进制机器码（通过 JIT 编译器运行）。 译注：本文中会把原文 Machine Code 翻译为机器码，但需注意，此处机器码并不表示二进制可执行文件，如 ELF 文件，Machine Code 是 LLVM 后端中 MC 层的中间表示，虽然其与二进制可执行文件有较大相似之处，但依然是两个不同的东西。若文中需要翻译为二进制可执行文件，会特殊指出。 LLVM 目标无关代码生成器由 6 个主要的组件组成： 抽象的目标描述接口：用来维护那些重要的机器特性，而不需要考虑他们的使用。这些接口存放在 include/llvm/Target/ 下。 用来做代...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-Manager-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">Pass Manager 的介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#New-Pass-Manager-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">New Pass Manager 的介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-new-pass-manager-%E4%B8%BA%E9%BB%98%E8%AE%A4-pass-manager"><span class="toc-number">4.</span> <span class="toc-text">设置 new pass manager 为默认 pass manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E9%AB%98"><span class="toc-number">5.</span> <span class="toc-text">提高</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E6%AD%A5%E8%AE%A1%E5%88%92"><span class="toc-number">6.</span> <span class="toc-text">下一步计划</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-09-21T14:17:57.488Z" title="更新于 2025-09-21 14:17:57">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-09-21T14:17:57.488Z" title="更新于 2025-09-21 14:17:57">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-09-21T14:17:57.488Z" title="更新于 2025-09-21 14:17:57">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a28b3899.html" title="死亡搁浅配乐收藏"><img src="https://img.p2tree.top/2024/10/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="死亡搁浅配乐收藏"></a><div class="content"><a class="title" href="/posts/a28b3899.html" title="死亡搁浅配乐收藏">死亡搁浅配乐收藏</a><time datetime="2025-09-21T14:17:57.488Z" title="更新于 2025-09-21 14:17:57">2025-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构"><img src="https://img.p2tree.top/2020/01/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="跟随一条指令来看LLVM的基本结构"></a><div class="content"><a class="title" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构">跟随一条指令来看LLVM的基本结构</a><time datetime="2025-09-21T14:17:57.488Z" title="更新于 2025-09-21 14:17:57">2025-09-21</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.0</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var t=document.getElementById("footer-wrap");console.log("已挂载butterfly_footer_beautify"),t.insertAdjacentHTML("beforeend",'<p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v7.0.0" title=""><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" data-title="主题版本Butterfly_v4.13.0" title=""><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" data-title="本站部署托管于Vercel" title=""><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a><a class="github-badge" target="_blank" href="https://cloudflare.com/" style="margin-inline:5px" data-title="本站图床使用CloudFlare提供服务" title=""><img src="https://img.shields.io/badge/Image-CloudFlare-orange?style=flat&amp;logo=Cloudflare" alt=""/></a><a class="github-badge" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" style="margin-inline:5px" data-title="本站使用 51la 提供网站访问统计服务" title=""><img src="https://img.shields.io/badge/Tracker-51LA-blue" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站源码由Github托管" title=""><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://stat.p2tree.top/" style="margin-inline:5px" data-title="网站状态监控使用UptimeFlare实现" title=""><img src="https://img.shields.io/badge/Monitor-UptimeFlare-green" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title=""><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></p>')}for(var elist="null".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script data-pjax>function butterfly_swiper_injector_config(){var t=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/73fc32a.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2023/10/14/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-14</span><a class="blog-slider__title" href="posts/73fc32a.html" alt="">Vim 高效编辑技巧</a><div class="blog-slider__text">绝对是全网都没有的 Vim 使用硬干货经验</div><a class="blog-slider__button" href="posts/73fc32a.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/4b2442c5.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2021/02/22/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-02-22</span><a class="blog-slider__title" href="posts/4b2442c5.html" alt="">LLVM 后端实践笔记 0：序</a><div class="blog-slider__text">LLVM 后端学习的系列教程，这是第一集，必读起跑线</div><a class="blog-slider__button" href="posts/4b2442c5.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/e8d522db.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/05/wechat_logo.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-05</span><a class="blog-slider__title" href="posts/e8d522db.html" alt="">微信公众号 P2Tree</a><div class="blog-slider__text">我维护的微信公众号，欢迎来交个朋友</div><a class="blog-slider__button" href="posts/e8d522db.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/b32e3378.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/23/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="posts/b32e3378.html" alt="">个人说明书 v2.2.4</a><div class="blog-slider__text">这份个人说明书，记录着我的基本信息和所思所想，希望能以最快的方式介绍我自己</div><a class="blog-slider__button" href="posts/b32e3378.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="/about/,/tags/,/categories/,/draft/".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script></body></html>