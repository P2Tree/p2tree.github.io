<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>LLVM 后端实践笔记 6：更多数据类型 | P2Tree's Mill</title><meta name="author" content="P2Tree"><meta name="copyright" content="P2Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="之前的章节只实现了 int 和 32 位的 long 类型数据，这一章会新增一些更复杂的数据类型，比如 char, bool, short, long long，还会增加结构体，浮点，和向量类型。这一部分内容相对比较简单，其实这些类型也都是标准语言都支持的类型，所以 LLVM 自身已经实现了很大一部分功能，只要我们的后端不那么奇怪，就很容易填补缺失的内容。 LLVM 后端实践笔记 0：序LLVM"><meta property="og:type" content="article"><meta property="og:title" content="LLVM 后端实践笔记 6：更多数据类型"><meta property="og:url" content="https://p2tree.top/posts/cb3a6aa4.html"><meta property="og:site_name" content="P2Tree&#39;s Mill"><meta property="og:description" content="之前的章节只实现了 int 和 32 位的 long 类型数据，这一章会新增一些更复杂的数据类型，比如 char, bool, short, long long，还会增加结构体，浮点，和向量类型。这一部分内容相对比较简单，其实这些类型也都是标准语言都支持的类型，所以 LLVM 自身已经实现了很大一部分功能，只要我们的后端不那么奇怪，就很容易填补缺失的内容。 LLVM 后端实践笔记 0：序LLVM"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://img.p2tree.top/2021/06/19/index.webp"><meta property="article:published_time" content="2021-06-19T17:15:17.000Z"><meta property="article:modified_time" content="2021-06-19T17:15:17.000Z"><meta property="article:author" content="P2Tree"><meta property="article:tag" content="编译器"><meta property="article:tag" content="LLVM"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://img.p2tree.top/2021/06/19/index.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "LLVM 后端实践笔记 6：更多数据类型",
  "url": "https://p2tree.top/posts/cb3a6aa4.html",
  "image": "https://img.p2tree.top/2021/06/19/index.webp",
  "datePublished": "2021-06-19T17:15:17.000Z",
  "dateModified": "2021-06-19T17:15:17.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "P2Tree",
      "url": "https://p2tree.top"
    }
  ]
}</script><link rel="shortcut icon" href="https://img.p2tree.top/avatar.webp"><link rel="canonical" href="https://p2tree.top/posts/cb3a6aa4.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-2M9BYWL9WW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2M9BYWL9WW"),btf.addGlobalFn("pjaxComplete",()=>{gtag("config","G-2M9BYWL9WW",{page_path:window.location.pathname})},"google_analytics")</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"D6LVAK5RKB",apiKey:"f6946a241b05432428a3e4fc6e7ba9e7",indexName:"my-hexo-blog",hitsPerPage:6,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:500,languages:{author:"作者: P2Tree",link:"链接: ",source:"来源: P2Tree's Mill",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:{chs_to_cht:"已切换为繁体中文",cht_to_chs:"已切换为简体中文",day_to_night:"已切换为深色模式",night_to_day:"已切换为浅色模式",bgLight:"#49b1f5",bgDark:"#1f1f1f",position:"bottom-left"},infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!0,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"LLVM 后端实践笔记 6：更多数据类型",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><meta name="baidu-site-verification" content="codeva-Watq1Co2vC"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4649427_nfzovmtn6c.css"><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload='this.media="all"'><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="P2Tree's Mill" type="application/atom+xml">
</head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="/css/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url(https://img.p2tree.top/2021/06/19/index.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">P2Tree's Mill</span></a><a class="nav-page-title" href="/"><span class="site-name">LLVM 后端实践笔记 6：更多数据类型</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span> 返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-pen-to-square"></i><span> 文章</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文踪</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-heartbeat"></i><span> 收藏</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Games-Collection-a82b7f1e22b44e5fb7e207e521279a31"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://quirky-olivine-7e6.notion.site/My-Book-Tracker-3ee78866f1274e869d48fe75bfec23e7"><i class="fa-fw fas fa-book-open"></i><span> 书籍</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">LLVM 后端实践笔记 6：更多数据类型</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-19T17:15:17.000Z" title="发表于 2021-06-19 17:15:17">2021-06-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-19T17:15:17.000Z" title="更新于 2021-06-19 17:15:17">2021-06-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/">软件开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:1000,&quot;messagePrev&quot;:&quot;距离上次更新已过去&quot;,&quot;messageNext&quot;:&quot;天，文章中的部分内容可能已经过时，请酌情参考～&quot;,&quot;postUpdate&quot;:&quot;2021-06-19 17:15:17&quot;}" hidden></div><p>之前的章节只实现了 int 和 32 位的 long 类型数据，这一章会新增一些更复杂的数据类型，比如 char, bool, short, long long，还会增加结构体，浮点，和向量类型。这一部分内容相对比较简单，其实这些类型也都是标准语言都支持的类型，所以 LLVM 自身已经实现了很大一部分功能，只要我们的后端不那么奇怪，就很容易填补缺失的内容。</p><ol class="series-items"><li><a href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a></li><li><a href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a></li><li><a href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a></li><li><a href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a></li><li><a href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a></li><li><a href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a></li><li><a href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a></li><li><a href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a></li><li><a href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a></li><li><a href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a></li><li><a href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a></li><li><a href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a></li></ol><hr><h2 id="6-1-实现类型"><a href="#6-1-实现类型" class="headerlink" title="6.1 实现类型"></a>6.1 实现类型</h2><h3 id="6-1-1-局部指针"><a href="#6-1-1-局部指针" class="headerlink" title="6.1.1 局部指针"></a>6.1.1 局部指针</h3><p>我们需要在 td 文件中添加内存操作数的描述片段。具体参见代码描述部分。</p><h3 id="6-1-2-char-short-int-和-bool-类型"><a href="#6-1-2-char-short-int-和-bool-类型" class="headerlink" title="6.1.2 char, short int 和 bool 类型"></a>6.1.2 char, short int 和 bool 类型</h3><p>char 和 short int 比较简单，参见代码描述。</p><p>bool 类型因为不是 C 标准的类型，而是 C++ 特性，所以我们不能使用 clang 来编译，测试时通过 LLVM IR 来测试（少有的 IR 测试用例）。</p><h3 id="6-1-3-long-long-类型"><a href="#6-1-3-long-long-类型" class="headerlink" title="6.1.3 long long 类型"></a>6.1.3 long long 类型</h3><p>与 Mips 一致，long long 类型是 64 位数据长度。支持 64 位宽的数据，需要新增对该类型的加减法和乘法操作，需要考虑进位，所以会对 DAG 做调整。具体参见代码描述部分。</p><h3 id="6-1-4-float-和-double-类型"><a href="#6-1-4-float-和-double-类型" class="headerlink" title="6.1.4 float 和 double 类型"></a>6.1.4 float 和 double 类型</h3><p>Cpu0 硬件指令只支持整形，浮点指令需要通过调用函数库的方式实现，很多简单的处理器都是通过软件来实现浮点运算的，只有相对复杂的一些处理器，才会有自己的浮点运算单元。</p><p>因为我们还没有实现函数调用的功能，所以目前这部分代码还无法测试，不过有一些小工作可以先做了。具体见代码描述部分。</p><h3 id="6-1-5-数组和结构体类型"><a href="#6-1-5-数组和结构体类型" class="headerlink" title="6.1.5 数组和结构体类型"></a>6.1.5 数组和结构体类型</h3><p>我们需要实现对全局变量带偏移的寻址模式，稍微有点复杂，参见代码实现。</p><h3 id="6-1-6-向量类型"><a href="#6-1-6-向量类型" class="headerlink" title="6.1.6 向量类型"></a>6.1.6 向量类型</h3><p>向量类型的运算可以实现 SIMD 运算，也就是一条指令同时计算多个数据，硬件上这样设计可以提高数据并行性，使运算速率更快。因为 LLVM 原生支持向量类型的运算，所以留给我们要实现的部分不多。</p><p>Mips 支持 LLVM IR :<code>icmp slt</code> 和 <code>sext</code> 的向量类型计算，Cpu0 也同样会支持。</p><p>C 语言的扩展是支持向量类型的，需要通过 <code>__attribute__</code> 来修饰，参见测试部分。</p><h2 id="6-2-代码修改"><a href="#6-2-代码修改" class="headerlink" title="6.2 代码修改"></a>6.2 代码修改</h2><p>和之前一样，我还是把所有内容的代码放到这里进行说明。</p><h3 id="6-2-1-文件新增"><a href="#6-2-1-文件新增" class="headerlink" title="6.2.1 文件新增"></a>6.2.1 文件新增</h3><h4 id="1-Cpu0InstrInfo-td"><a href="#1-Cpu0InstrInfo-td" class="headerlink" title="(1) Cpu0InstrInfo.td"></a>(1) Cpu0InstrInfo.td</h4><p>到目前，因为我们添加数据类型的很多实现代码已经在公共 LLVM 代码中实现，所以实际上大多数修改都在 td 文件中。</p><p>新增一个 <code>mem_ea</code> 的操作数类型，这是一个 complexpattern，会定义其 encoding 操作和 printinst 等操作，它用来描述指令 pattern 中的地址表示；然后要定义一个 <code>LEA_ADDiu</code> 的模式，这是一个不会输出成指令的模式，它实际上是计算地址+偏移的结果，这和 sparc 处理器中的 <code>LEA_ADDRi</code> 是一样的效果。</p><p>新增 i8 和 i16 相关的 extend 类型以及对应的 <code>ld/st</code>，命名为 <code>LB</code>, <code>LBu</code>, <code>SB</code>, <code>LH</code>, <code>LHu</code>, <code>SH</code>。<code>LB</code>, <code>LH</code> 处理有符号的 i8&#x2F;i16 类型 load，<code>LBu</code>, <code>LHu</code> 处理无符号的 i8&#x2F;i16 类型 load，<code>SB</code>, <code>SH</code> 同理。</p><p>新增 <code>CountLeading0</code> 和 <code>CountLeading1</code> 的 pattern，用来选择到计算前导 0 和计算前导 1 的指令，llvm 内置了 <code>ctlz</code> 的 node（count leading zero），可以直接把 <code>clz</code> 指令接过去，不过对于 count leading 1 是没有对应的 node 的，不过可以通过先对值取反然后求前导 0 的方式实现前导 1 的计算，即 <code>ctlz (not RC:$rb)</code>。</p><p>因为 C 语言没有对求前导 0 和前导 1 的原生语法，所以实际上会使用 builtin 接口来实现，也就是说，在 C 语言描述中，为了实现这种功能，需要调用 <code>__builtin_clz()</code> 函数（ctls 就是先对参数取反再调用 ctlz 的 builtin），因为我们使用了内置的 node，所以这部分是 llvm 帮我们实现了。要等函数调用完成之后才能测试。</p><h4 id="2-Cpu0ISelLowering-h-cpp"><a href="#2-Cpu0ISelLowering-h-cpp" class="headerlink" title="(2) Cpu0ISelLowering.h&#x2F;.cpp"></a>(2) Cpu0ISelLowering.h&#x2F;.cpp</h4><p>有关于对 bool 类型的处理，这里增加了一些对 i1 类型 Promote 的合法化描述，告诉 LLVM 在遇到对 i1 类型的 extend 时要做 Promote。Promote 是将较小宽度的数据类型扩展成对应的能够支持的更宽的数据宽度类型，在指令选择的类型合法化阶段会起到作用。</p><p>另外，还继承了 <code>setBooleanContents()</code> 和 <code>setBooleanVectorContents()</code> 函数，暂时不提供实现代码。</p><p>在 long long 实现中，在 Lowering 的位置还需要增加对 long long 类型的移位操作合法化。</p><p>覆盖一个函数 <code>isOffsetFoldingLegal()</code>，直接返回 false，避免带偏移的全局地址展开，Cpu0 和 Mips 一样无法处理这种情况。我们实现的 <code>getAddrNonPIC()</code> 方法中，将全局符号地址展开成一条加法指令，对地址的高低位做加法运算。所以实际上我们会将一条全局地址带偏移的寻址展开成加法运算 base，然后再把结果与 offset 相加的 DAG（在 Cpu0ISelDAGToDAG.cpp 中的 SelectAddr 中提取这种情况的 node Value，此时就已经是两个 add node 了）。</p><p>最后，还需要对向量类型的支持做一小部分改动，覆盖 <code>getSetCCResultType()</code> 方法，如果是向量类型，使用 <code>VT.changeVectorElementTypeToInteger()</code> 方法返回 CC 值。</p><h4 id="3-Cpu0SEISelDAGToDAG-cpp"><a href="#3-Cpu0SEISelDAGToDAG-cpp" class="headerlink" title="(3) Cpu0SEISelDAGToDAG.cpp"></a>(3) Cpu0SEISelDAGToDAG.cpp</h4><p>定义了一个 <code>selectAddESubE()</code> 方法，用来处理带进位的加减法运算的指令选择。在 <code>trySelect()</code> 方法中，将对 <code>ISD::SUBE</code>, <code>ISD::ADDE</code> 的情况选择用 <code>selectAddESubE()</code> 来处理。</p><p><code>selectAddESubE()</code> 方法为符合条件的 node 新增了一个操作数节点，该节点会读取状态字中进位是否是 1，并将结果叠加到运算中；在 Cpu032I 处理器中，使用 <code>CMP</code> 指令和 <code>ANDi</code> 指令来获取进位状态，在 Cpu032II 处理器中，则使用 <code>SLT</code> 指令直接判断进位。</p><p>另外，还要处理 <code>SMUL_LOHI</code> 和 <code>UMUL_LOHI</code> 节点，这是能够直接返回两个运算结果的节点（高低位）。</p><p>在 <code>SelectAddr()</code> 方法中，对于全局基址加常量偏移的情况，提取其基址和偏移。</p><h2 id="6-3-检验成果"><a href="#6-3-检验成果" class="headerlink" title="6.3 检验成果"></a>6.3 检验成果</h2><h3 id="6-3-1-局部指针"><a href="#6-3-1-局部指针" class="headerlink" title="6.3.1 局部指针"></a>6.3.1 局部指针</h3><p>运行我提供的 ch6_1_localpointer.c 文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">test_local_pointer</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> b = <span class="number">3</span>;</span><br><span class="line">  <span class="type">int</span> *p = &amp;b;</span><br><span class="line">  <span class="keyword">return</span> *p;    <span class="comment">// 这里还对不了，我们还没实现 call</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 clang 进行编译：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build/bin/clang -target mips-unknown-linux-gnu -c ch6_1_localpointer.c -emit-llvm -S -o ch6_1_localpointer.ll</span><br><span class="line">build/bin/llc -march=cpu0 -relocation-model=pic -filetype=asm ch6_1_localpointer.ll -o ch6_1_localpointer.s</span><br></pre></td></tr></table></figure><p>得到的汇编内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addiu $sp, $sp, -8</span><br><span class="line">addiu $2, $zero, 3</span><br><span class="line">st $2, 4($sp)        // 赋值局部变量为 3 并存入栈</span><br><span class="line">addiu $2, $sp, 4     // 读出栈中局部变量的地址</span><br><span class="line">st $2, 0($sp)        // 将指向局部变量的指针存入栈</span><br><span class="line">ld $2, 0($sp)        // 读出栈中指向局部变量的指针的值</span><br><span class="line">ld $2, 0($2)         // 读出局部变量的指针指向的值 </span><br></pre></td></tr></table></figure><h3 id="6-3-2-char-类型"><a href="#6-3-2-char-类型" class="headerlink" title="6.3.2 char 类型"></a>6.3.2 char 类型</h3><p>运行提供的 ch6_2_char_in_struct.c 文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span> &#123;</span></span><br><span class="line">  <span class="type">short</span> year;</span><br><span class="line">  <span class="type">char</span> month;</span><br><span class="line">  <span class="type">char</span> day;</span><br><span class="line">  <span class="type">char</span> hour;</span><br><span class="line">  <span class="type">char</span> minute;</span><br><span class="line">  <span class="type">char</span> second;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> b[<span class="number">4</span>] = &#123;<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;\0&#x27;</span>&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">test_char</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> a = b[<span class="number">1</span>];  <span class="comment">// 访问数组里的 char 成员</span></span><br><span class="line">  <span class="type">char</span> c = (<span class="type">char</span>)b[<span class="number">1</span>];</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Date</span> <span class="title">date1</span> =</span> &#123;<span class="number">2021</span>, (<span class="type">char</span>)<span class="number">2</span>, (<span class="type">char</span>)<span class="number">27</span>, (<span class="type">char</span>)<span class="number">17</span>, (<span class="type">char</span>)<span class="number">22</span>, (<span class="type">char</span>)<span class="number">10</span>&#125;;</span><br><span class="line">  <span class="type">char</span> m = date1.month;    <span class="comment">// 访问结构体里的 char 成员</span></span><br><span class="line">  <span class="type">char</span> s = date1.second;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用 clang 进行编译：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">build/bin/clang -target mips-unknown-linux-gnu -c ch6_2_char_in_struct.c -emit-llvm -S -o ch6_2_char_in_struct.ll</span><br><span class="line">build/bin/llc -march=cpu0 -relocation-model=pic -filetype=asm ch6_2_char_in_struct.ll -o ch6_2_char_in_struct.s</span><br></pre></td></tr></table></figure><p>得到的汇编内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">lui $2, %got_hi(b)</span><br><span class="line">addu $2, $2, $gp</span><br><span class="line">ld $2, %got_lo(b)($2)    // 获取 b 数组的地址</span><br><span class="line">addiu $2, $2, 1</span><br><span class="line">lbu $3, 0($2)            // 获取 b[1] 的值</span><br><span class="line">sb $3, 20($sp)</span><br><span class="line">lbu $2, 0($2)            // 再次获取 b[1] 的值</span><br><span class="line">sb $2, 16($sp)</span><br><span class="line">ld $2, %got($__const.test_char.date1)($gp)</span><br><span class="line">ori $2, $2, %lo($__const.test_char.date1)    // 获取要写入局部结构体对象的常量地址</span><br><span class="line">addiu $3, $2, 6</span><br><span class="line">lhu $3, 0($3)</span><br><span class="line">addiu $4, $2, 4</span><br><span class="line">lhu $4, 0($4)</span><br><span class="line">shl $4, $4, 16</span><br><span class="line">or $3, $4, $3            // 从常量区读出 word 长度的值</span><br><span class="line">addiu $4, $sp, 8         // 这里的 8 是考虑到对齐的结构体在栈中的存放大小</span><br><span class="line">ori $5, $4, 4            // 获取局部结构体对象 date1 的地址</span><br><span class="line">st $3, 0($5)             // 存放 hour, minute, second 到 date1(12($sp))</span><br><span class="line">addiu $3, $2, 2</span><br><span class="line">lhu $3, 0($3)</span><br><span class="line">lhu $2, 0($2)</span><br><span class="line">shl $2, $2, 16</span><br><span class="line">or $2, $2, $3            // 从常量区读出第二个 word 长度的值</span><br><span class="line">st $2, 8($sp)            // 存放 year, month, day 到 date1(8($sp))</span><br><span class="line">ori $2, $4, 2</span><br><span class="line">lbu $2, 0($2)</span><br><span class="line">sb $2, 4($sp)            // 读出 date1.month 并存入栈上 m</span><br><span class="line">ori $2, $4, 6</span><br><span class="line">lbu $2, 0($2)</span><br><span class="line">sb $2, 0($sp)            // 读出 date1.second 并存入栈上 s</span><br></pre></td></tr></table></figure><h3 id="6-3-3-short-类型"><a href="#6-3-3-short-类型" class="headerlink" title="6.3.3 short 类型"></a>6.3.3 short 类型</h3><p>运行提供的 ch6_2_char_short.c 文件：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">test_signed_char</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> a = <span class="number">0x80</span>;</span><br><span class="line">  <span class="type">int</span> i = (<span class="type">signed</span> <span class="type">int</span>)a;</span><br><span class="line">  i = i + <span class="number">2</span>; <span class="comment">// i = (-128 + 2) = -126</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_unsigned_char</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> c = <span class="number">0x80</span>;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> ui = (<span class="type">unsigned</span> <span class="type">int</span>)c;</span><br><span class="line">  ui = ui + <span class="number">2</span>; <span class="comment">// ui = (128 + 2) = 130</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_signed_short</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">short</span> a = <span class="number">0x8000</span>;</span><br><span class="line">  <span class="type">int</span> i = (<span class="type">signed</span> <span class="type">int</span>)a;</span><br><span class="line">  i = i + <span class="number">2</span>; <span class="comment">// i = (-32768 + 2) = -32766</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_unsigned_short</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> c = <span class="number">0x8000</span>;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> ui = (<span class="type">unsigned</span> <span class="type">int</span>)c;</span><br><span class="line">  ui = ui + <span class="number">2</span>; <span class="comment">// ui = (32768 + 2) = 32770</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)ui;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译方式与前边相同。</p><p>得到的汇编内容为（只截取 short 部分，char 部分供对比参考）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// test_signed_short</span><br><span class="line">ori $2, $zero, 32768</span><br><span class="line">sh $2, 4($sp)             // 0x8000 写入栈</span><br><span class="line">lh $2, 4($sp)             // lh 是 load sign half word</span><br><span class="line">st $2, 0($sp)</span><br><span class="line">ld $2, 0($sp)             // 通过 ld/st 转换类型从 short 到 int</span><br><span class="line">addiu $2, $2, 2</span><br><span class="line">st $2, 0($sp)             // 加法运算</span><br><span class="line"></span><br><span class="line">// test_unsigned_short</span><br><span class="line">ori $2, $zero, 32768</span><br><span class="line">sh $2, 4($sp)             // 0x8000 写入栈</span><br><span class="line">lhu $2, 4($sp)            // 注意这里是 lhu，load 之后采用无符号扩展到 word</span><br><span class="line">st $2, 4($sp)</span><br><span class="line">ld $2, 0($sp)             // 转换</span><br><span class="line">addiu $2, $2, 2</span><br><span class="line">st $2, 0($sp)</span><br></pre></td></tr></table></figure><h3 id="6-3-4-bool-类型"><a href="#6-3-4-bool-类型" class="headerlink" title="6.3.4 bool 类型"></a>6.3.4 bool 类型</h3><p>目前提供了两个 case，第一个 case ch6_2_bool.c 因为标准 C 中不支持 bool 类型，所以无法编译，可以尝试通过 clang++ 进行编译，得到的 IR 和第二个 case 类似。第二个 case ch6_2_bool2.ll，通过 LLVM IR 来完成测试。</p><p>直接使用 llc 编译：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">build/bin/llc -march=cpu0 -relocation-model=pic -filetype=asm ch6_2_bool2.ll -o ch6_2_bool2.s</span><br></pre></td></tr></table></figure><p>得到的汇编内容为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">addiu $2, $zero, 1</span><br><span class="line">sb $2, 7($sp)           // 使用 sb 将 bool 类型的 1 写入栈，这是我们做了合法化之后的效果</span><br></pre></td></tr></table></figure><h3 id="6-3-5-long-long-类型"><a href="#6-3-5-long-long-类型" class="headerlink" title="6.3.5 long long 类型"></a>6.3.5 long long 类型</h3><p>运行提供的 case ch6_3_longlong.c：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="type">long</span> <span class="title function_">test_longlong</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> a = <span class="number">0x300000002</span>;</span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> b = <span class="number">0x100000001</span>;</span><br><span class="line">  <span class="type">int</span> a1 = <span class="number">0x30010000</span>;</span><br><span class="line">  <span class="type">int</span> b1 = <span class="number">0x20010000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> c = a + b;    <span class="comment">// c = 0x00000004,00000003</span></span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> d = a - b;    <span class="comment">// d = 0x00000002,00000001</span></span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> e = a * b;    <span class="comment">// e = 0x00000005,00000002</span></span><br><span class="line">  <span class="type">long</span> <span class="type">long</span> f = (<span class="type">long</span> <span class="type">long</span>)a1 * (<span class="type">long</span> <span class="type">long</span>)b1;    <span class="comment">// f = 0x00060050,01000000</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (c+d+e+f);       <span class="comment">// (0x0006005b,01000006) = (393307,16777222)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译命令与之前一致（Cpu032I 处理器），结果不详细罗列，举个例子，比如加法：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addu $3, $3, $5        // 高位加法，不带进位</span><br><span class="line">addu $4, $2, $4        // 低位加法，不带进位</span><br><span class="line">cmp $sw, $4, $2</span><br><span class="line">andi $2, $sw, 1        // Cpu032I 获取低位加法进位信息</span><br><span class="line">addu $2, $3, $2        // 将可能的进位加到高位加法的结果</span><br><span class="line">st $4, 28($sp)         // 保存低位加法结果</span><br><span class="line">st $2, 24($sp)         // 保存高位加法结果</span><br></pre></td></tr></table></figure><p>可以换成 Cpu032II 类型处理器重新编译，可以看到不同的结果，编译命令要加上 <code>-mcpu=cpu032II</code> 参数，得到的该部分的汇编代码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">addu $3, $3, $5        // 高位加法，不带进位</span><br><span class="line">addu $4, $2, $4        // 低位加法，不带进位</span><br><span class="line">sltu $2, $4, $2        // 判断低位加法是否产生了进位</span><br><span class="line">addu $2, $3, $2        // 将可能的进位加到高位加法的结果</span><br><span class="line">st $4, 28($sp)         // 保存低位加法结果</span><br><span class="line">st $2, 24($sp)         // 保存高位加法结果</span><br></pre></td></tr></table></figure><h3 id="6-3-6-数组和结构体类型"><a href="#6-3-6-数组和结构体类型" class="headerlink" title="6.3.6 数组和结构体类型"></a>6.3.6 数组和结构体类型</h3><p>先测试局部数组变量，运行 ch6_5_localarrayinit.c：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后的结果为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">addiu $3, $sp, 0         // 栈基址</span><br><span class="line">addiu $4, $3, 8          // 移动到保存第 3 个参数的位置</span><br><span class="line">lui $5, %hi($__const.main.a)</span><br><span class="line">ori $5, $5, %lo($__const.main.a)</span><br><span class="line">addiu $6, $5, 8          // 获取到 a 数组的全局基址</span><br><span class="line">ld $6, 0($6)             // 获取第 3 个值 a[2]：2</span><br><span class="line">st $6, 0($4)             // 保存到栈上</span><br><span class="line">addiu $3, $3, 4          // 移动到保存第 2 个参数的位置</span><br><span class="line">addiu $4, $5, 4          // 获取到 a 数组的全局基址偏移一个 word 的位置</span><br><span class="line">ld $4, 0($4)             // 获取第 2 个值 a[1]：1</span><br><span class="line">st $4, 0($3)             // 保存到栈上</span><br><span class="line">ld $3, 0($5)             // 获取第 1 个值 a[0]：0 （等于基址，所以不用移动）</span><br><span class="line">st $3, 0($sp)            // 保存到栈上（等于栈基址，不用移动）</span><br></pre></td></tr></table></figure><p>然后试着编译全局数组变量和结构体，运行 ch6_5_globalstructoffset.c：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> year;</span><br><span class="line">  <span class="type">int</span> month;</span><br><span class="line">  <span class="type">int</span> day;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span> <span class="title">date</span> =</span> &#123;<span class="number">2021</span>, <span class="number">2</span>, <span class="number">27</span>&#125;;</span><br><span class="line"><span class="type">int</span> a[<span class="number">3</span>] = &#123;<span class="number">2021</span>, <span class="number">2</span>, <span class="number">27</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_struct</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> day = date.day;</span><br><span class="line">  <span class="type">int</span> i = a[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (i+day);  <span class="comment">// 2 + 27 = 29</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后的结果为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lui $2, %got_hi(date)</span><br><span class="line">addu $2, $2, $gp</span><br><span class="line">ld $2, %got_lo(date)($2)       // 获取到 date 的全局地址</span><br><span class="line">addiu $2, $2, 8</span><br><span class="line">ld $2, 0($2)                   // 获取 date 第 3 个值 day：27</span><br><span class="line">st $2, 4($sp)                  // 保存到栈上</span><br><span class="line">lui $2, %got_hi(a)</span><br><span class="line">addu $2, $2, $gp</span><br><span class="line">ld $2, %got_lo(a)($2)</span><br><span class="line">addiu $2, $2, 4</span><br><span class="line">ld $2, 0($2)                   // 获取 a 第 2 个值 a[1]：2</span><br><span class="line">st $2, 0($sp)                  // 保存到栈上</span><br><span class="line">ld $2, 0($sp)</span><br><span class="line">ld $3, 4($sp)</span><br><span class="line">addu $2, $2, $3                // 做加法</span><br></pre></td></tr></table></figure><h3 id="6-3-8-向量类型"><a href="#6-3-8-向量类型" class="headerlink" title="6.3.8 向量类型"></a>6.3.8 向量类型</h3><p>需要测试的 case ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> vector8long __attribute__((__vector_size__(<span class="number">32</span>)));</span><br><span class="line"><span class="keyword">typedef</span> <span class="type">long</span> vector8short __attribute__((__vector_size__(<span class="number">16</span>)));</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_cmplt_short</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">volatile</span> vector8short a0 = &#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">  <span class="keyword">volatile</span> vector8short b0 = &#123;<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>&#125;;</span><br><span class="line">  <span class="keyword">volatile</span> vector8short c0;</span><br><span class="line">  c0 = a0 &lt; b0;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="type">int</span>)(c0[<span class="number">0</span>] + c0[<span class="number">1</span>] + c0[<span class="number">2</span>] + c0[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">test_cmplt_long</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">volatile</span> vector8long a0 = &#123;<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line">  <span class="keyword">volatile</span> vector8long b0 = &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>&#125;;</span><br><span class="line">  <span class="keyword">volatile</span> vector8long c0;</span><br><span class="line">  c0 = a0 &lt; b0;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (c0[<span class="number">0</span>] + c0[<span class="number">1</span>] + c0[<span class="number">2</span>] + c0[<span class="number">3</span>] + c0[<span class="number">4</span>] + c0[<span class="number">5</span>] + c0[<span class="number">6</span>] + c0[<span class="number">7</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译后即可得到正确的汇编代码，比较指令也一样是区分 cpu032I 和 cpu032II 两种处理器的。</p><h2 id="6-4-总结"><a href="#6-4-总结" class="headerlink" title="6.4 总结"></a>6.4 总结</h2><p>这一章我们添加了很多的额外数据类型，这些数据类型在 C 编程中都比较常用。</p><p>因为 LLVM 优秀的框架设计，很多通用编程语言的数据类型都已经在公共代码中支持，所以如果是设计一个标准的程序语言的编译器，在 LLVM 框架下会省力很多，实现也会简单很多。</p><hr><div class="note info flat"><p>本文同步发布在知乎账号下：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/382189083">LLVM 后端实践笔记 6：更多数据类型 - 知乎 (zhihu.com)</a></p></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://p2tree.top">P2Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://p2tree.top/posts/cb3a6aa4.html">https://p2tree.top/posts/cb3a6aa4.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://p2tree.top" target="_blank">P2Tree's Mill</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/">编译器</a><a class="post-meta__tags" href="/tags/LLVM/">LLVM</a></div><div class="post-share"><div class="social-share" data-image="https://img.p2tree.top/2021/06/19/index.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流"><img class="cover" src="https://img.p2tree.top/2021/07/04/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">LLVM 后端实践笔记 7：控制流</div></div><div class="info-2"><div class="info-item-1">这一章会介绍与控制流有关的功能实现，比如 if、else、while 和 for 等，还会介绍如何将控制流的 IR 表示转换为机器指令；之后会引入几个后端优化，处理一些跳转需求引入的问题，同时来说明如何编写后端优化的 pass。在条件指令小节中，会介绍 LLVM IR 中的特殊指令 select 和 select_cc，以及如何处理这种指令，从而来支持更细节的控制流支持实现。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制流LLVM 后端实践笔记 8：函数调用LLVM 后端实践笔记 9：ELF文件支持LLVM 后端实践笔记 10：汇编LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器 7.1 控制流语句7.1.1 简要说明从机器层面上来看，所有的跳转只分为无条件跳转和有条件跳转，从跳转方式上来分，又分为...</div></div></div></a><a class="pagination-related" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量"><img class="cover" src="https://img.p2tree.top/2021/06/06/index.webp" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">LLVM 后端实践笔记 5：全局变量</div></div><div class="info-2"><div class="info-item-1">之前的几章，只访问了局部变量，在这一章中，我们要处理全局变量的访问。全局变量的 DAG 翻译不同于之前的 DAG 翻译。它的 DAG 翻译，需要额外依据 llc -relocation-model 参数（指定重定位模式是静态重定位还是运行时重定位），在后端创建 IR DAG 节点，而其他的 DAG 只需根据输入文件来直接做 DAG 的翻译 （伪指令除外）。大家需要专注于如何在执行时创建 DAG 节点而增加的代码，以及如何在 td 文件中定义 Pat 结构。另外，全局变量的机器指令打印功能也需要完成。 LLVM 后端实践笔记 0：序LLVM 后端实践笔记 1：新后端初始化和软件编译LLVM 后端实践笔记 2：后端结构LLVM 后端实践笔记 3：算术和逻辑指令LLVM 后端实践笔记 4：生成目标文件LLVM 后端实践笔记 5：全局变量LLVM 后端实践笔记 6：更多数据类型LLVM 后端实践笔记 7：控制流LLVM 后端实践笔记 8：函数调用LLVM 后端实践笔记 9：ELF文件支持LLVM 后端实践笔记 10：汇编LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/8a9047b8.html" title="学习LLVM数据结构：SmallSet"><img class="cover" src="https://img.p2tree.top/2025/4/27/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-27</div><div class="info-item-2">学习LLVM数据结构：SmallSet</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本系列文章以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 在现代编程语言开发中，集合（Set）是一种非常有用的数据结构，它可以高效存储唯一元素。本文介绍一种更轻量级的集合实现：SmallSet。它非常适合存储少量元素，同时保持出色的性能和内存效率。 基本介绍SmallSet 是一种小型集合类型，它实现了基本的集合操作，比如插入、删除和查找等。它的设计目标是优化在存储小规模数据时的性能和内存占用，它结合了小对象优化和动态内存调节技术，非常适合频繁访问的小集合场景。如果你已经对 SmallVector 有了解，那么 SmallSet 和它有着类似的实现思路。 llvm::SmallSet 定义在...</div></div></div></a><a class="pagination-related" href="/posts/a198516a.html" title="学习LLVM数据结构：StringRef"><img class="cover" src="https://img.p2tree.top/2025/3/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-25</div><div class="info-item-2">学习LLVM数据结构：StringRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::StringRef 定义在 llvm/ADT/StringRef.h 头文件中。 它的声明为： 1class StringRef; 和 ArrayRef 类似，StringRef 是一种轻量级的字符串引用类型，它用于实现高效地表示和操作字符串数据，尤其是在一些高频处理字符串，但同时不希望维护实际内存开销地场景下。 它是不可变引用，主要用于向函数内传递字符串同时避免深拷贝。它只包含了指向字符串的指针和字符串的长度信息，从而使得对它的操作直接而高效。 特点 轻量级：只存储一个指向字符串的指针和字符串的长度，不存储实际的数...</div></div></div></a><a class="pagination-related" href="/posts/e9ae65d7.html" title="学习LLVM数据结构：SmallVector"><img class="cover" src="https://img.p2tree.top/2025/3/9/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-09</div><div class="info-item-2">学习LLVM数据结构：SmallVector</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::SmallVector 定义在 llvm/ADT/SmallVector.h 头文件中。它的声明为： 12template&lt;typename T, unsigned N = CalculateSmallVectorDefaultInlinedElements&lt;T&gt;::value&gt; class SmallVector; llvm::SmallVector 是一个可变长数组，类似于 std::vector，同时它对较小长度的数组做了优化。它的内存管理方式采用局部缓存的设计思路，在对象内部预留一小块...</div></div></div></a><a class="pagination-related" href="/posts/cdf6959f.html" title="学习LLVM数据结构：ArrayRef"><img class="cover" src="https://img.p2tree.top/2025/2/25/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-02-25</div><div class="info-item-2">学习LLVM数据结构：ArrayRef</div></div><div class="info-2"><div class="info-item-1">在现代 C++ 程序开发中，选择合适的数据结构，对于程序性能和内存安全都至关重要。LLVM 项目中，有一大块内容便是设计用于内部开发的高效数据结构。 本文将以 cppreference 的格式，介绍这些实用的数据结构。你既可以将其作为学习参考，也可以作为学习 LLVM 的补充材料。 学习LLVM数据结构：ArrayRef学习LLVM数据结构：SmallVector学习LLVM数据结构：StringRef学习LLVM数据结构：SmallSet 基本介绍llvm::ArrayRef 定义在 llvm/ADT/ArrayRef.h 头文件中。它的声明为： 1template&lt;typename T&gt; class ArrayRef; llvm::ArrayRef 是一个轻量级的只读容器，主要用于引用一段连续的内存区域。它的设计目标是提供高效的数据访问，而不需要拥有底层数据的所有权。这使得 ArrayRef 特别适合在函数参数中实用，从而避免了不必要的内存拷贝。 特点 只读：ArrayRef 不能修改其引用的数据，也不能添加新元素（另一个容器 MutableArrayR...</div></div></div></a><a class="pagination-related" href="/posts/801cd0f2.html" title="LLVM 风格的 RTTI"><img class="cover" src="https://img.p2tree.top/2023/08/14/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-14</div><div class="info-item-2">LLVM 风格的 RTTI</div></div><div class="info-2"><div class="info-item-1">开头叨叨众所周知，LLVM project 没有开启 C++ 的 RTTI 特性。一个主要的原因是 LLVM project 认为 C++ RTTI 特性的实现需要使用到虚函数表，对性能并不友好。LLVM 自己实现了一种类似 RTTI 的行为。我们在开发 LLVM 代码时，尤其是需要自己搭建自定义的数据结构时，可能会想用到 RTTI，此时，学习在 LLVM 风格下如何创建类似的 API，就显得尤为重要。 什么是 RTTI难度：⭐ RTTI 是运行时类型识别，全称 Runtime Type Identification，网上有很多介绍这个的资料，属于 C++ 程序员必须要熟悉的内容。 它的主要目的是为程序运行时提供一种对对象类型的获取、操作的方式。 对应到 C++ API 上，有三个 API 会用到 RTTI： dynamic_cast，用来将一个指向基类的指针转换为一个指向派生类的指针，如果转换失败，会返回 nullptr typeid，用来返回对象类型的值 type_info，也就是 typeid 的返回类型，用来存储描述类型的信息 如果不使用这三个 API，关闭 RTTI...</div></div></div></a><a class="pagination-related" href="/posts/ab589331.html" title="LLVM New Pass Manager"><img class="cover" src="https://img.p2tree.top/2022/12/03/index.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-03</div><div class="info-item-2">LLVM New Pass Manager</div></div><div class="info-2"><div class="info-item-1">这是一篇译文，主要介绍了 LLVM 中的 New Pass Manager 原文链接：https://blog.llvm.org/posts/2021-03-26-the-new-pass-manager/by Arthur Eubanks（Mar 26, 2021） Pass Manager 的介绍Pass Manager 的主要用途是调度 Pass 在各 IR 层级按顺序运行。 Pass 分为 transformation pass 和 analyses pass，它们可以选择运行在 module、function 等各种 scope 下，甚至更加抽象地，比如 call graph 上的强连接组件（SCC: strongly connected component）或者 loop 上。 调度可以很简单，比如直接按顺序运行 pass list，或者按遇到的每一个 function 来调用。同时调度也可能很复杂，比如 SCC 在 call graph 中的顺序必须正确。 Pass Manager 还负责管理 analyses pass 的分析结果，比如说支配树（dominat...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://img.p2tree.top/avatar.webp" onerror='this.onerror=null,this.src="/img/404.gif"' alt="avatar"></div><div class="author-info-name">P2Tree</div><div class="author-info-description">基础软件研发工程师</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">83</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">34</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/p2tree" target="_blank" title="Github"><i class="iconfont icon-github"></i></a><a class="social-icon" href="mailto:public@p2tree.top" target="_blank" title="Email"><i class="iconfont icon-mail"></i></a><a class="social-icon" href="https://zhihu.com/people/p2tree" target="_blank" title="Zhihu"><i class="iconfont icon-zhihu"></i></a><a class="social-icon" href="/2024/08/05/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7-P2Tree/" target="_blank" title="Weixin"><i class="iconfont icon-wechat"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="Feed"><i class="iconfont icon-feed"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎访问我的个人站点，这里会发布我的学习笔记和生活感悟。<br>可以通过选择分类或标签来阅读你感兴趣的文章。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">6.1 实现类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-1-%E5%B1%80%E9%83%A8%E6%8C%87%E9%92%88"><span class="toc-number">1.1.</span> <span class="toc-text">6.1.1 局部指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-2-char-short-int-%E5%92%8C-bool-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">6.1.2 char, short int 和 bool 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-3-long-long-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">6.1.3 long long 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-4-float-%E5%92%8C-double-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">6.1.4 float 和 double 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-5-%E6%95%B0%E7%BB%84%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.5.</span> <span class="toc-text">6.1.5 数组和结构体类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-6-%E5%90%91%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.</span> <span class="toc-text">6.1.6 向量类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="toc-number">2.</span> <span class="toc-text">6.2 代码修改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-%E6%96%87%E4%BB%B6%E6%96%B0%E5%A2%9E"><span class="toc-number">2.1.</span> <span class="toc-text">6.2.1 文件新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Cpu0InstrInfo-td"><span class="toc-number">2.1.1.</span> <span class="toc-text">(1) Cpu0InstrInfo.td</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Cpu0ISelLowering-h-cpp"><span class="toc-number">2.1.2.</span> <span class="toc-text">(2) Cpu0ISelLowering.h&#x2F;.cpp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Cpu0SEISelDAGToDAG-cpp"><span class="toc-number">2.1.3.</span> <span class="toc-text">(3) Cpu0SEISelDAGToDAG.cpp</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E6%A3%80%E9%AA%8C%E6%88%90%E6%9E%9C"><span class="toc-number">3.</span> <span class="toc-text">6.3 检验成果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-%E5%B1%80%E9%83%A8%E6%8C%87%E9%92%88"><span class="toc-number">3.1.</span> <span class="toc-text">6.3.1 局部指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-char-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">6.3.2 char 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-short-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">6.3.3 short 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-4-bool-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">6.3.4 bool 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-5-long-long-%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.5.</span> <span class="toc-text">6.3.5 long long 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-6-%E6%95%B0%E7%BB%84%E5%92%8C%E7%BB%93%E6%9E%84%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.6.</span> <span class="toc-text">6.3.6 数组和结构体类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-8-%E5%90%91%E9%87%8F%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.7.</span> <span class="toc-text">6.3.8 向量类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">6.4 总结</span></a></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><i class="fa-solid fa-layer-group"></i><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"><img src="https://img.p2tree.top/2021/09/10/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器"></a><div class="content"><a class="title" href="/posts/96dd94da.html" title="LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器">LLVM 后端实践笔记 附录A：使用 Simulator 验证编译器</a><time datetime="2021-09-10T17:12:50.000Z" title="发表于 2021-09-10 17:12:50">2021-09-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编"><img src="https://img.p2tree.top/2021/08/07/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 10：汇编"></a><div class="content"><a class="title" href="/posts/419cdb7c.html" title="LLVM 后端实践笔记 10：汇编">LLVM 后端实践笔记 10：汇编</a><time datetime="2021-08-07T23:15:39.000Z" title="发表于 2021-08-07 23:15:39">2021-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持"><img src="https://img.p2tree.top/2021/07/31/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 9：ELF文件支持"></a><div class="content"><a class="title" href="/posts/949c9f6a.html" title="LLVM 后端实践笔记 9：ELF文件支持">LLVM 后端实践笔记 9：ELF文件支持</a><time datetime="2021-07-31T23:04:26.000Z" title="发表于 2021-07-31 23:04:26">2021-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用"><img src="https://img.p2tree.top/2021/07/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 8：函数调用"></a><div class="content"><a class="title" href="/posts/17d95923.html" title="LLVM 后端实践笔记 8：函数调用">LLVM 后端实践笔记 8：函数调用</a><time datetime="2021-07-24T23:01:27.000Z" title="发表于 2021-07-24 23:01:27">2021-07-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流"><img src="https://img.p2tree.top/2021/07/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 7：控制流"></a><div class="content"><a class="title" href="/posts/8908debe.html" title="LLVM 后端实践笔记 7：控制流">LLVM 后端实践笔记 7：控制流</a><time datetime="2021-07-04T22:09:23.000Z" title="发表于 2021-07-04 22:09:23">2021-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型"><img src="https://img.p2tree.top/2021/06/19/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 6：更多数据类型"></a><div class="content"><a class="title" href="/posts/cb3a6aa4.html" title="LLVM 后端实践笔记 6：更多数据类型">LLVM 后端实践笔记 6：更多数据类型</a><time datetime="2021-06-19T17:15:17.000Z" title="发表于 2021-06-19 17:15:17">2021-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量"><img src="https://img.p2tree.top/2021/06/06/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 5：全局变量"></a><div class="content"><a class="title" href="/posts/bd2628c8.html" title="LLVM 后端实践笔记 5：全局变量">LLVM 后端实践笔记 5：全局变量</a><time datetime="2021-06-06T21:38:10.000Z" title="发表于 2021-06-06 21:38:10">2021-06-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件"><img src="https://img.p2tree.top/2021/05/11/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 4：生成目标文件"></a><div class="content"><a class="title" href="/posts/3616dfe9.html" title="LLVM 后端实践笔记 4：生成目标文件">LLVM 后端实践笔记 4：生成目标文件</a><time datetime="2021-05-11T22:18:35.000Z" title="发表于 2021-05-11 22:18:35">2021-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令"><img src="https://img.p2tree.top/2021/04/05/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 3：算术和逻辑指令"></a><div class="content"><a class="title" href="/posts/1268381.html" title="LLVM 后端实践笔记 3：算术和逻辑指令">LLVM 后端实践笔记 3：算术和逻辑指令</a><time datetime="2021-04-05T23:24:42.000Z" title="发表于 2021-04-05 23:24:42">2021-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构"><img src="https://img.p2tree.top/2021/03/13/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 2：后端结构"></a><div class="content"><a class="title" href="/posts/eea38852.html" title="LLVM 后端实践笔记 2：后端结构">LLVM 后端实践笔记 2：后端结构</a><time datetime="2021-03-13T07:47:31.000Z" title="发表于 2021-03-13 07:47:31">2021-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译"><img src="https://img.p2tree.top/2021/02/24/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 1：新后端初始化和软件编译"></a><div class="content"><a class="title" href="/posts/400d7b12.html" title="LLVM 后端实践笔记 1：新后端初始化和软件编译">LLVM 后端实践笔记 1：新后端初始化和软件编译</a><time datetime="2021-02-24T22:53:00.000Z" title="发表于 2021-02-24 22:53:00">2021-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序"><img src="https://img.p2tree.top/2021/02/22/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LLVM 后端实践笔记 0：序"></a><div class="content"><a class="title" href="/posts/4b2442c5.html" title="LLVM 后端实践笔记 0：序">LLVM 后端实践笔记 0：序</a><time datetime="2021-02-22T23:14:05.000Z" title="发表于 2021-02-22 23:14:05">2021-02-22</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/dc0bdc19.html" title="读书推荐：活着"><img src="https://img.p2tree.top/2024/12/15/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：活着"></a><div class="content"><a class="title" href="/posts/dc0bdc19.html" title="读书推荐：活着">读书推荐：活着</a><time datetime="2025-09-25T15:34:46.351Z" title="更新于 2025-09-25 15:34:46">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议"><img src="https://img.p2tree.top/2024/10/27/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：宝贵的人生建议"></a><div class="content"><a class="title" href="/posts/2626ad0e.html" title="读书推荐：宝贵的人生建议">读书推荐：宝贵的人生建议</a><time datetime="2025-09-25T15:34:46.351Z" title="更新于 2025-09-25 15:34:46">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构"><img src="https://img.p2tree.top/2020/01/04/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="跟随一条指令来看LLVM的基本结构"></a><div class="content"><a class="title" href="/posts/4fefbc0d.html" title="跟随一条指令来看LLVM的基本结构">跟随一条指令来看LLVM的基本结构</a><time datetime="2025-09-25T15:34:46.351Z" title="更新于 2025-09-25 15:34:46">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀"><img src="https://img.p2tree.top/2025/4/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="读书推荐：南京大屠杀"></a><div class="content"><a class="title" href="/posts/1e952ac7.html" title="读书推荐：南京大屠杀">读书推荐：南京大屠杀</a><time datetime="2025-09-25T15:34:46.350Z" title="更新于 2025-09-25 15:34:46">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a28b3899.html" title="死亡搁浅配乐收藏"><img src="https://img.p2tree.top/2024/10/26/index.webp" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="死亡搁浅配乐收藏"></a><div class="content"><a class="title" href="/posts/a28b3899.html" title="死亡搁浅配乐收藏">死亡搁浅配乐收藏</a><time datetime="2025-09-25T15:34:46.350Z" title="更新于 2025-09-25 15:34:46">2025-09-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://img.p2tree.top/default.webp)"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2024 - 2025 By P2Tree</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.0"></script><script src="/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0.29/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=(t=document,e=location.pathname)=>{twikoo.init({el:t.querySelector("#twikoo-wrap"),envId:"https://twikoo.p2tree.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},path:e}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{t.children.length&&(t.innerHTML="",t.classList.add("no-comment"))})},e=(o,e)=>{"object"==typeof twikoo?setTimeout(()=>t(o,e),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>t(o,e))};o?window.shuoshuoComment={loadComment:e}:e()})()</script></div><script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script><script>LA.init({id:"3JR7r5l5JW5Miut3",ck:"3JR7r5l5JW5Miut3",autoTrack:!0})</script><script src="/js/mourning.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div id="algolia-search-input"><div class="ais-SearchBox"><form class="ais-SearchBox-form" action="" role="search" novalidate><input class="ais-SearchBox-input" type="search" placeholder="搜索文章" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="512" aria-label="Search"><button class="ais-SearchBox-submit" type="submit" title="Submit the search query" style="display:none"><svg class="ais-SearchBox-submitIcon" width="10" height="10" viewBox="0 0 40 40" aria-hidden="true"><path d="M26.804 29.01c-2.832 2.34-6.465 3.746-10.426 3.746C7.333 32.756 0 25.424 0 16.378 0 7.333 7.333 0 16.378 0c9.046 0 16.378 7.333 16.378 16.378 0 3.96-1.406 7.594-3.746 10.426l10.534 10.534c.607.607.61 1.59-.004 2.202-.61.61-1.597.61-2.202.004L26.804 29.01zm-10.426.627c7.323 0 13.26-5.936 13.26-13.26 0-7.32-5.937-13.257-13.26-13.257C9.056 3.12 3.12 9.056 3.12 16.378c0 7.323 5.936 13.26 13.258 13.26z"></path></svg></button></form></div><hr><div id="algolia-search-results"><div id="algolia-hits"><div id="algolia-hits-empty" style="display:none"></div><div class="ais-Hits" style="display:none"><ol class="ais-Hits-list"></ol></div></div><div class="ais-Pagination" id="algolia-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="algolia-info"><span class="ais-Stats-text"></span><a class="algolia-poweredBy" href="https://www.algolia.com/?utm_source=algoliasearch.js&amp;utm_medium=website&amp;utm_content=localhost&amp;utm_campaign=poweredby" target="_blank" aria-label="Search by Algolia" rel="noopener noreferrer"><svg class="ais-PoweredBy-logo" height="1.2em" viewBox="0 0 572 64" style="width:auto"><path fill="#36395A" d="M16 48.3c-3.4 0-6.3-.6-8.7-1.7A12.4 12.4 0 0 1 1.9 42C.6 40 0 38 0 35.4h6.5a6.7 6.7 0 0 0 3.9 6c1.4.7 3.3 1.1 5.6 1.1 2.2 0 4-.3 5.4-1a7 7 0 0 0 3-2.4 6 6 0 0 0 1-3.4c0-1.5-.6-2.8-1.9-3.7-1.3-1-3.3-1.6-5.9-1.8l-4-.4c-3.7-.3-6.6-1.4-8.8-3.4a10 10 0 0 1-3.3-7.9c0-2.4.6-4.6 1.8-6.4a12 12 0 0 1 5-4.3c2.2-1 4.7-1.6 7.5-1.6s5.5.5 7.6 1.6a12 12 0 0 1 5 4.4c1.2 1.8 1.8 4 1.8 6.7h-6.5a6.4 6.4 0 0 0-3.5-5.9c-1-.6-2.6-1-4.4-1s-3.2.3-4.4 1c-1.1.6-2 1.4-2.6 2.4-.5 1-.8 2-.8 3.1a5 5 0 0 0 1.5 3.6c1 1 2.6 1.7 4.7 1.9l4 .3c2.8.2 5.2.8 7.2 1.8 2.1 1 3.7 2.2 4.9 3.8a9.7 9.7 0 0 1 1.7 5.8c0 2.5-.7 4.7-2 6.6a13 13 0 0 1-5.6 4.4c-2.4 1-5.2 1.6-8.4 1.6Zm35.6 0c-2.6 0-4.8-.4-6.7-1.3a13 13 0 0 1-4.7-3.5 17.1 17.1 0 0 1-3.6-10.4v-1c0-2 .3-3.8 1-5.6a13 13 0 0 1 7.3-8.3 15 15 0 0 1 6.3-1.4A13.2 13.2 0 0 1 64 24.3c1 2.2 1.6 4.6 1.6 7.2V34H39.4v-4.3h21.8l-1.8 2.2c0-2-.3-3.7-.9-5.1a7.3 7.3 0 0 0-2.7-3.4c-1.2-.7-2.7-1.1-4.6-1.1s-3.4.4-4.7 1.3a8 8 0 0 0-2.9 3.6c-.6 1.5-.9 3.3-.9 5.4 0 2 .3 3.7 1 5.3a7.9 7.9 0 0 0 2.8 3.7c1.3.8 3 1.3 5 1.3s3.8-.5 5.1-1.3c1.3-1 2.1-2 2.4-3.2h6a11.8 11.8 0 0 1-7 8.7 16 16 0 0 1-6.4 1.2ZM80 48c-2.2 0-4-.3-5.7-1a8.4 8.4 0 0 1-3.7-3.3 9.7 9.7 0 0 1-1.3-5.2c0-2 .5-3.8 1.5-5.2a9 9 0 0 1 4.3-3.1c1.8-.7 4-1 6.7-1H89v4.1h-7.5c-2 0-3.4.5-4.4 1.4-1 1-1.6 2.1-1.6 3.6s.5 2.7 1.6 3.6c1 1 2.5 1.4 4.4 1.4 1.1 0 2.2-.2 3.2-.7 1-.4 1.9-1 2.6-2 .6-1 1-2.4 1-4.2l1.7 2.1c-.2 2-.7 3.8-1.5 5.2a9 9 0 0 1-3.4 3.3 12 12 0 0 1-5.3 1Zm9.5-.7v-8.8h-1v-10c0-1.8-.5-3.2-1.4-4.1-1-1-2.4-1.4-4.2-1.4a142.9 142.9 0 0 0-10.2.4v-5.6a74.8 74.8 0 0 1 8.6-.4c3 0 5.5.4 7.5 1.2s3.4 2 4.4 3.6c1 1.7 1.4 4 1.4 6.7v18.4h-5Zm12.9 0V17.8h5v12.3h-.2c0-4.2 1-7.4 2.8-9.5a11 11 0 0 1 8.3-3.1h1v5.6h-2a9 9 0 0 0-6.3 2.2c-1.5 1.5-2.2 3.6-2.2 6.4v15.6h-6.4Zm34.4 1a15 15 0 0 1-6.6-1.3c-1.9-.9-3.4-2-4.7-3.5a15.5 15.5 0 0 1-2.7-5c-.6-1.7-1-3.6-1-5.4v-1c0-2 .4-3.8 1-5.6a15 15 0 0 1 2.8-4.9c1.3-1.5 2.8-2.6 4.6-3.5a16.4 16.4 0 0 1 13.3.2c2 1 3.5 2.3 4.8 4a12 12 0 0 1 2 6H144c-.2-1.6-1-3-2.2-4.1a7.5 7.5 0 0 0-5.2-1.7 8 8 0 0 0-4.7 1.3 8 8 0 0 0-2.8 3.6 13.8 13.8 0 0 0 0 10.3c.6 1.5 1.5 2.7 2.8 3.6s2.8 1.3 4.8 1.3c1.5 0 2.7-.2 3.8-.8a7 7 0 0 0 2.6-2c.7-1 1-2 1.2-3.2h6.2a11 11 0 0 1-2 6.2 15.1 15.1 0 0 1-11.8 5.5Zm19.7-1v-40h6.4V31h-1.3c0-3 .4-5.5 1.1-7.6a9.7 9.7 0 0 1 3.5-4.8A9.9 9.9 0 0 1 172 17h.3c3.5 0 6 1.1 7.9 3.5 1.7 2.3 2.6 5.7 2.6 10v16.8h-6.4V29.6c0-2.1-.6-3.8-1.8-5a6.4 6.4 0 0 0-4.8-1.8c-2 0-3.7.7-5 2a7.8 7.8 0 0 0-1.9 5.5v17h-6.4Zm63.8 1a12.2 12.2 0 0 1-10.9-6.2 19 19 0 0 1-1.8-7.3h1.4v12.5h-5.1v-40h6.4v19.8l-2 3.5c.2-3.1.8-5.7 1.9-7.7a11 11 0 0 1 4.4-4.5c1.8-1 3.9-1.5 6.1-1.5a13.4 13.4 0 0 1 12.8 9.1c.7 1.9 1 3.8 1 6v1c0 2.2-.3 4.1-1 6a13.6 13.6 0 0 1-13.2 9.4Zm-1.2-5.5a8.4 8.4 0 0 0 7.9-5c.7-1.5 1.1-3.3 1.1-5.3s-.4-3.8-1.1-5.3a8.7 8.7 0 0 0-3.2-3.6 9.6 9.6 0 0 0-9.2-.2 8.5 8.5 0 0 0-3.3 3.2c-.8 1.4-1.3 3-1.3 5v2.3a9 9 0 0 0 1.3 4.8 9 9 0 0 0 3.4 3c1.4.7 2.8 1 4.4 1Zm27.3 3.9-10-28.9h6.5l9.5 28.9h-6Zm-7.5 12.2v-5.7h4.9c1 0 2-.1 2.9-.4a4 4 0 0 0 2-1.4c.4-.7.9-1.6 1.2-2.7l8.6-30.9h6.2l-9.3 32.4a14 14 0 0 1-2.5 5 8.9 8.9 0 0 1-4 2.8c-1.5.6-3.4.9-5.6.9h-4.4Zm9-12.2v-5.2h6.4v5.2H248Z"></path><path fill="#003DFF" d="M534.4 9.1H528a.8.8 0 0 1-.7-.7V1.8c0-.4.2-.7.6-.8l6.5-1c.4 0 .8.2.9.6v7.8c0 .4-.4.7-.8.7zM428 35.2V.8c0-.5-.3-.8-.7-.8h-.2l-6.4 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.5 0 .8-.4.8-.8V43c0-.4-.3-.7-.6-.8-4.5-.5-4.5-6-4.5-7zm106.5-21.8H528c-.4 0-.7.4-.7.8v34c0 .4.3.8.7.8h6.5c.4 0 .8-.4.8-.8v-34c0-.5-.4-.8-.8-.8zm-17.7 21.8V.8c0-.5-.3-.8-.8-.8l-6.5 1c-.4 0-.7.4-.7.8v35c0 1.6 0 11.8 12.3 12.2.4 0 .8-.4.8-.8V43c0-.4-.3-.7-.7-.8-4.4-.5-4.4-6-4.4-7zm-22.2-20.6a16.5 16.5 0 0 1 8.6 9.3c.8 2.2 1.3 4.8 1.3 7.5a19.4 19.4 0 0 1-4.6 12.6 14.8 14.8 0 0 1-5.2 3.6c-2 .9-5.2 1.4-6.8 1.4a21 21 0 0 1-6.7-1.4 15.4 15.4 0 0 1-8.6-9.3 21.3 21.3 0 0 1 0-14.4 15.2 15.2 0 0 1 8.6-9.3c2-.8 4.3-1.2 6.7-1.2s4.6.4 6.7 1.2zm-6.7 27.6c2.7 0 4.7-1 6.2-3s2.2-4.3 2.2-7.8-.7-6.3-2.2-8.3-3.5-3-6.2-3-4.7 1-6.1 3c-1.5 2-2.2 4.8-2.2 8.3s.7 5.8 2.2 7.8 3.5 3 6.2 3zm-88.8-28.8c-6.2 0-11.7 3.3-14.8 8.2a18.6 18.6 0 0 0 4.8 25.2c1.8 1.2 4 1.8 6.2 1.7s.1 0 .1 0h.9c4.2-.7 8-4 9.1-8.1v7.4c0 .4.3.7.8.7h6.4a.7.7 0 0 0 .7-.7V14.2c0-.5-.3-.8-.7-.8h-13.5zm6.3 26.5a9.8 9.8 0 0 1-5.7 2h-.5a10 10 0 0 1-9.2-14c1.4-3.7 5-6.3 9-6.3h6.4v18.3zm152.3-26.5h13.5c.5 0 .8.3.8.7v33.7c0 .4-.3.7-.8.7h-6.4a.7.7 0 0 1-.8-.7v-7.4c-1.2 4-4.8 7.4-9 8h-.1a4.2 4.2 0 0 1-.5.1h-.9a10.3 10.3 0 0 1-7-2.6c-4-3.3-6.5-8.4-6.5-14.2 0-3.7 1-7.2 3-10 3-5 8.5-8.3 14.7-8.3zm.6 28.4c2.2-.1 4.2-.6 5.7-2V21.7h-6.3a9.8 9.8 0 0 0-9 6.4 10.2 10.2 0 0 0 9.1 13.9h.5zM452.8 13.4c-6.2 0-11.7 3.3-14.8 8.2a18.5 18.5 0 0 0 3.6 24.3 10.4 10.4 0 0 0 13 .6c2.2-1.5 3.8-3.7 4.5-6.1v7.8c0 2.8-.8 5-2.2 6.3-1.5 1.5-4 2.2-7.5 2.2l-6-.3c-.3 0-.7.2-.8.5l-1.6 5.5c-.1.4.1.8.5 1h.1c2.8.4 5.5.6 7 .6 6.3 0 11-1.4 14-4.1 2.7-2.5 4.2-6.3 4.5-11.4V14.2c0-.5-.4-.8-.8-.8h-13.5zm6.3 8.2v18.3a9.6 9.6 0 0 1-5.6 2h-1a10.3 10.3 0 0 1-8.8-14c1.4-3.7 5-6.3 9-6.3h6.4zM291 31.5A32 32 0 0 1 322.8 0h30.8c.6 0 1.2.5 1.2 1.2v61.5c0 1.1-1.3 1.7-2.2 1l-19.2-17a18 18 0 0 1-11 3.4 18.1 18.1 0 1 1 18.2-14.8c-.1.4-.5.7-.9.6-.1 0-.3 0-.4-.2l-3.8-3.4c-.4-.3-.6-.8-.7-1.4a12 12 0 1 0-2.4 8.3c.4-.4 1-.5 1.6-.2l14.7 13.1v-46H323a26 26 0 1 0 10 49.7c.8-.4 1.6-.2 2.3.3l3 2.7c.3.2.3.7 0 1l-.2.2a32 32 0 0 1-47.2-28.6z"></path></svg></a></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch@5.37.0/dist/lite/builds/browser.umd.min.js"></script><script src="/js/search/algolia.js?v=5.5.0"></script></div></div><script data-pjax>function butterfly_footer_beautify_injector_config(){var e=document.getElementById("footer");console.log("已挂载butterfly_footer_beautify"),e.innerHTML='<footer id="footer" style="background: transparent"><div id="footer-bottom"><div class="footer-bottom-content"><div class="footer-bottom-left"><span class="copyright">&copy;2024 - 2025 By <a target="_blank" rel="noopener" href="https://p2tree.top/" title="点击访问&quot;P2Tree&quot;的主页" style="margin-left:5px">P2Tree</a></span><div><a class="footer-bottom-link" target="_blank" href="https://vercel.com/" rel="noopener external nofollow" title="undefined">Vercel</a><a class="footer-bottom-link" target="_blank" href="https://cloudflare.com/" rel="noopener external nofollow" title="undefined">CloudFlare</a><a class="footer-bottom-link" target="_blank" href="https://v6.51.la/land/3JR7r5l5JW5Miut3" rel="noopener external nofollow" title="undefined">51LA</a><a class="footer-bottom-link" target="_blank" href="https://stat.p2tree.top/" rel="noopener external nofollow" title="undefined">UptimeFlare</a></div></div><div class="footer-bottom-right"><div id="runtime" title="已运行时长">本站已运行：0 天 0 时 0 分 0 秒</div><div><a class="footer-bottom-link" target="_blank" href="https://icp.hentioe.dev/sites/20255550" rel="noopener external nofollow" title="喵ICP备20255550号">喵ICP备20255550号</a><a class="footer-bottom-link" target="_blank" href="https://hexo.io/zh-cn/" rel="noopener external nofollow" title="博客框架">Hexo</a><a class="footer-bottom-link" target="_blank" href="https://butterfly.js.org/" rel="noopener external nofollow" title="主题">Butterfly</a></div></div></div></div></footer>'}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_footer_beautify_injector_config()</script><script defer src="https://cdn1.tianli0.top/npm/hexo-butterfly-footer-marcus/lib/footer.min.js"></script><script data-pjax>function butterfly_swiper_injector_config(){var t=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),t.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/73fc32a.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2023/10/14/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-10-14</span><a class="blog-slider__title" href="posts/73fc32a.html" alt="">Vim 高效编辑技巧</a><div class="blog-slider__text">绝对是全网都没有的 Vim 使用硬干货经验</div><a class="blog-slider__button" href="posts/73fc32a.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/4b2442c5.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2021/02/22/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-02-22</span><a class="blog-slider__title" href="posts/4b2442c5.html" alt="">LLVM 后端实践笔记 0：序</a><div class="blog-slider__text">LLVM 后端学习的系列教程，这是第一集，必读起跑线</div><a class="blog-slider__button" href="posts/4b2442c5.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/e8d522db.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/05/wechat_logo.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-05</span><a class="blog-slider__title" href="posts/e8d522db.html" alt="">微信公众号 P2Tree</a><div class="blog-slider__text">我维护的微信公众号，欢迎来交个朋友</div><a class="blog-slider__button" href="posts/e8d522db.html" alt="">详情   </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="posts/b32e3378.html" alt=""><img width="48" height="48" src="https://img.p2tree.top/2024/08/23/index.webp" alt="" onerror="this.src=https://img.p2tree.top/default.webp; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2024-08-23</span><a class="blog-slider__title" href="posts/b32e3378.html" alt="">个人说明书 v2.2.4</a><div class="blog-slider__text">这份个人说明书，记录着我的基本信息和所思所想，希望能以最快的方式介绍我自己</div><a class="blog-slider__button" href="posts/b32e3378.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="/about/,/tags/,/categories/,/draft/".split(","),cpage=location.pathname,epage="all",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script></body></html>